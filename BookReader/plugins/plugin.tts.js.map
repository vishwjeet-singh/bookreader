{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/tts/PageChunk.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/PageChunkIterator.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/AbstractTTSEngine.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/utils.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/FestivalTTSEngine.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/plugin.tts.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/WebTTSEngine.js","webpack://@internetarchive/bookreader/./src/js/plugins/tts/tooltip_dict.js","webpack://@internetarchive/bookreader/./src/util/browserSniffing.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/check-correctness-of-iteration.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/engine-is-ios.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/function-bind.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/host-report-errors.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/iterate.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/microtask.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/native-promise-constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/new-promise-capability.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/perform.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/promise-resolve.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/task.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.get-prototype-of.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.promise.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.reflect.construct.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.match.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.starts-with.js","webpack://@internetarchive/bookreader/./node_modules/iso-language-codes/js/data.js","webpack://@internetarchive/bookreader/./node_modules/jquery.browser/dist/jquery.browser.js","webpack://@internetarchive/bookreader/./node_modules/soundmanager2/script/soundmanager2.js"],"names":["PageChunk","leafIndex","chunkIndex","text","lineRects","this","server","bookPath","Promise","res","rej","$","ajax","type","url","dataType","cache","data","path","page","error","then","chunks","_fromTextWrapperResponse","chunksResponse","map","c","i","correctedLineRects","_fixChunkRects","slice","correctedText","_removeDanglingHyphens","rects","length","firstRect","secondRect","left","bottom","width","secondHeight","secondWidth","secondRight","replace","PageChunkIterator","pageCount","start","opts","Object","assign","DEFAULT_OPTS","_cursor","chunk","_bufferedPages","_bufferingPages","_cursorLock","resolve","_nextUncontrolled","_decrementUncontrolled","AT_END","_recenterBuffer","_fetchPageChunks","cursorChangePromise","prevPageChunks","index","Math","max","pageBufferSize","end","min","_removePageFromBuffer","_fetchPageChunksDirect","fetch","AbstractTTSEngine","options","playing","paused","_chunkIterator","activeSound","playbackRate","events","voice","on","getBestBookVoice","getVoices","bookLanguage","trigger","Error","voices","userLanguages","navigator","languages","bookLangVoices","filter","v","lang","startsWith","matchingUserLangs","language","getMatchingVoice","find","default","matchingVoices","numLeafs","onLoadingStart","step","stop","fireEvent","pause","resume","finish","all","decrement","newRate","setPlaybackRate","next","onDone","sound","createSound","rate","load","onLoadingComplete","beforeChunkPlay","playPromise","playSound","afterChunkPlay","loaded","play","promisifyEvent","target","eventType","addEventListener","resolver","ev","removeEventListener","sleep","ms","setTimeout","isAndroid","userAgent","test","COLUMN_TO_LANG_INDEX","searchForISO6391","columnsToSearch","langs","colI","column","split","x","toLowerCase","indexOf","FestivalTTSEngine","audioFormat","browser","mozilla","soundManager","supported","localService","name","voiceURI","setup","debugMode","preferFlash","useHTML5Audio","flashVersion","promise","match","iOSCaptureUserIntentHack","FestivalTTSSound","getSoundUrl","dataString","encodeURIComponent","SILENCE_1MS","onfinish","destruct","soundUrl","_finishResolver","onload","onresume","mp3","ogg","super_","WebTTSEngine","speechSynthesis","window","audio","Audio","SILENCE_6S_MP3","loop","src","mediaSession","metadata","MediaMetadata","title","br","bookTitle","artist","m","label","value","artwork","thumbnail","setActionHandler","jumpBackward","jumpForward","WebTTSSound","started","stopped","utterance","_lastEvents","boundary","_charIndex","_finishPromise","SpeechSynthesisUtterance","location","toString","console","log","dispatchEvent","CustomEvent","wasPaused","recentEvent","charIndex","cancel","speak","isLocalVoice","isChrome","_chromePausingBugFix","endPromise","race","Event","pausePromise","pauseMightNotWork","isFirefox","timeoutPromise","result","resumeMightNotWork","resumeMightNotFire","resumePromise","reload","en","jQuery","extend","BookReader","defaultOptions","enableTtsPlugin","prototype","call","ttsHilites","TTSEngine","isSupported","engineName","festival","web","ttsEngine","showProgressPopup","bind","removeProgressPopup","ttsStop","ttsBeforeChunkPlay","ttsSendChunkFinishedAnalyticsEvent","init","eventNames","fragmentChange","mode","constMode2up","visibleSelector","twoPage","currentIndexL","currentIndexR","join","show","not","hide","PostInit","click","ttsToggle","ttsStart","buildMobileDrawerElement","$el","after","imagesBaseURL","initNavbar","refs","$BRReadAloudToolbar","prepend","ttsUpdateState","ttsPlayPause","ttsJumpForward","ttsJumpBackward","$rateSelector","change","parseFloat","val","tooltips","insertBefore","closest","autoStop","startTTSEngine","constModeThumb","switchMode","constMode1up","addClass","ttsSendAnalyticsEvent","currentIndex","getNumLeafs","isPlaying","toggleClass","togglePlayPause","removeClass","ttsRemoveHilites","ttsMaybeFlipToIndex","ttsHighlightChunk","ttsScrollToChunk","in2PageMode","animationFinishedCallback","prev","jumpToIndex","ttsHilite2UP","ttsHilite1UP","leafTop","parseInt","_getPageHeight","reduce","padding","chunkTop","chunkBot","topOfFirstChunk","botOfLastChunk","containerTop","$brContainer","prop","containerBot","height","animate","scrollTop","l","b","r","t","div","document","createElement","push","appendTo","css","top","$brTwoPageView","setHilightCss2UP","remove","action","archiveAnalyticsSendEvent","extraValues","mediaLanguage","vendor","isSafari","ITERATOR","wellKnownSymbol","SAFE_CLOSING","called","iteratorWithReturn","done","Array","from","module","exports","exec","SKIP_CLOSING","ITERATION_SUPPORT","object","aFunction","isObject","factories","construct","C","argsLength","args","list","Function","that","fn","partArgs","arguments","boundFunction","concat","apply","global","a","anObject","isArrayIteratorMethod","toLength","getIteratorMethod","iteratorClose","Result","iterable","unboundFunction","iterator","iterFn","AS_ENTRIES","IS_ITERATOR","INTERRUPTED","condition","callFn","TypeError","flush","head","last","notify","toggle","node","getOwnPropertyDescriptor","macrotask","IS_IOS","IS_NODE","MutationObserver","WebKitMutationObserver","process","queueMicrotaskDescriptor","queueMicrotask","parent","domain","exit","undefined","enter","createTextNode","observe","characterData","nextTick","task","PromiseCapability","reject","$$resolve","$$reject","f","newPromiseCapability","constructor","promiseCapability","getBuiltIn","definePropertyModule","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","configurable","get","defer","channel","port","fails","html","set","setImmediate","clear","clearImmediate","MessageChannel","Dispatch","counter","queue","run","id","hasOwnProperty","runner","listener","event","post","postMessage","protocol","host","now","port2","port1","onmessage","importScripts","appendChild","removeChild","toObject","nativeGetPrototypeOf","CORRECT_PROTOTYPE_GETTER","stat","forced","sham","getPrototypeOf","it","Internal","OwnPromiseCapability","PromiseWrapper","nativeThen","IS_PURE","NativePromise","redefine","redefineAll","setToStringTag","setSpecies","anInstance","inspectSource","iterate","checkCorrectnessOfIteration","speciesConstructor","microtask","promiseResolve","hostReportErrors","newPromiseCapabilityModule","perform","InternalStateModule","isForced","V8_VERSION","PROMISE","getInternalState","setInternalState","getInternalPromiseState","getterFor","PromiseConstructor","$fetch","newGenericPromiseCapability","DISPATCH_EVENT","createEvent","NATIVE_REJECTION_EVENT","PromiseRejectionEvent","UNHANDLED_REJECTION","FORCED","String","FakePromise","INCORRECT_ITERATION","isThenable","state","isReject","notified","chain","reactions","ok","exited","reaction","handler","fail","rejection","onHandleUnhandled","onUnhandled","reason","initEvent","facade","isUnhandled","emit","unwrap","internalReject","internalResolve","wrapper","executor","onFulfilled","onRejected","unsafe","enumerable","input","wrap","capability","$promiseResolve","values","remaining","alreadyCalled","create","nativeConstruct","NEW_TARGET_BUG","F","ARGS_BUG","Target","newTarget","$args","proto","instance","fixRegExpWellKnownSymbolLogic","requireObjectCoercible","advanceStringIndex","regExpExec","MATCH","nativeMatch","maybeCallNative","regexp","O","matcher","RegExp","rx","S","fullUnicode","unicode","lastIndex","A","n","matchStr","descriptor","notARegExp","correctIsRegExpLogic","nativeStartsWith","CORRECT_IS_REGEXP_LOGIC","writable","searchString","search","uaMatch","ua","platform_match","matched","version","versionNumber","platform","android","bb","blackberry","ipad","iphone","ipod","kindle","playbook","silk","mobile","cros","mac","linux","win","desktop","chrome","opr","safari","webkit","rv","iemobile","ie","edge","msedge","opera","jQBrowser","factory","_undefined","SoundManager","smURL","smID","setupOptions","debugFlash","useConsole","consoleOnly","waitForWindowLoad","bgColor","useHighPerformance","flashPollingInterval","html5PollingInterval","flashLoadTimeout","wmode","allowScriptAccess","useFlashBlock","forceUseGlobalHTML5Audio","ignoreMobileRestrictions","html5Test","noSWFCache","idPrefix","autoLoad","autoPlay","loops","onid3","onerror","whileloading","onplay","onpause","whileplaying","onposition","onstop","multiShot","multiShotEvents","position","pan","stream","to","usePolicyFile","volume","flash9Options","onfailure","isMovieStar","usePeakData","useWaveformData","useEQData","onbufferchange","ondataerror","movieStarOptions","bufferTime","serverURL","onconnect","duration","audioFormats","required","mp4","related","opus","wav","flac","movieID","debugID","debugURLParam","movieURL","altURL","swfLoaded","enabled","oMC","sounds","soundIDs","muted","didFlashBlock","filePattern","filePatterns","flash8","flash9","features","buffering","peakData","waveformData","eqData","movieStar","sandbox","types","remote","localWithFile","localWithNetwork","localTrusted","description","noRemote","noLocal","html5","usingFlash","flash","html5Only","ignoreFlash","SMSound","doNothing","setProperties","fV","debugTS","_wDS","initComplete","mixin","extraOptions","addOnEvent","processOnEvents","initUserOnload","delayWaitForEI","waitForEI","rebootIntoHTML5","setVersionInfo","handleFocus","strings","initMovie","domContentLoaded","winOnLoad","didDCLoaded","getDocument","createMovie","catchError","setPolling","initDebug","disableObject","failSafely","normalizeMovieURL","str","flashBlockHandler","getSWFCSS","swfCSS","toggleDebug","loopFix","policyFix","complain","idCheck","startTimer","stopTimer","timerExecute","parseURL","canIgnoreFlash","featureCheck","html5OK","html5CanPlay","html5ErrorCodes","html5Ext","html5Unload","domContentLoadedIE","testHTML5","lastGlobalHTML5URL","hasFlash","detectFlash","badSafariFix","html5_events","showSupport","flushMessages","wrapCallback","didSetup","sm2","globalHTML5Audio","sm","smc","wl","href","doc","on_queue","debugOpen","didAppend","appendSuccess","didInit","disabled","windowLoaded","wdCount","debugLevels","oRemoved","oRemovedHTML","waitingForEI","initPending","h5TimerCount","h5IntervalTimer","messages","needsFlash","useGlobalHTML5Audio","idCounter","msecScale","is_iDevice","isIE","isWebkit","isOpera","mobileHTML5","isBadSafari","hasConsole","isFocused","hasFocus","tryInitOnFocus","okToDisable","flashMIME","emptyURL","overHTTP","http","netStreamMimeTypes","netStreamTypes","netStreamPattern","preferFlashCheck","kind","html5_event","oFn","e","s","_s","_a","_wD","h5","mimePattern","useAltURL","swfBox","swfDefault","swfError","swfTimedout","swfUnblocked","sm2Debug","highPerf","flashDebug","hasHTML5","canPlayType","noURL","globalHTML5","ignoreMobile","mobileUA","beginDelayedInit","readyState","getMovie","movie_id","oOptions","_url","cs","cs_string","oSound","charAt","make","_setup_html5","_createSound","connected","destroySound","sID","_bFromSound","oS","_iO","unload","splice","onPosition","nPosition","oMethod","oScope","clearOnPosition","overloaded","allowOverride","setPosition","nMsecOffset","stopAll","pauseAll","resumeAll","togglePause","setPan","nPan","setVolume","nVol","j","isNaN","mute","muteAll","unmute","unmuteAll","toggleMute","getMemoryUse","ram","_getMemoryUse","disable","bNoDisable","canPlayMIME","sMIME","canPlayURL","sURL","canPlayLink","oLink","getSoundById","_suppressDebug","onready","sType","ontimeout","_writeDebug","sText","sTypeOrObject","o","oItem","className","style","fontWeight","color","firstChild","alert","_debug","reboot","resetEvents","excludeInit","k","innerHTML","parentNode","fired","reset","getMoviePercent","PercentLoaded","resetProperties","add_html5_events","remove_html5_events","stop_html5_timer","start_html5_timer","attachOnPosition","detachOnPosition","applyFromTo","lastHTML5State","urlOmitted","onplay_called","onPositionItems","onPositionFired","lastURL","time","instanceOptions","isHTML5","id3","playState","_called_load","_html5_canplay","autobuffer","preload","_load","fatal","_unload","_bFromSM","_destroySound","_updatePlayState","fN","audioClone","onended","oncanplay","startOK","getAutoPlay","setAutoPlay","substr","lastIndexOf","instanceCount","_oncanplay","_onfinish","currentTime","err","add","_start","onplayerror","bAll","originalPosition","_onbufferchange","_resetOnPosition","_onTimer","_stop","_setAutoPlay","normalizedRate","message","position1K","offset","toFixed","_setPosition","_bCallFlash","_pause","bInstanceOnly","_setPan","_bInstanceOnly","_setVolume","hasIO","method","scope","_processOnPosition","item","op","retainPosition","_hasTimer","bytesLoaded","bytesTotal","durationEstimate","buffered","right","failures","isBuffering","bForce","isNew","_get_html5_duration","_whileplaying","d","Infinity","_apply_loop","nLoops","sameURL","dURL","decodeURI","_added_events","oEvt","_onload","nSuccess","loadOK","_onerror","errorCode","nIsBuffering","_onsuspend","onsuspend","_onfailure","msg","level","code","_onwarning","onwarning","io_onfinish","_whileloading","nBytesLoaded","nBytesTotal","nDuration","nBufferLength","floor","bufferLength","oPeakData","oWaveformDataLeft","oWaveformDataRight","oEQData","eqLeft","leftPeak","rightPeak","leftEQ","rightEQ","_oncaptiondata","oData","captiondata","oncaptiondata","_onmetadata","oMDProps","oMDData","onmetadata","_onid3","oID3Props","oID3Data","_onconnect","bSuccess","_ondataerror","sError","body","getElementsByTagName","getElementById","oMain","oAdd","o2","o1","callback","oParent","hasParent","bonusOptions","old","evt","getArgs","oArgs","len","pop","element","shift","abort","canplay","ee","canplaythrough","durationchange","ended","loadeddata","_loaded","loadedmetadata","loadstart","fromCharCode","progress","progStr","isProgress","ranges","total","ratechange","suspend","stalled","timeupdate","waiting","iO","oAudio","_called_unload","fileExt","mime","aF","lookup","support","cp","canPlay","isOK","notReady","notOK","domError","spcWmode","swf404","tryDebug","checkSWF","localFail","waitFocus","waitForever","waitSWF","needFunction","badID","currentObj","waitOnload","docLoaded","onloadOK","secNote","badRemove","shutdown","smError","fbTimeout","fbLoaded","fbHandler","manURL","onURL","badFV","as2loop","noNSLoop","needfl9","mfTimeout","needFlash","gotFocus","policy","setupError","setupUndef","setupLate","sm2Loaded","sstr","sOpt","sPre","sMsg","warn","oProp","Date","getTime","isDebug","bPolling","bHighPerformance","_setPolling","oD","oDebug","oTarget","oToggle","tmp","lineHeight","margin","textAlign","border","cursor","background","zIndex","onclick","display","e2","errorLevel","oT","sEventType","sMessage","sm2Debugger","handleEvent","p","ignoreInit","status","success","srcQueue","canRetry","obj","nP","hasPlugin","AX","ActiveXObject","plugins","mimeTypes","enabledPlugin","flashNeeded","formats","urlResult","setInterval","clearInterval","_setSandboxType","sandboxType","sb","_externalInterfaceOK","swfVersion","initMsg","isRTL","oEmbed","oMovie","movieHTML","oEl","sClass","remoteURL","localURL","extraClass","param","dir","quality","bgcolor","pluginspage","hasPriority","FlashVars","setAttribute","overflow","abs","oninitmovie","loadIncomplete","cleanup","tests","_externalInterfaceTest","_disableDebug","detachEvent","attachEvent","SM2_DEFER","getInstance","smBuilder"],"mappings":"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","file":"plugins/plugin.tts.js","sourcesContent":["/**\n * Class to manage a 'chunk' (approximately a paragraph) of text on a page.\n */\nexport default class PageChunk {\n  /**\n   * @param {number} leafIndex\n   * @param {number} chunkIndex\n   * @param {string} text\n   * @param {DJVURect[]} lineRects\n   */\n  constructor(leafIndex, chunkIndex, text, lineRects) {\n    this.leafIndex = leafIndex;\n    this.chunkIndex = chunkIndex;\n    this.text = text;\n    this.lineRects = lineRects;\n  }\n\n  /**\n   * @param {string} server\n   * @param {string} bookPath\n   * @param {number} leafIndex\n   * @return {Promise<PageChunk[]>}\n   */\n  static fetch(server, bookPath, leafIndex) {\n    // jquery's ajax \"PromiseLike\" implementation is inconsistent with\n    // modern Promises, so convert it to a full promise (it doesn't forward\n    // a returned promise to the next handler in the chain, which kind of\n    // defeats the entire point of using promises to avoid \"callback hell\")\n    return new Promise((res, rej) => {\n      $.ajax({\n        type: 'GET',\n        url: `https://${server}/BookReader/BookReaderGetTextWrapper.php`,\n        dataType:'jsonp',\n        cache: true,\n        data: {\n          path: `${bookPath}_djvu.xml`,\n          page: leafIndex\n        },\n        error: rej,\n      })\n        .then(chunks => {\n          res(PageChunk._fromTextWrapperResponse(leafIndex, chunks));\n        });\n    });\n  }\n\n  /**\n   * Convert the response from BookReaderGetTextWrapper.php into a {@link PageChunk} instance\n   * @param {number} leafIndex\n   * @param {Array<[String, ...DJVURect[]]>} chunksResponse\n   * @return {PageChunk[]}\n   */\n  static _fromTextWrapperResponse(leafIndex, chunksResponse) {\n    return chunksResponse.map((c, i) => {\n      const correctedLineRects = PageChunk._fixChunkRects(c.slice(1));\n      const correctedText = PageChunk._removeDanglingHyphens(c[0]);\n      return new PageChunk(leafIndex, i, correctedText, correctedLineRects);\n    });\n  }\n\n  /**\n   * @private\n   * Sometimes the first rectangle will be ridiculously wide/tall. Find those and fix them\n   * *NOTE*: Modifies the original array and returns it.\n   * *NOTE*: This should probably be fixed on the petabox side, and then removed here\n   * Has 2 problems:\n   *  - If the rect is the last rect on the page (and hence the only rect in the array),\n   *    the rect's size isn't fixed\n   * - Because this relies on the second rect, there's a chance it won't be the right\n   *   width\n   * @param {DJVURect[]} rects\n   * @return {DJVURect[]}\n   */\n  static _fixChunkRects(rects) {\n    if (rects.length < 2) return rects;\n\n    const [firstRect, secondRect] = rects;\n    const [left, bottom, right] = firstRect;\n    const width = right - left;\n    const secondHeight = secondRect[1] - secondRect[3];\n    const secondWidth = secondRect[2] - secondRect[0];\n    const secondRight = secondRect[2];\n\n    if (width > secondWidth * 30) {\n      // Set the end to be the same\n      firstRect[2] = secondRight;\n      // And the top to be the same height\n      firstRect[3] = bottom - secondHeight;\n    }\n\n    return rects;\n  }\n\n  /**\n   * Remove \"dangling\" hyphens from read aloud text to avoid TTS stuttering\n   * @param {string} text\n   * @return {string}\n   */\n  static _removeDanglingHyphens(text) {\n    return text.replace(/-\\s+/g, '');\n  }\n}\n\n/**\n * @typedef {[number, number, number, number]} DJVURect\n * coords are in l,b,r,t order\n */\n","import PageChunk from './PageChunk.js';\n\n/**\n * Class that iterates over the page chunks of a book; caching/buffering\n * as much as possible to try to ensure a smooth experience.\n */\nexport default class PageChunkIterator {\n  /**\n   * @param {number} pageCount total number of pages\n   * @param {number} start page to start on\n   * @param {PageChunkIteratorOptions} opts\n   */\n  constructor(pageCount, start, opts) {\n    this.pageCount = pageCount;\n    this.opts = Object.assign({}, DEFAULT_OPTS, opts);\n    /** Position in the chunk sequence */\n    this._cursor = { page: start, chunk: 0 };\n    /** @type {Object<number, PageChunk[]>} leaf index -> chunks*/\n    this._bufferedPages = {};\n    /** @type {Object<number, PromiseLike<PageChunk[]>} leaf index -> chunks*/\n    this._bufferingPages = {};\n    /**\n     * @type {Promise} promise that manages cursor modifications so that they\n     * happen in order triggered as opposed to order the server responds\n     **/\n    this._cursorLock = Promise.resolve();\n  }\n\n  /**\n   * Get the next chunk\n   * @return {PromiseLike<\"__PageChunkIterator.AT_END__\" | PageChunk>}\n   */\n  next() {\n    return this._cursorLock = this._cursorLock\n      .then(() => this._nextUncontrolled());\n  }\n\n  /**\n   * Sends the cursor back 1\n   * @return {Promise}\n   **/\n  decrement() {\n    return this._cursorLock = this._cursorLock\n      .then(() => this._decrementUncontrolled());\n  }\n\n  /**\n   * Gets without ensuring synchronization. Since this iterator has a lot of async\n   * code, calling e.g. \"next\" twice (before the first call to next has finished)\n   * would cause the system to be in a weird state. To avoid that, we make sure calls\n   * to next and decrement (functions that modify the cursor) are synchronized,\n   * so that regardless how long it takes for one to respond, they'll always be executed\n   * in the correct order.\n   * @return {PromiseLike<\"__PageChunkIterator.AT_END__\" | PageChunk>}\n   */\n  _nextUncontrolled() {\n    if (this._cursor.page == this.pageCount) {\n      return Promise.resolve(PageChunkIterator.AT_END);\n    }\n\n    this._recenterBuffer(this._cursor.page);\n\n    return this._fetchPageChunks(this._cursor.page)\n      .then(chunks => {\n        if (this._cursor.chunk == chunks.length) {\n          this._cursor.page++;\n          this._cursor.chunk = 0;\n          return this._nextUncontrolled();\n        }\n        return chunks[this._cursor.chunk++];\n      });\n  }\n\n  /**\n   * Decrements without ensuring synchronization. (See {@link PageChunkIterator._nextUncontrolled});\n   * @return {Promise}\n   */\n  _decrementUncontrolled() {\n    let cursorChangePromise = Promise.resolve();\n\n    if (this._cursor.chunk > 0) {\n      this._cursor.chunk--;\n    } else if (this._cursor.page > 0) {\n      this._cursor.page--;\n      // Go back possibly multiple pages, because pages can be blank\n      cursorChangePromise = this._fetchPageChunks(this._cursor.page)\n        .then(prevPageChunks => {\n          if (prevPageChunks.length == 0) return this._decrementUncontrolled();\n          else this._cursor.chunk = prevPageChunks.length - 1;\n        });\n    }\n\n    return cursorChangePromise\n      .then(() => this._fetchPageChunks(this._cursor.page));\n  }\n\n  /**\n   * Recenter the buffer around the provided page index\n   * @param {number} index\n   */\n  _recenterBuffer(index) {\n    const start = Math.max(0, index - this.opts.pageBufferSize);\n    const end = Math.min(this.pageCount, index + this.opts.pageBufferSize + 1);\n    for (let i = start; i < end; i++) {\n      this._fetchPageChunks(i);\n    }\n\n    this._removePageFromBuffer(start - 1);\n    this._removePageFromBuffer(end + 1);\n  }\n\n  /**\n   * @param {number} index\n   */\n  _removePageFromBuffer(index) {\n    delete this._bufferingPages[index];\n    delete this._bufferedPages[index];\n  }\n\n  /**\n   * Fetches the chunks on a page; checks the buffer, so it won't make unnecessary\n   * requests if it's called multiple times for the same index.\n   * @param {number} index\n   * @return {Promise<PageChunk[]>}\n   */\n  _fetchPageChunks(index) {\n    if (index in this._bufferingPages) return this._bufferingPages[index];\n    if (index in this._bufferedPages) return Promise.resolve(this._bufferedPages[index]);\n\n    this._bufferingPages[index] = this._fetchPageChunksDirect(index)\n      .then(chunks => {\n        delete this._bufferingPages[index];\n        this._bufferedPages[index] = chunks;\n        return chunks;\n      });\n\n    return this._bufferingPages[index];\n  }\n\n  /**\n   * Fetches a page without checking buffer\n   * @param {number} index\n   */\n  _fetchPageChunksDirect(index) {\n    return PageChunk.fetch(this.opts.server, this.opts.bookPath, index);\n  }\n}\n\nPageChunkIterator.AT_END = \"__PageChunkIterator.AT_END__\";\n\n/** @type {PageChunkIteratorOptions} */\nconst DEFAULT_OPTS = {\n  server: null,\n  bookPath: null,\n  pageBufferSize: 2,\n};\n\n/**\n * @typedef {Object} PageChunkIteratorOptions\n * @property {string} server\n * @property {string} bookPath\n * @property {number} [pageBufferSize] number of pages to buffer before/after the current page\n */\n","import PageChunkIterator from './PageChunkIterator.js';\n/** @typedef {import('./utils.js').ISO6391} ISO6391 */\n/** @typedef {import('./PageChunk.js')} PageChunk */\n\n/**\n * @export\n * @typedef {Object} TTSEngineOptions\n * @property {String} server\n * @property {String} bookPath\n * @property {ISO6391} bookLanguage\n * @property {Function} onLoadingStart\n * @property {Function} onLoadingComplete\n * @property {Function} onDone called when the entire book is done\n * @property {function(PageChunk): PromiseLike} beforeChunkPlay will delay the playing of the chunk\n * @property {function(PageChunk): void} afterChunkPlay fires once a chunk has fully finished\n */\n\n/**\n * @typedef {Object} AbstractTTSSound\n * @property {PageChunk} chunk\n * @property {boolean} loaded\n * @property {number} rate\n * @property {SpeechSynthesisVoice} voice\n * @property {(callback: Function) => void} load\n * @property {() => PromiseLike} play\n * @property {() => Promise} stop\n * @property {() => void} pause\n * @property {() => void} resume\n * @property {() => void} finish force the sound to 'finish'\n * @property {number => void} setPlaybackRate\n **/\n\n/** Handling bookreader's text-to-speech */\nexport default class AbstractTTSEngine {\n  /**\n   * @protected\n   * @param {TTSEngineOptions} options\n   */\n  constructor(options) {\n    this.playing = false;\n    this.paused = false;\n    this.opts = options;\n    /** @type {PageChunkIterator} */\n    this._chunkIterator = null;\n    /** @type {AbstractTTSSound} */\n    this.activeSound = null;\n    this.playbackRate = 1;\n    /** Events we can bind to */\n    this.events = $({});\n    /** @type {SpeechSynthesisVoice} */\n    this.voice = null;\n    // Listen for voice changes (fired by subclasses)\n    this.events.on('voiceschanged', () => {\n      this.voice = AbstractTTSEngine.getBestBookVoice(this.getVoices(), this.opts.bookLanguage);\n    });\n    this.events.trigger('voiceschanged');\n  }\n\n  /**\n   * @abstract\n   * @return {boolean}\n   */\n  static isSupported() { throw new Error(\"Unimplemented abstract class\"); }\n\n  /**\n   * @abstract\n   * @return {SpeechSynthesisVoice[]}\n   */\n  getVoices() { throw new Error(\"Unimplemented abstract class\"); }\n\n  /** @abstract */\n  init() { return null; }\n\n  /**\n   * @param {number} leafIndex\n   * @param {number} numLeafs total number of leafs in the current book\n   */\n  start(leafIndex, numLeafs) {\n    this.playing = true;\n    this.opts.onLoadingStart();\n\n    this._chunkIterator = new PageChunkIterator(numLeafs, leafIndex, {\n      server: this.opts.server,\n      bookPath: this.opts.bookPath,\n      pageBufferSize: 5,\n    });\n\n    this.step();\n    this.events.trigger('start');\n  }\n\n  stop() {\n    if (this.activeSound) this.activeSound.stop();\n    this.playing = false;\n    this._chunkIterator = null;\n    this.activeSound = null;\n    this.events.trigger('stop');\n  }\n\n  /** @public */\n  pause() {\n    const fireEvent = !this.paused && this.activeSound;\n    this.paused = true;\n    if (this.activeSound) this.activeSound.pause();\n    if (fireEvent) this.events.trigger('pause');\n  }\n\n  /** @public */\n  resume() {\n    const fireEvent = this.paused && this.activeSound;\n    this.paused = false;\n    if (this.activeSound) this.activeSound.resume();\n    if (fireEvent) this.events.trigger('resume');\n  }\n\n  togglePlayPause() {\n    if (this.paused) this.resume();\n    else this.pause();\n  }\n\n  /** @public */\n  jumpForward() {\n    if (this.activeSound) this.activeSound.finish();\n  }\n\n  /** @public */\n  jumpBackward() {\n    Promise.all([\n      this.activeSound.stop(),\n      this._chunkIterator.decrement()\n        .then(() => this._chunkIterator.decrement())\n    ])\n      .then(() => this.step());\n  }\n\n  /** @param {number} newRate */\n  setPlaybackRate(newRate) {\n    this.playbackRate = newRate;\n    if (this.activeSound) this.activeSound.setPlaybackRate(newRate);\n  }\n\n  /** @private */\n  step() {\n    this._chunkIterator.next()\n      .then(chunk => {\n        if (chunk == PageChunkIterator.AT_END) {\n          this.stop();\n          this.opts.onDone();\n          return;\n        }\n\n        this.opts.onLoadingStart();\n        const sound = this.createSound(chunk);\n        sound.chunk = chunk;\n        sound.rate = this.playbackRate;\n        sound.voice = this.voice;\n        sound.load(() => this.opts.onLoadingComplete());\n\n        this.opts.onLoadingComplete();\n        return this.opts.beforeChunkPlay(chunk).then(() => sound);\n      })\n      .then(sound => {\n        if (!this.playing) return;\n\n        const playPromise = this.playSound(sound)\n          .then(() => this.opts.afterChunkPlay(sound.chunk));\n        if (this.paused) this.pause();\n        return playPromise;\n      })\n      .then(() => {\n        if (this.playing) return this.step();\n      });\n  }\n\n  /**\n   * @abstract\n   * @param {PageChunk} chunk\n   * @return {AbstractTTSSound}\n   */\n  createSound(chunk) { throw new Error(\"Unimplemented abstract class\"); }\n\n  /**\n   * @param {AbstractTTSSound} sound\n   * @return {PromiseLike} promise called once playing finished\n   */\n  playSound(sound) {\n    this.activeSound = sound;\n    if (!this.activeSound.loaded) this.opts.onLoadingStart();\n    return this.activeSound.play();\n  }\n\n  /** Convenience wrapper for {@see AbstractTTSEngine.getBestVoice} */\n  getBestVoice() {\n    return AbstractTTSEngine.getBestBookVoice(this.getVoices(), this.opts.bookLanguage);\n  }\n\n  /**\n   * @private\n   * Find the best voice to use given the available voices, the book language, and the user's\n   * languages.\n   * @param {SpeechSynthesisVoice[]} voices\n   * @param {ISO6391} bookLanguage\n   * @param {string[]} userLanguages languages in BCP47 format (e.g. en-US). Ordered by preference.\n   * @return {SpeechSynthesisVoice | undefined}\n   */\n  static getBestBookVoice(voices, bookLanguage, userLanguages = navigator.languages) {\n    const bookLangVoices = voices.filter(v => v.lang.startsWith(bookLanguage));\n    // navigator.languages browser support isn't great yet, so get just 1 langauge otherwise\n    // Sample navigator.languages: [\"en-CA\", \"fr-CA\", \"fr\", \"en-US\", \"en\", \"de-DE\", \"de\"]\n    userLanguages = userLanguages || (navigator.language ? [navigator.language] : []);\n\n    // user languages that match the book language\n    const matchingUserLangs = userLanguages.filter(lang => lang.startsWith(bookLanguage));\n\n    // Try to find voices that intersect these two sets\n    return AbstractTTSEngine.getMatchingVoice(matchingUserLangs, bookLangVoices) ||\n        // no user languages match the books; let's return the best voice for the book language\n        (bookLangVoices.find(v => v.default) || bookLangVoices[0])\n        // No voices match the book language? let's find a voice in the user's langauge\n        // and ignore book lang\n        || AbstractTTSEngine.getMatchingVoice(userLanguages, voices)\n        // C'mon! Ok, just read with whatever we got!\n        || (voices.find(v => v.default) || voices[0]);\n  }\n\n  /**\n     * @private\n     * Get the best voice that matches one of the BCP47 languages (order by preference)\n     * @param {string[]} languages in BCP 47 format (e.g. 'en-US', or 'en'); ordered by preference\n     * @param {SpeechSynthesisVoice[]} voices voices to choose from\n     * @return {SpeechSynthesisVoice | undefined}\n     */\n  static getMatchingVoice(languages, voices) {\n    for (const lang of languages) {\n      // Chrome Android was returning voice languages like `en_US` instead of `en-US`\n      const matchingVoices = voices.filter(v => v.lang.replace('_', '-').startsWith(lang));\n      if (matchingVoices.length) {\n        return matchingVoices.find(v => v.default) || matchingVoices[0];\n      }\n    }\n  }\n}\n","import langs from 'iso-language-codes/js/data.js';\n\n/**\n * Convert a EventTarget style event into a promise\n * @param {EventTarget} target\n * @param {string} eventType\n * @return {Promise<Event>}\n */\nexport function promisifyEvent(target, eventType) {\n  return new Promise(res => {\n    const resolver = ev => {\n      target.removeEventListener(eventType, resolver);\n      res(ev);\n    };\n    target.addEventListener(eventType, resolver);\n  });\n}\n\n/**\n * Use regex to approximate word count in a string\n * @param {string} text\n * @return {number}\n */\nexport function approximateWordCount(text) {\n  const m = text.match(/\\S+/g);\n  return m ? m.length : 0;\n}\n\n/**\n * Waits the provided number of ms and then resolves with a promise\n * @param {number} ms\n * @return {Promise}\n */\nexport function sleep(ms) {\n  return new Promise(res => setTimeout(res, ms));\n}\n\n/**\n * Checks whether the current browser is on android\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isAndroid(userAgent = navigator.userAgent) {\n  return /android/i.test(userAgent);\n}\n\n/**\n * @typedef {string} ISO6391\n * Language code in ISO 639-1 format. e.g. en, fr, zh\n **/\n\n/** Each lang is an array, with each index mapping to a different property */\nconst COLUMN_TO_LANG_INDEX = {\n  'Name': 0,\n  'Endonym': 1,\n  'ISO 639-1': 2,\n  'ISO 639-2/T': 3,\n  'ISO 639-2/B': 4\n};\n\n/**\n * @param {string} language in some format\n * @return {ISO6391?}\n */\nexport function toISO6391(language) {\n  if (!language) return null;\n  language = language.toLowerCase();\n\n  return searchForISO6391(language, ['ISO 639-1']) ||\n    searchForISO6391(language, ['ISO 639-2/B']) ||\n    searchForISO6391(language, ['ISO 639-2/T', 'Endonym', 'Name']);\n}\n\n/**\n * Searches for the given long in the given columns.\n * @param {string} language\n * @param {Array<keyof COLUMN_TO_LANG_INDEX>} columnsToSearch\n * @return {ISO6391?}\n */\nfunction searchForISO6391(language, columnsToSearch) {\n  for (let i = 0; i < langs.length; i++) {\n    for (let colI = 0; colI < columnsToSearch.length; colI++) {\n      const column = columnsToSearch[colI];\n      const columnValue = langs[i][COLUMN_TO_LANG_INDEX[column]];\n      if (columnValue.split(', ').map(x => x.toLowerCase()).indexOf(language) != -1) {\n        return langs[i][COLUMN_TO_LANG_INDEX['ISO 639-1']];\n      }\n    }\n  }\n  return null;\n}\n","import AbstractTTSEngine from './AbstractTTSEngine.js';\nimport { sleep } from './utils.js';\n/* global soundManager */\nimport 'soundmanager2';\nimport 'jquery.browser';\n\n/** @typedef {import(\"./AbstractTTSEngine.js\").TTSEngineOptions} TTSEngineOptions */\n/** @typedef {import(\"./AbstractTTSEngine.js\").AbstractTTSSound} AbstractTTSSound */\n\n/**\n * @extends AbstractTTSEngine\n * TTS using Festival endpoint\n **/\nexport default class FestivalTTSEngine extends AbstractTTSEngine {\n  /** @override */\n  static isSupported() {\n    return typeof(soundManager) !== 'undefined' && soundManager.supported();\n  }\n\n  /** @param {TTSEngineOptions} options */\n  constructor(options) {\n    super(options);\n    // $.browsers is sometimes undefined on some Android browsers :/\n    // Likely related to when $.browser was moved to npm\n    /** @type {'mp3' | 'ogg'} format of audio to get */\n    this.audioFormat = $.browser?.mozilla ? 'ogg' : 'mp3';\n  }\n\n  /** @override */\n  getVoices() {\n    return [\n      { default: true, lang: \"en-US\", localService: false, name: \"Festival - English (US)\", voiceURI: null }\n    ];\n  }\n\n  /** @override */\n  init() {\n    // setup sound manager\n    soundManager.setup({\n      debugMode: false,\n      // Note, there's a bug in Chrome regarding range requests.\n      // Flash is used as a workaround.\n      // See https://bugs.chromium.org/p/chromium/issues/detail?id=505707\n      preferFlash: true,\n      url: '/bookreader/BookReader/soundmanager/swf',\n      useHTML5Audio: true,\n      //flash 8 version of swf is buggy when calling play() on a sound that is still loading\n      flashVersion: 9\n    });\n  }\n\n  /**\n   * @override\n   * @param {number} leafIndex\n   * @param {number} numLeafs total number of leafs in the current book\n   */\n  start(leafIndex, numLeafs) {\n    let promise = null;\n\n    // Hack for iOS\n    if (navigator.userAgent.match(/mobile/i)) {\n      promise = this.iOSCaptureUserIntentHack();\n    }\n\n    promise = promise || Promise.resolve();\n    promise.then(() => super.start(leafIndex, numLeafs));\n  }\n\n  /** @override */\n  createSound(chunk) {\n    return new FestivalTTSSound(this.getSoundUrl(chunk.text));\n  }\n\n  /**\n   * @private\n   * Get URL for audio that says this text\n   * @param {String} dataString the thing to say\n   * @return {String} url\n   */\n  getSoundUrl(dataString) {\n    return 'https://' + this.opts.server + '/BookReader/BookReaderGetTTS.php?string='\n                  + encodeURIComponent(dataString)\n                  + '&format=.' + this.audioFormat;\n  }\n\n  /**\n   * @private\n   * Security restrictions require playback to be triggered\n   * by a user click/touch. This intention gets lost in the async calls\n   * on iOS, but, for some reason, if we start the audio here, it works.\n   * See https://stackoverflow.com/questions/12206631/html5-audio-cant-play-through-javascript-unless-triggered-manually-once\n   * @return {PromiseLike}\n   */\n  iOSCaptureUserIntentHack() {\n    const sound = soundManager.createSound({ url: SILENCE_1MS[this.audioFormat] });\n    return new Promise(res => sound.play({onfinish: res}))\n      .then(() => sound.destruct());\n  }\n}\n\n/** @extends AbstractTTSSound */\nclass FestivalTTSSound {\n  /** @param {string} soundUrl **/\n  constructor(soundUrl) {\n    this.soundUrl = soundUrl;\n    /** @type {SMSound} */\n    this.sound = null;\n    this.rate = 1;\n    /** @type {function} calling this resolves the \"play\" promise */\n    this._finishResolver = null\n  }\n\n  get loaded() {\n    return this.sound && this.sound.loaded;\n  }\n\n  load(onload) {\n    this.sound = soundManager.createSound({\n      url: this.soundUrl,\n      // API recommended, but only fires once play started on safari\n      onload: () => {\n        if (this.rate != 1) this.sound.setPlaybackRate(this.rate);\n        onload();\n      },\n      onresume: () => {\n        sleep(25).then(() => {\n          if (this.rate != 1) this.sound.setPlaybackRate(this.rate);\n        });\n      }\n    });\n    return this.sound.load();\n  }\n\n  play() {\n    return new Promise(res => {\n      this._finishResolver = res;\n      this.sound.play({ onfinish: res });\n    })\n      .then(() => this.sound.destruct());\n  }\n\n  /** @override */\n  stop() {\n    this.sound.stop();\n    return Promise.resolve();\n  }\n\n  /** @override */\n  pause() { this.sound.pause(); }\n  /** @override */\n  resume() { this.sound.resume(); }\n  /** @override */\n  setPlaybackRate(rate) {\n    this.rate = rate;\n    this.sound.setPlaybackRate(rate);\n  }\n\n  /** @override */\n  finish() {\n    this.sound.stop();\n    this._finishResolver();\n  }\n}\n\n/** Needed to capture the audio context for iOS hack. Generated using Audacity. */\nconst SILENCE_1MS = {\n  mp3: 'data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAAAeTEFNRTMuOTlyBJwAAAAAAAAAADUgJAaUQQABrgAAAnHIf8sZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADwlwBKGAAACAAAD/AAAAEAAAAH///////////////+UBAMExBTUUzLjk5LjOqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDEIAPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==',\n  ogg: 'data:audio/ogg;base64,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',\n};\n","/* global BookReader */\n/**\n * Plugin for Text to Speech in BookReader\n */\nimport FestivalTTSEngine from './FestivalTTSEngine.js';\nimport WebTTSEngine from './WebTTSEngine.js';\nimport { toISO6391, approximateWordCount } from './utils.js';\nimport { en as tooltips } from './tooltip_dict.js';\n/** @typedef {import('./PageChunk.js')} PageChunk */\n/** @typedef {import(\"./AbstractTTSEngine.js\")} AbstractTTSEngine */\n\n// Default options for TTS\njQuery.extend(BookReader.defaultOptions, {\n  server: 'ia600609.us.archive.org',\n  bookPath: '',\n  enableTtsPlugin: true,\n});\n\n// Extend the constructor to add TTS properties\nBookReader.prototype.setup = (function (super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    if (this.options.enableTtsPlugin) {\n      this.ttsHilites = [];\n      let TTSEngine = WebTTSEngine.isSupported() ? WebTTSEngine :\n        FestivalTTSEngine.isSupported() ? FestivalTTSEngine :\n          null;\n\n      if (/_forceTTSEngine=(festival|web)/.test(location.toString())) {\n        const engineName = location.toString().match(/_forceTTSEngine=(festival|web)/)[1];\n        TTSEngine = { festival: FestivalTTSEngine, web: WebTTSEngine }[engineName];\n      }\n\n      if (TTSEngine) {\n        /** @type {AbstractTTSEngine} */\n        this.ttsEngine = new TTSEngine({\n          server: options.server,\n          bookPath: options.bookPath,\n          bookLanguage: toISO6391(options.bookLanguage),\n          onLoadingStart: this.showProgressPopup.bind(this, 'Loading audio...'),\n          onLoadingComplete: this.removeProgressPopup.bind(this),\n          onDone: this.ttsStop.bind(this),\n          beforeChunkPlay: this.ttsBeforeChunkPlay.bind(this),\n          afterChunkPlay: this.ttsSendChunkFinishedAnalyticsEvent.bind(this),\n        });\n      }\n    }\n  };\n})(BookReader.prototype.setup);\n\nBookReader.prototype.init = (function(super_) {\n  return function() {\n    if (this.options.enableTtsPlugin) {\n      // Bind to events\n\n      // TODO move this to BookReader.js or something\n      this.bind(BookReader.eventNames.fragmentChange, () => {\n        if (this.mode == this.constMode2up) {\n          // clear highlights if they're no longer valid for this page\n          const visibleIndices = [this.twoPage.currentIndexL, this.twoPage.currentIndexR];\n          const visibleSelector = visibleIndices.map(i => `.BRReadAloudHilite.Leaf-${i}`).join(', ');\n          $(this.ttsHilites).filter(visibleSelector).show();\n          $(this.ttsHilites).not(visibleSelector).hide();\n        }\n      });\n\n      this.bind(BookReader.eventNames.PostInit, () => {\n        this.$('.BRicon.read').click(() => {\n          this.ttsToggle();\n          return false;\n        });\n        if (this.ttsEngine) {\n          this.ttsEngine.init();\n          if (/[?&]_autoReadAloud=show/.test(location.toString())) {\n            this.ttsStart(false); // false flag is to initiate read aloud controls\n          }\n        }\n      });\n\n      // This is fired when the hash changes by one of the other plugins!\n      // i.e. it will fire every time the page changes -_-\n      // this.bind(BookReader.eventNames.stop, function(e, br) {\n      //     this.ttsStop();\n      // }.bind(this));\n    }\n    super_.call(this);\n  };\n})(BookReader.prototype.init);\n\n\n// Extend buildMobileDrawerElement\nBookReader.prototype.buildMobileDrawerElement = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (this.options.enableTtsPlugin && this.ttsEngine) {\n      $el.find('.BRmobileMenu__moreInfoRow').after($(`\n        <li>\n            <span>\n                <span class=\"DrawerIconWrapper\"><img class=\"DrawerIcon\" src=\"${this.imagesBaseURL}icon_speaker_open.svg\" alt=\"info-speaker\"/></span>\n                Read Aloud\n            </span>\n            <div>\n                <span class=\"larger\">Press to toggle read aloud</span>\n                <br/>\n                <button class=\"BRicon read\"></button>\n            </div>\n        </li>`));\n    }\n    return $el;\n  };\n})(BookReader.prototype.buildMobileDrawerElement);\n\n// Extend initNavbar\nBookReader.prototype.initNavbar = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (this.options.enableTtsPlugin && this.ttsEngine) {\n      this.refs.$BRReadAloudToolbar = $(`\n        <ul class=\"read-aloud\">\n          <li>\n            <select class=\"playback-speed\" name=\"playback-speed\" title=\"${tooltips.playbackSpeed}\">\n              <option value=\"0.25\">0.25x</option>\n              <option value=\"0.5\">0.5x</option>\n              <option value=\"0.75\">0.75x</option>\n              <option value=\"1.0\" selected>1.0x</option>\n              <option value=\"1.25\">1.25x</option>\n              <option value=\"1.5\">1.5x</option>\n              <option value=\"1.75\">1.75x</option>\n              <option value=\"2\">2x</option>\n            </select>\n          </li>\n          <li>\n            <button type=\"button\" name=\"review\" title=\"${tooltips.review}\">\n              <div class=\"icon icon-review\"></div>\n            </button>\n          </li>\n          <li>\n            <button type=\"button\" name=\"play\" title=\"${tooltips.play}\">\n              <div class=\"icon icon-play\"></div>\n              <div class=\"icon icon-pause\"></div>\n            </button>\n          </li>\n          <li>\n            <button type=\"button\" name=\"advance\" title=\"${tooltips.advance}\">\n              <div class=\"icon icon-advance\"></div>\n            </button>\n          </li>\n        </ul>\n      `);\n      $el.find('.BRcontrols').prepend(this.refs.$BRReadAloudToolbar);\n      this.ttsEngine.events.on('pause resume start', () => this.ttsUpdateState());\n      this.refs.$BRReadAloudToolbar.find('[name=play]').click(this.ttsPlayPause.bind(this));\n      this.refs.$BRReadAloudToolbar.find('[name=advance]').click(this.ttsJumpForward.bind(this));\n      this.refs.$BRReadAloudToolbar.find('[name=review]').click(this.ttsJumpBackward.bind(this));\n      const $rateSelector = this.refs.$BRReadAloudToolbar.find('select[name=\"playback-speed\"]');\n      $rateSelector.change(ev => this.ttsEngine.setPlaybackRate(parseFloat($rateSelector.val())));\n      $(`<li>\n          <button class=\"BRicon read js-tooltip\" title=\"${tooltips.readAloud}\">\n            <div class=\"icon icon-read-aloud\"></div>\n            <span class=\"tooltip\">${tooltips.readAloud}</span>\n          </button>\n        </li>`).insertBefore($el.find('.BRcontrols .BRicon.zoom_out').closest('li'));\n    }\n    return $el;\n  };\n})(BookReader.prototype.initNavbar);\n\n// ttsToggle()\n//______________________________________________________________________________\nBookReader.prototype.ttsToggle = function () {\n  if (this.autoStop) this.autoStop();\n  if (this.ttsEngine.playing) {\n    this.ttsStop();\n  } else {\n    this.ttsStart();\n  }\n};\n\n// ttsStart(\n//______________________________________________________________________________\nBookReader.prototype.ttsStart = function (startTTSEngine = true) {\n  if (this.constModeThumb == this.mode)\n    this.switchMode(this.constMode1up);\n\n  this.refs.$BRReadAloudToolbar.addClass('visible');\n  this.$('.BRicon.read').addClass('unread active');\n  this.ttsSendAnalyticsEvent('Start');\n  if (startTTSEngine)\n    this.ttsEngine.start(this.currentIndex(), this.getNumLeafs());\n};\n\nBookReader.prototype.ttsJumpForward = function () {\n  if (this.ttsEngine.paused) {\n    this.ttsEngine.resume();\n  }\n  this.ttsEngine.jumpForward();\n};\n\nBookReader.prototype.ttsJumpBackward = function () {\n  if (this.ttsEngine.paused) {\n    this.ttsEngine.resume();\n  }\n  this.ttsEngine.jumpBackward();\n};\n\nBookReader.prototype.ttsUpdateState = function() {\n  const isPlaying = !(this.ttsEngine.paused || !this.ttsEngine.playing);\n  this.$('.read-aloud [name=play]').toggleClass('playing', isPlaying);\n};\n\nBookReader.prototype.ttsPlayPause = function() {\n  if (!this.ttsEngine.playing) {\n    this.ttsToggle();\n  } else {\n    this.ttsEngine.togglePlayPause();\n    this.ttsUpdateState(this.ttsEngine.paused);\n  }\n};\n\n// ttsStop()\n//______________________________________________________________________________\nBookReader.prototype.ttsStop = function () {\n  this.refs.$BRReadAloudToolbar.removeClass('visible');\n  this.$('.BRicon.read').removeClass('unread active');\n  this.ttsSendAnalyticsEvent('Stop');\n  this.ttsEngine.stop();\n  this.ttsRemoveHilites();\n  this.removeProgressPopup();\n};\n\n/**\n * @param {PageChunk} chunk\n * @return {PromiseLike<void>} returns once the flip is done\n */\nBookReader.prototype.ttsBeforeChunkPlay = function(chunk) {\n  return this.ttsMaybeFlipToIndex(chunk.leafIndex)\n    .then(() => {\n      this.ttsHighlightChunk(chunk);\n      this.ttsScrollToChunk(chunk);\n    });\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsSendChunkFinishedAnalyticsEvent = function(chunk) {\n  this.ttsSendAnalyticsEvent('ChunkFinished-Words', approximateWordCount(chunk.text));\n};\n\n/**\n * Flip the page if the provided leaf index is not visible\n * @param {Number} leafIndex\n * @return {PromiseLike<void>} resolves once the flip animation has completed\n */\nBookReader.prototype.ttsMaybeFlipToIndex = function (leafIndex) {\n  const in2PageMode = this.constMode2up == this.mode;\n  let resolve = null;\n  const promise = new Promise(res => resolve = res);\n\n  if (!in2PageMode) {\n    this.jumpToIndex(leafIndex);\n    resolve();\n  } else {\n    const leafVisible = leafIndex == this.twoPage.currentIndexR || leafIndex == this.twoPage.currentIndexL;\n    if (leafVisible) {\n      resolve();\n    } else {\n      this.animationFinishedCallback = resolve;\n      const mustGoNext = leafIndex > Math.max(this.twoPage.currentIndexR, this.twoPage.currentIndexL);\n      if (mustGoNext) this.next();\n      else this.prev();\n      promise.then(this.ttsMaybeFlipToIndex.bind(this, leafIndex));\n    }\n  }\n\n  return promise;\n}\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHighlightChunk = function(chunk) {\n  this.ttsRemoveHilites();\n\n  if (this.constMode2up == this.mode) {\n    this.ttsHilite2UP(chunk);\n  } else {\n    this.ttsHilite1UP(chunk);\n  }\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsScrollToChunk = function(chunk) {\n  if (this.constMode1up != this.mode) return;\n\n  let leafTop = 0;\n  let h;\n  let i;\n  for (i = 0; i < chunk.leafIndex; i++) {\n    h = parseInt(this._getPageHeight(i) / this.reduce);\n    leafTop += h + this.padding;\n  }\n\n  const chunkTop = chunk.lineRects[0][3]; //coords are in l,b,r,t order\n  const chunkBot = chunk.lineRects[chunk.lineRects.length - 1][1];\n\n  const topOfFirstChunk = leafTop + chunkTop / this.reduce;\n  const botOfLastChunk  = leafTop + chunkBot / this.reduce;\n\n  if (window?.soundManager?.debugMode) console.log('leafTop = ' + leafTop + ' topOfFirstChunk = ' + topOfFirstChunk + ' botOfLastChunk = ' + botOfLastChunk);\n\n  const containerTop = this.refs.$brContainer.prop('scrollTop');\n  const containerBot = containerTop + this.refs.$brContainer.height();\n  if (window?.soundManager?.debugMode) console.log('containerTop = ' + containerTop + ' containerBot = ' + containerBot);\n\n  if ((topOfFirstChunk < containerTop) || (botOfLastChunk > containerBot)) {\n    this.refs.$brContainer.stop(true).animate({scrollTop: topOfFirstChunk},'fast');\n  }\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHilite1UP = function(chunk) {\n  for (let i = 0; i < chunk.lineRects.length; i++) {\n    //each rect is an array of l,b,r,t coords (djvu.xml ordering...)\n    const l = chunk.lineRects[i][0];\n    const b = chunk.lineRects[i][1];\n    const r = chunk.lineRects[i][2];\n    const t = chunk.lineRects[i][3];\n\n    const div = document.createElement('div');\n    this.ttsHilites.push(div);\n    $(div).prop('className', 'BookReaderSearchHilite').appendTo(\n      this.$('.pagediv' + chunk.leafIndex)\n    );\n\n    $(div).css({\n      width:  (r - l) / this.reduce + 'px',\n      height: (b - t) / this.reduce + 'px',\n      left:   l / this.reduce + 'px',\n      top:    t / this.reduce + 'px'\n    });\n  }\n\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHilite2UP = function (chunk) {\n  for (let i = 0; i < chunk.lineRects.length; i++) {\n    //each rect is an array of l,b,r,t coords (djvu.xml ordering...)\n    const l = chunk.lineRects[i][0];\n    const b = chunk.lineRects[i][1];\n    const r = chunk.lineRects[i][2];\n    const t = chunk.lineRects[i][3];\n\n    const div = document.createElement('div');\n    this.ttsHilites.push(div);\n    $(div)\n      .prop('className', 'BookReaderSearchHilite BRReadAloudHilite Leaf-' + chunk.leafIndex)\n      .css('zIndex', 3)\n      .appendTo(this.refs.$brTwoPageView);\n    this.setHilightCss2UP(div, chunk.leafIndex, l, r, t, b);\n  }\n};\n\n// ttsRemoveHilites()\n//______________________________________________________________________________\nBookReader.prototype.ttsRemoveHilites = function () {\n  $(this.ttsHilites).remove();\n  this.ttsHilites = [];\n};\n\n/**\n * @private\n * Send an analytics event with an optional value. Also attaches the book's language.\n * @param {string} action\n * @param {number} [value]\n */\nBookReader.prototype.ttsSendAnalyticsEvent = function(action, value) {\n  if (this.archiveAnalyticsSendEvent) {\n    const extraValues = {};\n    const mediaLanguage = this.ttsEngine.opts.bookLanguage;\n    if (mediaLanguage) extraValues.mediaLanguage = mediaLanguage;\n    this.archiveAnalyticsSendEvent('BRReadAloud', action, value, extraValues);\n  }\n};\n","/* global br */\nimport { isChrome, isFirefox } from '../../../util/browserSniffing.js';\nimport { sleep, promisifyEvent, isAndroid } from './utils.js';\nimport AbstractTTSEngine from './AbstractTTSEngine.js';\n/** @typedef {import(\"./AbstractTTSEngine.js\").PageChunk} PageChunk */\n/** @typedef {import(\"./AbstractTTSEngine.js\").AbstractTTSSound} AbstractTTSSound */\n/** @typedef {import(\"./AbstractTTSEngine.js\").TTSEngineOptions} TTSEngineOptions */\n\n/**\n * @extends AbstractTTSEngine\n * TTS using Web Speech APIs\n **/\nexport default class WebTTSEngine extends AbstractTTSEngine {\n  static isSupported() {\n    return typeof(window.speechSynthesis) !== 'undefined' && !/samsungbrowser/i.test(navigator.userAgent);\n  }\n\n  /** @param {TTSEngineOptions} options */\n  constructor(options) {\n    super(options);\n\n    // SAFARI doesn't have addEventListener on speechSynthesis\n    if (speechSynthesis.addEventListener) {\n      speechSynthesis.addEventListener('voiceschanged', () => this.events.trigger('voiceschanged'));\n    }\n  }\n\n  /** @override */\n  start(leafIndex, numLeafs) {\n    // Need to run in this function to capture user intent to start playing audio\n    if ('mediaSession' in navigator) {\n      const audio = new Audio(SILENCE_6S_MP3);\n      audio.loop = true;\n\n      this.events.on('pause', () => audio.pause());\n      this.events.on('resume', () => audio.play());\n      // apparently this is what you need to do to make the media session notification go away\n      // See https://developers.google.com/web/updates/2017/02/media-session#implementation_notes\n      this.events.on('stop', () => audio.src = '');\n      audio.play().then(() => {\n        navigator.mediaSession.metadata = new MediaMetadata({\n          title: br.bookTitle,\n          artist: br.options.metadata.filter(m => m.label == 'Author').map(m => m.value)[0],\n          // album: 'The Ultimate Collection (Remastered)',\n          artwork: [\n            { src: br.options.thumbnail, type: 'image/jpg' },\n          ]\n        });\n\n        navigator.mediaSession.setActionHandler('play', () => {\n          audio.play();\n          this.resume();\n        });\n        navigator.mediaSession.setActionHandler('pause', () => {\n          audio.pause();\n          this.pause();\n        });\n\n        // navigator.mediaSession.setActionHandler('seekbackward', () => this.jumpBackward());\n        // navigator.mediaSession.setActionHandler('seekforward', () => this.jumpForward());\n        // Some devices only support the previoustrack/nexttrack (e.g. Win10), so show those.\n        // Android devices do support the seek actions, but we don't want to show both buttons\n        // and have them do the same thing.\n        navigator.mediaSession.setActionHandler('previoustrack', () => this.jumpBackward());\n        navigator.mediaSession.setActionHandler('nexttrack', () => this.jumpForward());\n      });\n    }\n\n    return super.start(leafIndex, numLeafs);\n  }\n\n  /** @override */\n  getVoices() { return speechSynthesis.getVoices(); }\n\n  /** @override */\n  createSound(chunk) {\n    return new WebTTSSound(chunk.text);\n  }\n}\n\n/** @extends AbstractTTSSound */\nexport class WebTTSSound {\n  /** @param {string} text **/\n  constructor(text) {\n    this.text = text;\n    this.loaded = false;\n    this.paused = false;\n    this.started = false;\n    /** Whether the audio was stopped with a .stop() call */\n    this.stopped = false;\n    this.rate = 1;\n\n    /** @type {SpeechSynthesisUtterance} */\n    this.utterance = null;\n\n    /** @type {SpeechSynthesisVoice} */\n    this.voice = null;\n\n    this._lastEvents = {\n      /** @type {SpeechSynthesisEvent} */\n      pause: null,\n      /** @type {SpeechSynthesisEvent} */\n      boundary: null,\n      /** @type {SpeechSynthesisEvent} */\n      start: null,\n    };\n\n    /** Store where we are in the text. Only works on some browsers. */\n    this._charIndex = 0;\n\n    /** @type {Function} resolve function called when playback finished */\n    this._finishResolver = null;\n\n    /** @type {Promise} promise resolved by _finishResolver */\n    this._finishPromise = null;\n  }\n\n  /** @override **/\n  load(onload) {\n    this.loaded = false;\n    this.started = false;\n\n    this.utterance = new SpeechSynthesisUtterance(this.text.slice(this._charIndex));\n    this.utterance.voice = this.voice;\n    // Need to also set lang (for some reason); won't set voice on Chrome@Android otherwise\n    if (this.voice) this.utterance.lang = this.voice.lang;\n    this.utterance.rate = this.rate;\n\n    // Useful for debugging things\n    if (location.toString().indexOf('_debugReadAloud=true') != -1) {\n      this.utterance.addEventListener('pause', () => console.log('pause'));\n      this.utterance.addEventListener('resume', () => console.log('resume'));\n      this.utterance.addEventListener('start', () => console.log('start'));\n      this.utterance.addEventListener('end', () => console.log('end'));\n      this.utterance.addEventListener('error', () => console.log('error'));\n      this.utterance.addEventListener('boundary', () => console.log('boundary'));\n      this.utterance.addEventListener('mark', () => console.log('mark'));\n      this.utterance.addEventListener('finish', () => console.log('finish'));\n    }\n\n    // Keep track of the speech synthesis events that come in; they have useful info\n    // about progress (like charIndex)\n    this.utterance.addEventListener('start', ev => this._lastEvents.start = ev);\n    this.utterance.addEventListener('boundary', ev => this._lastEvents.boundary = ev);\n    this.utterance.addEventListener('pause', ev => this._lastEvents.pause = ev);\n\n    // Update our state\n    this.utterance.addEventListener('start', () => {\n      this.started = true;\n      this.stopped = false;\n      this.paused = false;\n    });\n    this.utterance.addEventListener('pause', () => this.paused = true);\n    this.utterance.addEventListener('resume', () => this.paused = false);\n    this.utterance.addEventListener('end', ev => {\n      if (!this.paused && !this.stopped) {\n        // Trigger a new event, finish, which only fires when audio fully completed\n        this.utterance.dispatchEvent(new CustomEvent('finish', ev));\n      }\n    });\n    this.loaded = true;\n    onload && onload();\n  }\n\n  /**\n   * Run whenever properties have changed. Tries to restart in the same spot it\n   * left off.\n   * @return {Promise<void>}\n   */\n  reload() {\n    // We'll restore the pause state, so copy it here\n    const wasPaused = this.paused;\n    // Use recent event to determine where we'll restart from\n    // Browser support for this is mixed, but it degrades to restarting the chunk\n    // and that's ok\n    const recentEvent = this._lastEvents.boundary || this._lastEvents.pause;\n    if (recentEvent) {\n      this._charIndex = this.text.indexOf(recentEvent.target.text) + recentEvent.charIndex;\n    }\n\n    // We can't modify the utterance object, so we have to make a new one\n    return this.stop()\n      .then(() => {\n        this.load();\n        // Instead of playing and immediately pausing, we don't start playing. Note\n        // this is a requirement because pause doesn't work consistently across\n        // browsers.\n        if (!wasPaused) this.play();\n      });\n  }\n\n  play() {\n    this._finishPromise = this._finishPromise || new Promise(res => this._finishResolver = res);\n    this.utterance.addEventListener('finish', this._finishResolver);\n\n    // clear the queue\n    speechSynthesis.cancel();\n    // reset pause state\n    speechSynthesis.resume();\n    // Speak\n    speechSynthesis.speak(this.utterance);\n\n    const isLocalVoice = this.utterance.voice && this.utterance.voice.localService;\n    if (isChrome() && !isLocalVoice) this._chromePausingBugFix();\n\n    return this._finishPromise;\n  }\n\n  /** @return {Promise} */\n  stop() {\n    // 'end' won't fire if already stopped\n    let endPromise = Promise.resolve();\n    if (!this.stopped) {\n      endPromise = Promise.race([\n        promisifyEvent(this.utterance, 'end'),\n        // Safari triggers an error when you call cancel mid-sound\n        promisifyEvent(this.utterance, 'error'),\n      ]);\n    }\n    this.stopped = true;\n    speechSynthesis.cancel();\n    return endPromise;\n  }\n\n  finish() {\n    this.stop().then(() => this.utterance.dispatchEvent(new Event('finish')));\n  }\n\n  /**\n   * @override\n   * Will fire a pause event unless already paused\n   **/\n  pause() {\n    if (this.paused) return;\n\n    const pausePromise = promisifyEvent(this.utterance, 'pause');\n    speechSynthesis.pause();\n\n    // There are a few awful browser cases:\n    // 1. Pause works and fires\n    // 2. Pause doesn't work and doesn't fire\n    // 3. Pause works but doesn't fire\n    const pauseMightNotWork = (isFirefox() && isAndroid());\n    const pauseMightNotFire = isChrome() || pauseMightNotWork;\n\n    if (pauseMightNotFire) {\n      // wait for it just it incase\n      const timeoutPromise = sleep(100).then(() => 'timeout');\n      Promise.race([pausePromise, timeoutPromise])\n        .then(result => {\n          // We got our pause event; nothing to do!\n          if (result != 'timeout') return;\n\n          this.utterance.dispatchEvent(new CustomEvent('pause', this._lastEvents.start));\n          // if pause might not work, then we'll stop entirely and restart later\n          if (pauseMightNotWork) this.stop();\n        });\n    }\n  }\n\n  resume() {\n    if (!this.started) {\n      this.play();\n      return;\n    }\n\n    if (!this.paused) return;\n\n    // Browser cases:\n    // 1. Resume works + fires\n    // 2. Resume works + doesn't fire (Chrome Desktop)\n    // 3. Resume doesn't work + doesn't fire (Chrome/FF Android)\n    const resumeMightNotWork = (isChrome() && isAndroid()) || (isFirefox() && isAndroid());\n    const resumeMightNotFire = isChrome() || resumeMightNotWork;\n\n    // Try resume\n    const resumePromise = promisifyEvent(this.utterance, 'resume');\n    speechSynthesis.resume();\n\n    if (resumeMightNotFire) {\n      Promise.race([resumePromise, sleep(100).then(() => 'timeout')])\n        .then(result => {\n          if (result != 'timeout') return;\n\n          this.utterance.dispatchEvent(new CustomEvent('resume', {}));\n          if (resumeMightNotWork) {\n            const reloadPromise = this.reload();\n            reloadPromise.then(() => this.play());\n          }\n        });\n    }\n  }\n\n  setPlaybackRate(rate) {\n    this.rate = rate;\n    this.reload();\n  }\n\n  /**\n   * @private\n   * Chrome has a bug where it only plays 15 seconds of TTS and then\n   * suddenly stops (see https://bugs.chromium.org/p/chromium/issues/detail?id=679437 )\n   * We avoid this (as described here: https://bugs.chromium.org/p/chromium/issues/detail?id=679437#c15 )\n   * by pausing after 14 seconds and ~instantly resuming.\n   */\n  _chromePausingBugFix() {\n    const timeoutPromise = sleep(14000).then(() => 'timeout');\n    const pausePromise = promisifyEvent(this.utterance, 'pause').then(() => 'paused');\n    const endPromise = promisifyEvent(this.utterance, 'end').then(() => 'ended');\n    return Promise.race([timeoutPromise, pausePromise, endPromise])\n      .then(result => {\n        if (location.toString().indexOf('_debugReadAloud=true') != -1) {\n          console.log(`CHROME-PAUSE-HACK: ${result}`);\n        }\n        switch (result) {\n        case 'ended':\n          // audio was stopped/finished; nothing to do\n          break;\n        case 'paused':\n          // audio was paused; wait for resume\n          // Chrome won't let you resume the audio if 14s have passed \n          // We could do the same as before (but resume+pause instead of pause+resume),\n          // but that means we'd _constantly_ be running in the background. So in that\n          // case, let's just restart the chunk\n          Promise.race([\n            promisifyEvent(this.utterance, 'resume'),\n            sleep(14000).then(() => 'timeout'),\n          ])\n            .then(result => {\n              result == 'timeout' ? this.reload() : this._chromePausingBugFix();\n            });\n          break;\n        case 'timeout':\n          // We hit Chrome's secret cut off time. Pause/resume\n          // to be able to keep TTS-ing\n          speechSynthesis.pause();\n          sleep(25)\n            .then(() => {\n              speechSynthesis.resume();\n              this._chromePausingBugFix();\n            });\n          break;\n        }\n      });\n  }\n}\n\n/**\n * According to https://developers.google.com/web/updates/2017/02/media-session#implementation_notes , it needs to be at least 5 seconds\n * long to allow usage of the media sessions api\n */\nconst SILENCE_6S_MP3 = 'data:audio/mp3;base64,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';\n","export const en = {\n  advance: 'Advance 10 seconds',\n  play: 'Play',\n  playbackSpeed: 'Playback speed',\n  readAloud: 'Read this book aloud',\n  review: 'Review 10 seconds',\n};\n\nexport const es = {\n  advance: 'Avance 10 segundos',\n  play: 'Jugar',\n  playbackSpeed: 'Velocidad de reproduccin',\n  readAloud: 'Lee este libro en voz alta',\n  review: 'Revisar 10 segundos',\n};\n","\n/**\n * Checks whether the current browser is a Chrome/Chromium browser\n * Code from https://stackoverflow.com/a/4565120/2317712\n * @param {string} [userAgent]\n * @param {string} [vendor]\n * @return {boolean}\n */\nexport function isChrome(userAgent = navigator.userAgent, vendor = navigator.vendor) {\n  return /chrome/i.test(userAgent) && /google inc/i.test(vendor);\n}\n\n/**\n * Checks whether the current browser is firefox\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isFirefox(userAgent = navigator.userAgent) {\n  return /firefox/i.test(userAgent);\n}\n\n/**\n * Checks whether the current browser is safari\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Browser_Name\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isSafari(userAgent = navigator.userAgent) {\n  return /safari/i.test(userAgent) && !/chrome|chromium/i.test(userAgent);\n}\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var called = 0;\n  var iteratorWithReturn = {\n    next: function () {\n      return { done: !!called++ };\n    },\n    'return': function () {\n      SAFE_CLOSING = true;\n    }\n  };\n  iteratorWithReturn[ITERATOR] = function () {\n    return this;\n  };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(iteratorWithReturn, function () { throw 2; });\n} catch (error) { /* empty */ }\n\nmodule.exports = function (exec, SKIP_CLOSING) {\n  if (!SKIP_CLOSING && !SAFE_CLOSING) return false;\n  var ITERATION_SUPPORT = false;\n  try {\n    var object = {};\n    object[ITERATOR] = function () {\n      return {\n        next: function () {\n          return { done: ITERATION_SUPPORT = true };\n        }\n      };\n    };\n    exec(object);\n  } catch (error) { /* empty */ }\n  return ITERATION_SUPPORT;\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nmodule.exports = /(iphone|ipod|ipad).*applewebkit/i.test(userAgent);\n","'use strict';\nvar aFunction = require('../internals/a-function');\nvar isObject = require('../internals/is-object');\n\nvar slice = [].slice;\nvar factories = {};\n\nvar construct = function (C, argsLength, args) {\n  if (!(argsLength in factories)) {\n    for (var list = [], i = 0; i < argsLength; i++) list[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');\n  } return factories[argsLength](C, args);\n};\n\n// `Function.prototype.bind` method implementation\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = slice.call(arguments, 1);\n  var boundFunction = function bound(/* args... */) {\n    var args = partArgs.concat(slice.call(arguments));\n    return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);\n  };\n  if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;\n  return boundFunction;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (a, b) {\n  var console = global.console;\n  if (console && console.error) {\n    arguments.length === 1 ? console.error(a) : console.error(a, b);\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar iteratorClose = require('../internals/iterator-close');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nmodule.exports = function (iterable, unboundFunction, options) {\n  var that = options && options.that;\n  var AS_ENTRIES = !!(options && options.AS_ENTRIES);\n  var IS_ITERATOR = !!(options && options.IS_ITERATOR);\n  var INTERRUPTED = !!(options && options.INTERRUPTED);\n  var fn = bind(unboundFunction, that, 1 + AS_ENTRIES + INTERRUPTED);\n  var iterator, iterFn, index, length, result, next, step;\n\n  var stop = function (condition) {\n    if (iterator) iteratorClose(iterator);\n    return new Result(true, condition);\n  };\n\n  var callFn = function (value) {\n    if (AS_ENTRIES) {\n      anObject(value);\n      return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);\n    } return INTERRUPTED ? fn(value, stop) : fn(value);\n  };\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = callFn(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    try {\n      result = callFn(step.value);\n    } catch (error) {\n      iteratorClose(iterator);\n      throw error;\n    }\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar macrotask = require('../internals/task').set;\nvar IS_IOS = require('../internals/engine-is-ios');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar MutationObserver = global.MutationObserver || global.WebKitMutationObserver;\nvar document = global.document;\nvar process = global.process;\nvar Promise = global.Promise;\n// Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`\nvar queueMicrotaskDescriptor = getOwnPropertyDescriptor(global, 'queueMicrotask');\nvar queueMicrotask = queueMicrotaskDescriptor && queueMicrotaskDescriptor.value;\n\nvar flush, head, last, notify, toggle, node, promise, then;\n\n// modern engines have queueMicrotask method\nif (!queueMicrotask) {\n  flush = function () {\n    var parent, fn;\n    if (IS_NODE && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (error) {\n        if (head) notify();\n        else last = undefined;\n        throw error;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339\n  if (!IS_IOS && !IS_NODE && MutationObserver && document) {\n    toggle = true;\n    node = document.createTextNode('');\n    new MutationObserver(flush).observe(node, { characterData: true });\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    promise = Promise.resolve(undefined);\n    then = promise.then;\n    notify = function () {\n      then.call(promise, flush);\n    };\n  // Node.js without promises\n  } else if (IS_NODE) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n}\n\nmodule.exports = queueMicrotask || function (fn) {\n  var task = { fn: fn, next: undefined };\n  if (last) last.next = task;\n  if (!head) {\n    head = task;\n    notify();\n  } last = task;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global.Promise;\n","'use strict';\nvar aFunction = require('../internals/a-function');\n\nvar PromiseCapability = function (C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n};\n\n// 25.4.1.5 NewPromiseCapability(C)\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar newPromiseCapability = require('../internals/new-promise-capability');\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var global = require('../internals/global');\nvar fails = require('../internals/fails');\nvar bind = require('../internals/function-bind-context');\nvar html = require('../internals/html');\nvar createElement = require('../internals/document-create-element');\nvar IS_IOS = require('../internals/engine-is-ios');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar location = global.location;\nvar set = global.setImmediate;\nvar clear = global.clearImmediate;\nvar process = global.process;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\n\nvar run = function (id) {\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\n\nvar runner = function (id) {\n  return function () {\n    run(id);\n  };\n};\n\nvar listener = function (event) {\n  run(event.data);\n};\n\nvar post = function (id) {\n  // old engines have not location.origin\n  global.postMessage(id + '', location.protocol + '//' + location.host);\n};\n\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!set || !clear) {\n  set = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      (typeof fn == 'function' ? fn : Function(fn)).apply(undefined, args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clear = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (IS_NODE) {\n    defer = function (id) {\n      process.nextTick(runner(id));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(runner(id));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  // except iOS - https://github.com/zloirock/core-js/issues/624\n  } else if (MessageChannel && !IS_IOS) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = bind(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (\n    global.addEventListener &&\n    typeof postMessage == 'function' &&\n    !global.importScripts &&\n    location && location.protocol !== 'file:' &&\n    !fails(post)\n  ) {\n    defer = post;\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in createElement('script')) {\n    defer = function (id) {\n      html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(runner(id), 0);\n    };\n  }\n}\n\nmodule.exports = {\n  set: set,\n  clear: clear\n};\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toObject = require('../internals/to-object');\nvar nativeGetPrototypeOf = require('../internals/object-get-prototype-of');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetPrototypeOf(1); });\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !CORRECT_PROTOTYPE_GETTER }, {\n  getPrototypeOf: function getPrototypeOf(it) {\n    return nativeGetPrototypeOf(toObject(it));\n  }\n});\n\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar NativePromise = require('../internals/native-promise-constructor');\nvar redefine = require('../internals/redefine');\nvar redefineAll = require('../internals/redefine-all');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar setSpecies = require('../internals/set-species');\nvar isObject = require('../internals/is-object');\nvar aFunction = require('../internals/a-function');\nvar anInstance = require('../internals/an-instance');\nvar inspectSource = require('../internals/inspect-source');\nvar iterate = require('../internals/iterate');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\nvar speciesConstructor = require('../internals/species-constructor');\nvar task = require('../internals/task').set;\nvar microtask = require('../internals/microtask');\nvar promiseResolve = require('../internals/promise-resolve');\nvar hostReportErrors = require('../internals/host-report-errors');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar InternalStateModule = require('../internals/internal-state');\nvar isForced = require('../internals/is-forced');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_NODE = require('../internals/engine-is-node');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\nvar PROMISE = 'Promise';\nvar getInternalState = InternalStateModule.get;\nvar setInternalState = InternalStateModule.set;\nvar getInternalPromiseState = InternalStateModule.getterFor(PROMISE);\nvar PromiseConstructor = NativePromise;\nvar TypeError = global.TypeError;\nvar document = global.document;\nvar process = global.process;\nvar $fetch = getBuiltIn('fetch');\nvar newPromiseCapability = newPromiseCapabilityModule.f;\nvar newGenericPromiseCapability = newPromiseCapability;\nvar DISPATCH_EVENT = !!(document && document.createEvent && global.dispatchEvent);\nvar NATIVE_REJECTION_EVENT = typeof PromiseRejectionEvent == 'function';\nvar UNHANDLED_REJECTION = 'unhandledrejection';\nvar REJECTION_HANDLED = 'rejectionhandled';\nvar PENDING = 0;\nvar FULFILLED = 1;\nvar REJECTED = 2;\nvar HANDLED = 1;\nvar UNHANDLED = 2;\nvar Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;\n\nvar FORCED = isForced(PROMISE, function () {\n  var GLOBAL_CORE_JS_PROMISE = inspectSource(PromiseConstructor) !== String(PromiseConstructor);\n  if (!GLOBAL_CORE_JS_PROMISE) {\n    // V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n    // We can't detect it synchronously, so just check versions\n    if (V8_VERSION === 66) return true;\n    // Unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    if (!IS_NODE && !NATIVE_REJECTION_EVENT) return true;\n  }\n  // We need Promise#finally in the pure version for preventing prototype pollution\n  if (IS_PURE && !PromiseConstructor.prototype['finally']) return true;\n  // We can't use @@species feature detection in V8 since it causes\n  // deoptimization and performance degradation\n  // https://github.com/zloirock/core-js/issues/679\n  if (V8_VERSION >= 51 && /native code/.test(PromiseConstructor)) return false;\n  // Detect correctness of subclassing with @@species support\n  var promise = PromiseConstructor.resolve(1);\n  var FakePromise = function (exec) {\n    exec(function () { /* empty */ }, function () { /* empty */ });\n  };\n  var constructor = promise.constructor = {};\n  constructor[SPECIES] = FakePromise;\n  return !(promise.then(function () { /* empty */ }) instanceof FakePromise);\n});\n\nvar INCORRECT_ITERATION = FORCED || !checkCorrectnessOfIteration(function (iterable) {\n  PromiseConstructor.all(iterable)['catch'](function () { /* empty */ });\n});\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\n\nvar notify = function (state, isReject) {\n  if (state.notified) return;\n  state.notified = true;\n  var chain = state.reactions;\n  microtask(function () {\n    var value = state.value;\n    var ok = state.state == FULFILLED;\n    var index = 0;\n    // variable length - can't use forEach\n    while (chain.length > index) {\n      var reaction = chain[index++];\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (state.rejection === UNHANDLED) onHandleUnhandled(state);\n            state.rejection = HANDLED;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // can throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (error) {\n        if (domain && !exited) domain.exit();\n        reject(error);\n      }\n    }\n    state.reactions = [];\n    state.notified = false;\n    if (isReject && !state.rejection) onUnhandled(state);\n  });\n};\n\nvar dispatchEvent = function (name, promise, reason) {\n  var event, handler;\n  if (DISPATCH_EVENT) {\n    event = document.createEvent('Event');\n    event.promise = promise;\n    event.reason = reason;\n    event.initEvent(name, false, true);\n    global.dispatchEvent(event);\n  } else event = { promise: promise, reason: reason };\n  if (!NATIVE_REJECTION_EVENT && (handler = global['on' + name])) handler(event);\n  else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);\n};\n\nvar onUnhandled = function (state) {\n  task.call(global, function () {\n    var promise = state.facade;\n    var value = state.value;\n    var IS_UNHANDLED = isUnhandled(state);\n    var result;\n    if (IS_UNHANDLED) {\n      result = perform(function () {\n        if (IS_NODE) {\n          process.emit('unhandledRejection', value, promise);\n        } else dispatchEvent(UNHANDLED_REJECTION, promise, value);\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      state.rejection = IS_NODE || isUnhandled(state) ? UNHANDLED : HANDLED;\n      if (result.error) throw result.value;\n    }\n  });\n};\n\nvar isUnhandled = function (state) {\n  return state.rejection !== HANDLED && !state.parent;\n};\n\nvar onHandleUnhandled = function (state) {\n  task.call(global, function () {\n    var promise = state.facade;\n    if (IS_NODE) {\n      process.emit('rejectionHandled', promise);\n    } else dispatchEvent(REJECTION_HANDLED, promise, state.value);\n  });\n};\n\nvar bind = function (fn, state, unwrap) {\n  return function (value) {\n    fn(state, value, unwrap);\n  };\n};\n\nvar internalReject = function (state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  state.value = value;\n  state.state = REJECTED;\n  notify(state, true);\n};\n\nvar internalResolve = function (state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  try {\n    if (state.facade === value) throw TypeError(\"Promise can't be resolved itself\");\n    var then = isThenable(value);\n    if (then) {\n      microtask(function () {\n        var wrapper = { done: false };\n        try {\n          then.call(value,\n            bind(internalResolve, wrapper, state),\n            bind(internalReject, wrapper, state)\n          );\n        } catch (error) {\n          internalReject(wrapper, error, state);\n        }\n      });\n    } else {\n      state.value = value;\n      state.state = FULFILLED;\n      notify(state, false);\n    }\n  } catch (error) {\n    internalReject({ done: false }, error, state);\n  }\n};\n\n// constructor polyfill\nif (FORCED) {\n  // 25.4.3.1 Promise(executor)\n  PromiseConstructor = function Promise(executor) {\n    anInstance(this, PromiseConstructor, PROMISE);\n    aFunction(executor);\n    Internal.call(this);\n    var state = getInternalState(this);\n    try {\n      executor(bind(internalResolve, state), bind(internalReject, state));\n    } catch (error) {\n      internalReject(state, error);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    setInternalState(this, {\n      type: PROMISE,\n      done: false,\n      notified: false,\n      parent: false,\n      reactions: [],\n      rejection: false,\n      state: PENDING,\n      value: undefined\n    });\n  };\n  Internal.prototype = redefineAll(PromiseConstructor.prototype, {\n    // `Promise.prototype.then` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.then\n    then: function then(onFulfilled, onRejected) {\n      var state = getInternalPromiseState(this);\n      var reaction = newPromiseCapability(speciesConstructor(this, PromiseConstructor));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = IS_NODE ? process.domain : undefined;\n      state.parent = true;\n      state.reactions.push(reaction);\n      if (state.state != PENDING) notify(state, false);\n      return reaction.promise;\n    },\n    // `Promise.prototype.catch` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.catch\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    var state = getInternalState(promise);\n    this.promise = promise;\n    this.resolve = bind(internalResolve, state);\n    this.reject = bind(internalReject, state);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === PromiseConstructor || C === PromiseWrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n\n  if (!IS_PURE && typeof NativePromise == 'function') {\n    nativeThen = NativePromise.prototype.then;\n\n    // wrap native Promise#then for native async functions\n    redefine(NativePromise.prototype, 'then', function then(onFulfilled, onRejected) {\n      var that = this;\n      return new PromiseConstructor(function (resolve, reject) {\n        nativeThen.call(that, resolve, reject);\n      }).then(onFulfilled, onRejected);\n    // https://github.com/zloirock/core-js/issues/640\n    }, { unsafe: true });\n\n    // wrap fetch result\n    if (typeof $fetch == 'function') $({ global: true, enumerable: true, forced: true }, {\n      // eslint-disable-next-line no-unused-vars\n      fetch: function fetch(input /* , init */) {\n        return promiseResolve(PromiseConstructor, $fetch.apply(global, arguments));\n      }\n    });\n  }\n}\n\n$({ global: true, wrap: true, forced: FORCED }, {\n  Promise: PromiseConstructor\n});\n\nsetToStringTag(PromiseConstructor, PROMISE, false, true);\nsetSpecies(PROMISE);\n\nPromiseWrapper = getBuiltIn(PROMISE);\n\n// statics\n$({ target: PROMISE, stat: true, forced: FORCED }, {\n  // `Promise.reject` method\n  // https://tc39.github.io/ecma262/#sec-promise.reject\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    capability.reject.call(undefined, r);\n    return capability.promise;\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: IS_PURE || FORCED }, {\n  // `Promise.resolve` method\n  // https://tc39.github.io/ecma262/#sec-promise.resolve\n  resolve: function resolve(x) {\n    return promiseResolve(IS_PURE && this === PromiseWrapper ? PromiseConstructor : this, x);\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: INCORRECT_ITERATION }, {\n  // `Promise.all` method\n  // https://tc39.github.io/ecma262/#sec-promise.all\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        $promiseResolve.call(C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  },\n  // `Promise.race` method\n  // https://tc39.github.io/ecma262/#sec-promise.race\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      iterate(iterable, function (promise) {\n        $promiseResolve.call(C, promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n","var $ = require('../internals/export');\nvar getBuiltIn = require('../internals/get-built-in');\nvar aFunction = require('../internals/a-function');\nvar anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar create = require('../internals/object-create');\nvar bind = require('../internals/function-bind');\nvar fails = require('../internals/fails');\n\nvar nativeConstruct = getBuiltIn('Reflect', 'construct');\n\n// `Reflect.construct` method\n// https://tc39.github.io/ecma262/#sec-reflect.construct\n// MS Edge supports only 2 arguments and argumentsList argument is optional\n// FF Nightly sets third argument as `new.target`, but does not create `this` from it\nvar NEW_TARGET_BUG = fails(function () {\n  function F() { /* empty */ }\n  return !(nativeConstruct(function () { /* empty */ }, [], F) instanceof F);\n});\nvar ARGS_BUG = !fails(function () {\n  nativeConstruct(function () { /* empty */ });\n});\nvar FORCED = NEW_TARGET_BUG || ARGS_BUG;\n\n$({ target: 'Reflect', stat: true, forced: FORCED, sham: FORCED }, {\n  construct: function construct(Target, args /* , newTarget */) {\n    aFunction(Target);\n    anObject(args);\n    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);\n    if (ARGS_BUG && !NEW_TARGET_BUG) return nativeConstruct(Target, args, newTarget);\n    if (Target == newTarget) {\n      // w/o altered newTarget, optimization for 0-4 arguments\n      switch (args.length) {\n        case 0: return new Target();\n        case 1: return new Target(args[0]);\n        case 2: return new Target(args[0], args[1]);\n        case 3: return new Target(args[0], args[1], args[2]);\n        case 4: return new Target(args[0], args[1], args[2], args[3]);\n      }\n      // w/o altered newTarget, lot of arguments case\n      var $args = [null];\n      $args.push.apply($args, args);\n      return new (bind.apply(Target, $args))();\n    }\n    // with altered newTarget, not support built-in constructors\n    var proto = newTarget.prototype;\n    var instance = create(isObject(proto) ? proto : Object.prototype);\n    var result = Function.apply.call(Target, instance, args);\n    return isObject(result) ? result : instance;\n  }\n});\n","'use strict';\nvar fixRegExpWellKnownSymbolLogic = require('../internals/fix-regexp-well-known-symbol-logic');\nvar anObject = require('../internals/an-object');\nvar toLength = require('../internals/to-length');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar advanceStringIndex = require('../internals/advance-string-index');\nvar regExpExec = require('../internals/regexp-exec-abstract');\n\n// @@match logic\nfixRegExpWellKnownSymbolLogic('match', 1, function (MATCH, nativeMatch, maybeCallNative) {\n  return [\n    // `String.prototype.match` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.match\n    function match(regexp) {\n      var O = requireObjectCoercible(this);\n      var matcher = regexp == undefined ? undefined : regexp[MATCH];\n      return matcher !== undefined ? matcher.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));\n    },\n    // `RegExp.prototype[@@match]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@match\n    function (regexp) {\n      var res = maybeCallNative(nativeMatch, regexp, this);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n\n      if (!rx.global) return regExpExec(rx, S);\n\n      var fullUnicode = rx.unicode;\n      rx.lastIndex = 0;\n      var A = [];\n      var n = 0;\n      var result;\n      while ((result = regExpExec(rx, S)) !== null) {\n        var matchStr = String(result[0]);\n        A[n] = matchStr;\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n        n++;\n      }\n      return n === 0 ? null : A;\n    }\n  ];\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar toLength = require('../internals/to-length');\nvar notARegExp = require('../internals/not-a-regexp');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar correctIsRegExpLogic = require('../internals/correct-is-regexp-logic');\nvar IS_PURE = require('../internals/is-pure');\n\nvar nativeStartsWith = ''.startsWith;\nvar min = Math.min;\n\nvar CORRECT_IS_REGEXP_LOGIC = correctIsRegExpLogic('startsWith');\n// https://github.com/zloirock/core-js/pull/702\nvar MDN_POLYFILL_BUG = !IS_PURE && !CORRECT_IS_REGEXP_LOGIC && !!function () {\n  var descriptor = getOwnPropertyDescriptor(String.prototype, 'startsWith');\n  return descriptor && !descriptor.writable;\n}();\n\n// `String.prototype.startsWith` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.startswith\n$({ target: 'String', proto: true, forced: !MDN_POLYFILL_BUG && !CORRECT_IS_REGEXP_LOGIC }, {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = String(requireObjectCoercible(this));\n    notARegExp(searchString);\n    var index = toLength(min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return nativeStartsWith\n      ? nativeStartsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _default = [['Serbian', ' ', 'sr', 'srp', 'srp'], ['Romanian, Moldavian, Moldovan', 'Romn', 'ro', 'ron', 'rum'], ['Sichuan Yi, Nuosu', ' Nuosuhxop', 'ii', 'iii', 'iii'], ['Tahitian', 'Reo Tahiti', 'ty', 'tah', 'tah'], ['Tagalog', 'Wikang Tagalog', 'tl', 'tgl', 'tgl'], ['Yiddish', '', 'yi', 'yid', 'yid'], ['Akan', 'Akan', 'ak', 'aka', 'aka'], ['Malay', 'Bahasa Melayu,  ', 'ms', 'msa', 'may'], ['Arabic', '', 'ar', 'ara', 'ara'], ['Norwegian', 'Norsk', 'no', 'nor', 'nor'], ['Ojibwa', '', 'oj', 'oji', 'oji'], ['Fulah', 'Fulfulde, Pulaar, Pular', 'ff', 'ful', 'ful'], ['Persian', '', 'fa', 'fas', 'per'], ['Albanian', 'Shqip', 'sq', 'sqi', 'alb'], ['Aymara', 'aymar aru', 'ay', 'aym', 'aym'], ['Azerbaijani', 'azrbaycan dili', 'az', 'aze', 'aze'], ['Chinese', ' (Zhngwn), , ', 'zh', 'zho', 'chi'], ['Cree', '', 'cr', 'cre', 'cre'], ['Estonian', 'eesti, eesti keel', 'et', 'est', 'est'], ['Guaran', 'Avae\\'', 'gn', 'grn', 'grn'], ['Inupiaq', 'Iupiaq, Iupiatun', 'ik', 'ipk', 'ipk'], ['Inuktitut', '', 'iu', 'iku', 'iku'], ['Kanuri', 'Kanuri', 'kr', 'kau', 'kau'], ['Komi', ' ', 'kv', 'kom', 'kom'], ['Kongo', 'Kikongo', 'kg', 'kon', 'kon'], ['Kurdish', 'Kurd, ', 'ku', 'kur', 'kur'], ['Latvian', 'latvieu valoda', 'lv', 'lav', 'lav'], ['Malagasy', 'fiteny malagasy', 'mg', 'mlg', 'mlg'], ['Mongolian', ' ', 'mn', 'mon', 'mon'], ['Oromo', 'Afaan Oromoo', 'om', 'orm', 'orm'], ['Pashto, Pushto', '', 'ps', 'pus', 'pus'], ['Quechua', 'Runa Simi, Kichwa', 'qu', 'que', 'que'], ['Sardinian', 'sardu', 'sc', 'srd', 'srd'], ['Swahili', 'Kiswahili', 'sw', 'swa', 'swa'], ['Uzbek', 'Ozbek, , ', 'uz', 'uzb', 'uzb'], ['Zhuang, Chuang', 'Sa cue, Saw cuengh', 'za', 'zha', 'zha'], ['Bislama', 'Bislama', 'bi', 'bis', 'bis'], ['Norwegian Bokml', 'Norsk Bokml', 'nb', 'nob', 'nob'], ['Norwegian Nynorsk', 'Norsk Nynorsk', 'nn', 'nno', 'nno'], ['Indonesian', 'Bahasa Indonesia', 'id', 'ind', 'ind'], ['Twi', 'Twi', 'tw', 'twi', 'twi'], ['Esperanto', 'Esperanto', 'eo', 'epo', 'epo'], ['Interlingua', 'Interlingua', 'ia', 'ina', 'ina'], ['Interlingue', 'Originally called Occidental; then Interlingue after WWII', 'ie', 'ile', 'ile'], ['Ido', 'Ido', 'io', 'ido', 'ido'], ['Volapk', 'Volapk', 'vo', 'vol', 'vol'], ['Bihari languages', '', 'bh', 'bih', 'bih'], ['Hebrew (modern)', '', 'he', 'heb', 'heb'], ['Sanskrit', '', 'sa', 'san', 'san'], ['Church Slavic, Church Slavonic, Old Church Slavonic, Old Slavonic, Old Bulgarian', ' ', 'cu', 'chu', 'chu'], ['Pali', '', 'pi', 'pli', 'pli'], ['Avestan', 'avesta', 'ae', 'ave', 'ave'], ['Latin', 'latine, lingua latina', 'la', 'lat', 'lat'], ['Armenian', '', 'hy', 'hye', 'arm'], ['Swati', 'SiSwati', 'ss', 'ssw', 'ssw'], ['Tibetan', '', 'bo', 'bod', 'tib'], ['South Ndebele', 'isiNdebele', 'nr', 'nbl', 'nbl'], ['Slovene', 'Slovenski Jezik, Slovenina', 'sl', 'slv', 'slv'], ['Oriya', '', 'or', 'ori', 'ori'], ['North Ndebele', 'isiNdebele', 'nd', 'nde', 'nde'], ['Nauru', 'Dorerin Naoero', 'na', 'nau', 'nau'], ['Maori', 'te reo Mori', 'mi', 'mri', 'mao'], ['Marathi', '', 'mr', 'mar', 'mar'], ['Luba-Katanga', 'Kiluba', 'lu', 'lub', 'lub'], ['Rundi', 'Ikirundi', 'rn', 'run', 'run'], ['Central Khmer', ', , ', 'km', 'khm', 'khm'], ['Western Frisian', 'Frysk', 'fy', 'fry', 'fry'], ['Bengali', '', 'bn', 'ben', 'ben'], ['Avaric', ' ,  ', 'av', 'ava', 'ava'], ['Abkhazian', ' , ', 'ab', 'abk', 'abk'], ['Afar', 'Afaraf', 'aa', 'aar', 'aar'], ['Afrikaans', 'Afrikaans', 'af', 'afr', 'afr'], ['Amharic', '', 'am', 'amh', 'amh'], ['Aragonese', 'aragons', 'an', 'arg', 'arg'], ['Assamese', '', 'as', 'asm', 'asm'], ['Bambara', 'bamanankan', 'bm', 'bam', 'bam'], ['Bashkir', ' ', 'ba', 'bak', 'bak'], ['Basque', 'euskara, euskera', 'eu', 'eus', 'baq'], ['Belarusian', ' ', 'be', 'bel', 'bel'], ['Bosnian', 'bosanski jezik', 'bs', 'bos', 'bos'], ['Breton', 'brezhoneg', 'br', 'bre', 'bre'], ['Bulgarian', ' ', 'bg', 'bul', 'bul'], ['Burmese', '', 'my', 'mya', 'bur'], ['Catalan, Valencian', 'catal, valenci', 'ca', 'cat', 'cat'], ['Chamorro', 'Chamoru', 'ch', 'cha', 'cha'], ['Chechen', ' ', 'ce', 'che', 'che'], ['Chichewa, Chewa, Nyanja', 'chiChea, chinyanja', 'ny', 'nya', 'nya'], ['Chuvash', ' ', 'cv', 'chv', 'chv'], ['Cornish', 'Kernewek', 'kw', 'cor', 'cor'], ['Corsican', 'corsu, lingua corsa', 'co', 'cos', 'cos'], ['Croatian', 'hrvatski jezik', 'hr', 'hrv', 'hrv'], ['Czech', 'etina, esk jazyk', 'cs', 'ces', 'cze'], ['Danish', 'dansk', 'da', 'dan', 'dan'], ['Divehi, Dhivehi, Maldivian', '', 'dv', 'div', 'div'], ['Dutch, Flemish', 'Nederlands, Vlaams', 'nl', 'nld', 'dut'], ['Dzongkha', '', 'dz', 'dzo', 'dzo'], ['English', 'English', 'en', 'eng', 'eng'], ['Ewe', 'Eegbe', 'ee', 'ewe', 'ewe'], ['Faroese', 'froyskt', 'fo', 'fao', 'fao'], ['Fijian', 'vosa Vakaviti', 'fj', 'fij', 'fij'], ['Finnish', 'suomi, suomen kieli', 'fi', 'fin', 'fin'], ['French', 'franais, langue franaise', 'fr', 'fra', 'fre'], ['Galician', 'Galego', 'gl', 'glg', 'glg'], ['Georgian', '', 'ka', 'kat', 'geo'], ['German', 'Deutsch', 'de', 'deu', 'ger'], ['Greek (modern)', '', 'el', 'ell', 'gre'], ['Gujarati', '', 'gu', 'guj', 'guj'], ['Haitian, Haitian Creole', 'Kreyl ayisyen', 'ht', 'hat', 'hat'], ['Hausa', '(Hausa) ', 'ha', 'hau', 'hau'], ['Herero', 'Otjiherero', 'hz', 'her', 'her'], ['Hindi', ', ', 'hi', 'hin', 'hin'], ['Hiri Motu', 'Hiri Motu', 'ho', 'hmo', 'hmo'], ['Hungarian', 'magyar', 'hu', 'hun', 'hun'], ['Irish', 'Gaeilge', 'ga', 'gle', 'gle'], ['Igbo', 'Ass Igbo', 'ig', 'ibo', 'ibo'], ['Icelandic', 'slenska', 'is', 'isl', 'ice'], ['Italian', 'Italiano', 'it', 'ita', 'ita'], ['Japanese', ' ()', 'ja', 'jpn', 'jpn'], ['Javanese', ', Basa Jawa', 'jv', 'jav', 'jav'], ['Kalaallisut, Greenlandic', 'kalaallisut, kalaallit oqaasii', 'kl', 'kal', 'kal'], ['Kannada', '', 'kn', 'kan', 'kan'], ['Kashmiri', ', ', 'ks', 'kas', 'kas'], ['Kazakh', ' ', 'kk', 'kaz', 'kaz'], ['Kikuyu, Gikuyu', 'Gky', 'ki', 'kik', 'kik'], ['Kinyarwanda', 'Ikinyarwanda', 'rw', 'kin', 'kin'], ['Kirghiz, Kyrgyz', ',  ', 'ky', 'kir', 'kir'], ['Korean', '', 'ko', 'kor', 'kor'], ['Kuanyama, Kwanyama', 'Kuanyama', 'kj', 'kua', 'kua'], ['Luxembourgish, Letzeburgesch', 'Ltzebuergesch', 'lb', 'ltz', 'ltz'], ['Ganda', 'Luganda', 'lg', 'lug', 'lug'], ['Limburgan, Limburger, Limburgish', 'Limburgs', 'li', 'lim', 'lim'], ['Lingala', 'Lingla', 'ln', 'lin', 'lin'], ['Lao', '', 'lo', 'lao', 'lao'], ['Lithuanian', 'lietuvi kalba', 'lt', 'lit', 'lit'], ['Manx', 'Gaelg, Gailck', 'gv', 'glv', 'glv'], ['Macedonian', ' ', 'mk', 'mkd', 'mac'], ['Malayalam', '', 'ml', 'mal', 'mal'], ['Maltese', 'Malti', 'mt', 'mlt', 'mlt'], ['Marshallese', 'Kajin Maje', 'mh', 'mah', 'mah'], ['Navajo, Navaho', 'Din bizaad', 'nv', 'nav', 'nav'], ['Nepali', '', 'ne', 'nep', 'nep'], ['Ndonga', 'Owambo', 'ng', 'ndo', 'ndo'], ['Occitan', 'occitan, lenga d\\'c', 'oc', 'oci', 'oci'], ['Ossetian, Ossetic', ' ', 'os', 'oss', 'oss'], ['Panjabi, Punjabi', '', 'pa', 'pan', 'pan'], ['Polish', 'jzyk polski, polszczyzna', 'pl', 'pol', 'pol'], ['Portuguese', 'Portugus', 'pt', 'por', 'por'], ['Romansh', 'Rumantsch Grischun', 'rm', 'roh', 'roh'], ['Russian', '', 'ru', 'rus', 'rus'], ['Sindhi', ',  ', 'sd', 'snd', 'snd'], ['Northern Sami', 'Davvismegiella', 'se', 'sme', 'sme'], ['Samoan', 'gagana fa\\'a Samoa', 'sm', 'smo', 'smo'], ['Sango', 'yng t sng', 'sg', 'sag', 'sag'], ['Gaelic, Scottish Gaelic', 'Gidhlig', 'gd', 'gla', 'gla'], ['Shona', 'chiShona', 'sn', 'sna', 'sna'], ['Sinhala, Sinhalese', '', 'si', 'sin', 'sin'], ['Slovak', 'Slovenina, Slovensk Jazyk', 'sk', 'slk', 'slo'], ['Somali', 'Soomaaliga, af Soomaali', 'so', 'som', 'som'], ['Southern Sotho', 'Sesotho', 'st', 'sot', 'sot'], ['Spanish, Castilian', 'Espaol', 'es', 'spa', 'spa'], ['Sundanese', 'Basa Sunda', 'su', 'sun', 'sun'], ['Swedish', 'Svenska', 'sv', 'swe', 'swe'], ['Tamil', '', 'ta', 'tam', 'tam'], ['Telugu', '', 'te', 'tel', 'tel'], ['Tajik', ', toik, ', 'tg', 'tgk', 'tgk'], ['Thai', '', 'th', 'tha', 'tha'], ['Tigrinya', '', 'ti', 'tir', 'tir'], ['Turkmen', 'Trkmen, ', 'tk', 'tuk', 'tuk'], ['Tswana', 'Setswana', 'tn', 'tsn', 'tsn'], ['Tongan (Tonga Islands)', 'Faka Tonga', 'to', 'ton', 'ton'], ['Turkish', 'Trke', 'tr', 'tur', 'tur'], ['Tsonga', 'Xitsonga', 'ts', 'tso', 'tso'], ['Tatar', ' , tatar tele', 'tt', 'tat', 'tat'], ['Uighur, Uyghur', ', Uyghurche', 'ug', 'uig', 'uig'], ['Ukrainian', '', 'uk', 'ukr', 'ukr'], ['Urdu', '', 'ur', 'urd', 'urd'], ['Venda', 'Tshivena', 've', 'ven', 'ven'], ['Vietnamese', 'Ting Vit', 'vi', 'vie', 'vie'], ['Walloon', 'Walon', 'wa', 'wln', 'wln'], ['Welsh', 'Cymraeg', 'cy', 'cym', 'wel'], ['Wolof', 'Wollof', 'wo', 'wol', 'wol'], ['Xhosa', 'isiXhosa', 'xh', 'xho', 'xho'], ['Yoruba', 'Yorb', 'yo', 'yor', 'yor'], ['Zulu', 'isiZulu', 'zu', 'zul', 'zul']];\nexports[\"default\"] = _default;","/*!\n * jQuery Browser Plugin 0.1.0\n * https://github.com/gabceb/jquery-browser-plugin\n *\n * Original jquery-browser code Copyright 2005, 2015 jQuery Foundation, Inc. and other contributors\n * http://jquery.org/license\n *\n * Modifications Copyright 2015 Gabriel Cebrian\n * https://github.com/gabceb\n *\n * Released under the MIT license\n *\n * Date: 05-07-2015\n */\n/*global window: false */\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['jquery'], function ($) {\n      return factory($);\n    });\n  } else if (typeof module === 'object' && typeof module.exports === 'object') {\n    // Node-like environment\n    module.exports = factory(require('jquery'));\n  } else {\n    // Browser globals\n    factory(window.jQuery);\n  }\n}(function(jQuery) {\n  \"use strict\";\n\n  function uaMatch( ua ) {\n    // If an UA is not provided, default to the current browser UA.\n    if ( ua === undefined ) {\n      ua = window.navigator.userAgent;\n    }\n    ua = ua.toLowerCase();\n\n    var match = /(edge)\\/([\\w.]+)/.exec( ua ) ||\n        /(opr)[\\/]([\\w.]+)/.exec( ua ) ||\n        /(chrome)[ \\/]([\\w.]+)/.exec( ua ) ||\n        /(iemobile)[\\/]([\\w.]+)/.exec( ua ) ||\n        /(version)(applewebkit)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec( ua ) ||\n        /(webkit)[ \\/]([\\w.]+).*(version)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec( ua ) ||\n        /(webkit)[ \\/]([\\w.]+)/.exec( ua ) ||\n        /(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec( ua ) ||\n        /(msie) ([\\w.]+)/.exec( ua ) ||\n        ua.indexOf(\"trident\") >= 0 && /(rv)(?::| )([\\w.]+)/.exec( ua ) ||\n        ua.indexOf(\"compatible\") < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec( ua ) ||\n        [];\n\n    var platform_match = /(ipad)/.exec( ua ) ||\n        /(ipod)/.exec( ua ) ||\n        /(windows phone)/.exec( ua ) ||\n        /(iphone)/.exec( ua ) ||\n        /(kindle)/.exec( ua ) ||\n        /(silk)/.exec( ua ) ||\n        /(android)/.exec( ua ) ||\n        /(win)/.exec( ua ) ||\n        /(mac)/.exec( ua ) ||\n        /(linux)/.exec( ua ) ||\n        /(cros)/.exec( ua ) ||\n        /(playbook)/.exec( ua ) ||\n        /(bb)/.exec( ua ) ||\n        /(blackberry)/.exec( ua ) ||\n        [];\n\n    var browser = {},\n        matched = {\n          browser: match[ 5 ] || match[ 3 ] || match[ 1 ] || \"\",\n          version: match[ 2 ] || match[ 4 ] || \"0\",\n          versionNumber: match[ 4 ] || match[ 2 ] || \"0\",\n          platform: platform_match[ 0 ] || \"\"\n        };\n\n    if ( matched.browser ) {\n      browser[ matched.browser ] = true;\n      browser.version = matched.version;\n      browser.versionNumber = parseInt(matched.versionNumber, 10);\n    }\n\n    if ( matched.platform ) {\n      browser[ matched.platform ] = true;\n    }\n\n    // These are all considered mobile platforms, meaning they run a mobile browser\n    if ( browser.android || browser.bb || browser.blackberry || browser.ipad || browser.iphone ||\n      browser.ipod || browser.kindle || browser.playbook || browser.silk || browser[ \"windows phone\" ]) {\n      browser.mobile = true;\n    }\n\n    // These are all considered desktop platforms, meaning they run a desktop browser\n    if ( browser.cros || browser.mac || browser.linux || browser.win ) {\n      browser.desktop = true;\n    }\n\n    // Chrome, Opera 15+ and Safari are webkit based browsers\n    if ( browser.chrome || browser.opr || browser.safari ) {\n      browser.webkit = true;\n    }\n\n    // IE11 has a new token so we will assign it msie to avoid breaking changes\n    if ( browser.rv || browser.iemobile) {\n      var ie = \"msie\";\n\n      matched.browser = ie;\n      browser[ie] = true;\n    }\n\n    // Edge is officially known as Microsoft Edge, so rewrite the key to match\n    if ( browser.edge ) {\n      delete browser.edge;\n      var msedge = \"msedge\";\n\n      matched.browser = msedge;\n      browser[msedge] = true;\n    }\n\n    // Blackberry browsers are marked as Safari on BlackBerry\n    if ( browser.safari && browser.blackberry ) {\n      var blackberry = \"blackberry\";\n\n      matched.browser = blackberry;\n      browser[blackberry] = true;\n    }\n\n    // Playbook browsers are marked as Safari on Playbook\n    if ( browser.safari && browser.playbook ) {\n      var playbook = \"playbook\";\n\n      matched.browser = playbook;\n      browser[playbook] = true;\n    }\n\n    // BB10 is a newer OS version of BlackBerry\n    if ( browser.bb ) {\n      var bb = \"blackberry\";\n\n      matched.browser = bb;\n      browser[bb] = true;\n    }\n\n    // Opera 15+ are identified as opr\n    if ( browser.opr ) {\n      var opera = \"opera\";\n\n      matched.browser = opera;\n      browser[opera] = true;\n    }\n\n    // Stock Android browsers are marked as Safari on Android.\n    if ( browser.safari && browser.android ) {\n      var android = \"android\";\n\n      matched.browser = android;\n      browser[android] = true;\n    }\n\n    // Kindle browsers are marked as Safari on Kindle\n    if ( browser.safari && browser.kindle ) {\n      var kindle = \"kindle\";\n\n      matched.browser = kindle;\n      browser[kindle] = true;\n    }\n\n     // Kindle Silk browsers are marked as Safari on Kindle\n    if ( browser.safari && browser.silk ) {\n      var silk = \"silk\";\n\n      matched.browser = silk;\n      browser[silk] = true;\n    }\n\n    // Assign the name and platform variable\n    browser.name = matched.browser;\n    browser.platform = matched.platform;\n    return browser;\n  }\n\n  // Run the matching process, also assign the function to the returned object\n  // for manual, jQuery-free use if desired\n  window.jQBrowser = uaMatch( window.navigator.userAgent );\n  window.jQBrowser.uaMatch = uaMatch;\n\n  // Only assign to jQuery.browser if jQuery is loaded\n  if ( jQuery ) {\n    jQuery.browser = window.jQBrowser;\n  }\n\n  return window.jQBrowser;\n}));\n","/** @license\r\n *\r\n * SoundManager 2: JavaScript Sound for the Web\r\n * ----------------------------------------------\r\n * http://schillmania.com/projects/soundmanager2/\r\n *\r\n * Copyright (c) 2007, Scott Schiller. All rights reserved.\r\n * Code provided under the BSD License:\r\n * http://schillmania.com/projects/soundmanager2/license.txt\r\n *\r\n * V2.97a.20170601\r\n */\r\n\r\n/**\r\n * About this file\r\n * -------------------------------------------------------------------------------------\r\n * This is the fully-commented source version of the SoundManager 2 API,\r\n * recommended for use during development and testing.\r\n *\r\n * See soundmanager2-nodebug-jsmin.js for an optimized build (~11KB with gzip.)\r\n * http://schillmania.com/projects/soundmanager2/doc/getstarted/#basic-inclusion\r\n * Alternately, serve this file with gzip for 75% compression savings (~30KB over HTTP.)\r\n *\r\n * You may notice <d> and </d> comments in this source; these are delimiters for\r\n * debug blocks which are removed in the -nodebug builds, further optimizing code size.\r\n *\r\n * Also, as you may note: Whoa, reliable cross-platform/device audio support is hard! ;)\r\n */\r\n\r\n(function SM2(window, _undefined) {\r\n\r\n/* global Audio, document, window, navigator, define, module, SM2_DEFER, opera, setTimeout, setInterval, clearTimeout, sm2Debugger */\r\n\r\n'use strict';\r\n\r\nif (!window || !window.document) {\r\n\r\n  // Don't cross the [environment] streams. SM2 expects to be running in a browser, not under node.js etc.\r\n  // Additionally, if a browser somehow manages to fail this test, as Egon said: \"It would be bad.\"\r\n\r\n  throw new Error('SoundManager requires a browser with window and document objects.');\r\n\r\n}\r\n\r\nvar soundManager = null;\r\n\r\n/**\r\n * The SoundManager constructor.\r\n *\r\n * @constructor\r\n * @param {string} smURL Optional: Path to SWF files\r\n * @param {string} smID Optional: The ID to use for the SWF container element\r\n * @this {SoundManager}\r\n * @return {SoundManager} The new SoundManager instance\r\n */\r\n\r\nfunction SoundManager(smURL, smID) {\r\n\r\n  /**\r\n   * soundManager configuration options list\r\n   * defines top-level configuration properties to be applied to the soundManager instance (eg. soundManager.flashVersion)\r\n   * to set these properties, use the setup() method - eg., soundManager.setup({url: '/swf/', flashVersion: 9})\r\n   */\r\n\r\n  this.setupOptions = {\r\n\r\n    url: (smURL || null),             // path (directory) where SoundManager 2 SWFs exist, eg., /path/to/swfs/\r\n    flashVersion: 8,                  // flash build to use (8 or 9.) Some API features require 9.\r\n    debugMode: true,                  // enable debugging output (console.log() with HTML fallback)\r\n    debugFlash: false,                // enable debugging output inside SWF, troubleshoot Flash/browser issues\r\n    useConsole: true,                 // use console.log() if available (otherwise, writes to #soundmanager-debug element)\r\n    consoleOnly: true,                // if console is being used, do not create/write to #soundmanager-debug\r\n    waitForWindowLoad: false,         // force SM2 to wait for window.onload() before trying to call soundManager.onload()\r\n    bgColor: '#ffffff',               // SWF background color. N/A when wmode = 'transparent'\r\n    useHighPerformance: false,        // position:fixed flash movie can help increase js/flash speed, minimize lag\r\n    flashPollingInterval: null,       // msec affecting whileplaying/loading callback frequency. If null, default of 50 msec is used.\r\n    html5PollingInterval: null,       // msec affecting whileplaying() for HTML5 audio, excluding mobile devices. If null, native HTML5 update events are used.\r\n    flashLoadTimeout: 1000,           // msec to wait for flash movie to load before failing (0 = infinity)\r\n    wmode: null,                      // flash rendering mode - null, 'transparent', or 'opaque' (last two allow z-index to work)\r\n    allowScriptAccess: 'always',      // for scripting the SWF (object/embed property), 'always' or 'sameDomain'\r\n    useFlashBlock: false,             // *requires flashblock.css, see demos* - allow recovery from flash blockers. Wait indefinitely and apply timeout CSS to SWF, if applicable.\r\n    useHTML5Audio: true,              // use HTML5 Audio() where API is supported (most Safari, Chrome versions), Firefox (MP3/MP4 support varies.) Ideally, transparent vs. Flash API where possible.\r\n    forceUseGlobalHTML5Audio: false,  // if true, a single Audio() object is used for all sounds - and only one can play at a time.\r\n    ignoreMobileRestrictions: false,  // if true, SM2 will not apply global HTML5 audio rules to mobile UAs. iOS > 7 and WebViews may allow multiple Audio() instances.\r\n    html5Test: /^(probably|maybe)$/i, // HTML5 Audio() format support test. Use /^probably$/i; if you want to be more conservative.\r\n    preferFlash: false,               // overrides useHTML5audio, will use Flash for MP3/MP4/AAC if present. Potential option if HTML5 playback with these formats is quirky.\r\n    noSWFCache: false,                // if true, appends ?ts={date} to break aggressive SWF caching.\r\n    idPrefix: 'sound'                 // if an id is not provided to createSound(), this prefix is used for generated IDs - 'sound0', 'sound1' etc.\r\n\r\n  };\r\n\r\n  this.defaultOptions = {\r\n\r\n    /**\r\n     * the default configuration for sound objects made with createSound() and related methods\r\n     * eg., volume, auto-load behaviour and so forth\r\n     */\r\n\r\n    autoLoad: false,        // enable automatic loading (otherwise .load() will be called on demand with .play(), the latter being nicer on bandwidth - if you want to .load yourself, you also can)\r\n    autoPlay: false,        // enable playing of file as soon as possible (much faster if \"stream\" is true)\r\n    from: null,             // position to start playback within a sound (msec), default = beginning\r\n    loops: 1,               // how many times to repeat the sound (position will wrap around to 0, setPosition() will break out of loop when >0)\r\n    onid3: null,            // callback function for \"ID3 data is added/available\"\r\n    onerror: null,          // callback function for \"load failed\" (or, playback/network/decode error under HTML5.)\r\n    onload: null,           // callback function for \"load finished\"\r\n    whileloading: null,     // callback function for \"download progress update\" (X of Y bytes received)\r\n    onplay: null,           // callback for \"play\" start\r\n    onpause: null,          // callback for \"pause\"\r\n    onresume: null,         // callback for \"resume\" (pause toggle)\r\n    whileplaying: null,     // callback during play (position update)\r\n    onposition: null,       // object containing times and function callbacks for positions of interest\r\n    onstop: null,           // callback for \"user stop\"\r\n    onfinish: null,         // callback function for \"sound finished playing\"\r\n    multiShot: true,        // let sounds \"restart\" or layer on top of each other when played multiple times, rather than one-shot/one at a time\r\n    multiShotEvents: false, // fire multiple sound events (currently onfinish() only) when multiShot is enabled\r\n    position: null,         // offset (milliseconds) to seek to within loaded sound data.\r\n    pan: 0,                 // \"pan\" settings, left-to-right, -100 to 100\r\n    playbackRate: 1,        // rate at which to play the sound (HTML5-only)\r\n    stream: true,           // allows playing before entire file has loaded (recommended)\r\n    to: null,               // position to end playback within a sound (msec), default = end\r\n    type: null,             // MIME-like hint for file pattern / canPlay() tests, eg. audio/mp3\r\n    usePolicyFile: false,   // enable crossdomain.xml request for audio on remote domains (for ID3/waveform access)\r\n    volume: 100             // self-explanatory. 0-100, the latter being the max.\r\n\r\n  };\r\n\r\n  this.flash9Options = {\r\n\r\n    /**\r\n     * flash 9-only options,\r\n     * merged into defaultOptions if flash 9 is being used\r\n     */\r\n\r\n    onfailure: null,        // callback function for when playing fails (Flash 9, MovieStar + RTMP-only)\r\n    isMovieStar: null,      // \"MovieStar\" MPEG4 audio mode. Null (default) = auto detect MP4, AAC etc. based on URL. true = force on, ignore URL\r\n    usePeakData: false,     // enable left/right channel peak (level) data\r\n    useWaveformData: false, // enable sound spectrum (raw waveform data) - NOTE: May increase CPU load.\r\n    useEQData: false,       // enable sound EQ (frequency spectrum data) - NOTE: May increase CPU load.\r\n    onbufferchange: null,   // callback for \"isBuffering\" property change\r\n    ondataerror: null       // callback for waveform/eq data access error (flash playing audio in other tabs/domains)\r\n\r\n  };\r\n\r\n  this.movieStarOptions = {\r\n\r\n    /**\r\n     * flash 9.0r115+ MPEG4 audio options,\r\n     * merged into defaultOptions if flash 9+movieStar mode is enabled\r\n     */\r\n\r\n    bufferTime: 3,          // seconds of data to buffer before playback begins (null = flash default of 0.1 seconds - if AAC playback is gappy, try increasing.)\r\n    serverURL: null,        // rtmp: FMS or FMIS server to connect to, required when requesting media via RTMP or one of its variants\r\n    onconnect: null,        // rtmp: callback for connection to flash media server\r\n    duration: null          // rtmp: song duration (msec)\r\n\r\n  };\r\n\r\n  this.audioFormats = {\r\n\r\n    /**\r\n     * determines HTML5 support + flash requirements.\r\n     * if no support (via flash and/or HTML5) for a \"required\" format, SM2 will fail to start.\r\n     * flash fallback is used for MP3 or MP4 if HTML5 can't play it (or if preferFlash = true)\r\n     */\r\n\r\n    mp3: {\r\n      type: ['audio/mpeg; codecs=\"mp3\"', 'audio/mpeg', 'audio/mp3', 'audio/MPA', 'audio/mpa-robust'],\r\n      required: true\r\n    },\r\n\r\n    mp4: {\r\n      related: ['aac', 'm4a', 'm4b'], // additional formats under the MP4 container\r\n      type: ['audio/mp4; codecs=\"mp4a.40.2\"', 'audio/aac', 'audio/x-m4a', 'audio/MP4A-LATM', 'audio/mpeg4-generic'],\r\n      required: false\r\n    },\r\n\r\n    ogg: {\r\n      type: ['audio/ogg; codecs=vorbis'],\r\n      required: false\r\n    },\r\n\r\n    opus: {\r\n      type: ['audio/ogg; codecs=opus', 'audio/opus'],\r\n      required: false\r\n    },\r\n\r\n    wav: {\r\n      type: ['audio/wav; codecs=\"1\"', 'audio/wav', 'audio/wave', 'audio/x-wav'],\r\n      required: false\r\n    },\r\n\r\n    flac: {\r\n      type: ['audio/flac'],\r\n      required: false\r\n    }\r\n\r\n  };\r\n\r\n  // HTML attributes (id + class names) for the SWF container\r\n\r\n  this.movieID = 'sm2-container';\r\n  this.id = (smID || 'sm2movie');\r\n\r\n  this.debugID = 'soundmanager-debug';\r\n  this.debugURLParam = /([#?&])debug=1/i;\r\n\r\n  // dynamic attributes\r\n\r\n  this.versionNumber = 'V2.97a.20170601';\r\n  this.version = null;\r\n  this.movieURL = null;\r\n  this.altURL = null;\r\n  this.swfLoaded = false;\r\n  this.enabled = false;\r\n  this.oMC = null;\r\n  this.sounds = {};\r\n  this.soundIDs = [];\r\n  this.muted = false;\r\n  this.didFlashBlock = false;\r\n  this.filePattern = null;\r\n\r\n  this.filePatterns = {\r\n    flash8: /\\.mp3(\\?.*)?$/i,\r\n    flash9: /\\.mp3(\\?.*)?$/i\r\n  };\r\n\r\n  // support indicators, set at init\r\n\r\n  this.features = {\r\n    buffering: false,\r\n    peakData: false,\r\n    waveformData: false,\r\n    eqData: false,\r\n    movieStar: false\r\n  };\r\n\r\n  // flash sandbox info, used primarily in troubleshooting\r\n\r\n  this.sandbox = {\r\n    // <d>\r\n    type: null,\r\n    types: {\r\n      remote: 'remote (domain-based) rules',\r\n      localWithFile: 'local with file access (no internet access)',\r\n      localWithNetwork: 'local with network (internet access only, no local access)',\r\n      localTrusted: 'local, trusted (local+internet access)'\r\n    },\r\n    description: null,\r\n    noRemote: null,\r\n    noLocal: null\r\n    // </d>\r\n  };\r\n\r\n  /**\r\n   * format support (html5/flash)\r\n   * stores canPlayType() results based on audioFormats.\r\n   * eg. { mp3: boolean, mp4: boolean }\r\n   * treat as read-only.\r\n   */\r\n\r\n  this.html5 = {\r\n    usingFlash: null // set if/when flash fallback is needed\r\n  };\r\n\r\n  // file type support hash\r\n  this.flash = {};\r\n\r\n  // determined at init time\r\n  this.html5Only = false;\r\n\r\n  // used for special cases (eg. iPad/iPhone/palm OS?)\r\n  this.ignoreFlash = false;\r\n\r\n  /**\r\n   * a few private internals (OK, a lot. :D)\r\n   */\r\n\r\n  var SMSound,\r\n  sm2 = this, globalHTML5Audio = null, flash = null, sm = 'soundManager', smc = sm + ': ', h5 = 'HTML5::', id, ua = navigator.userAgent, wl = window.location.href.toString(), doc = document, doNothing, setProperties, init, fV, on_queue = [], debugOpen = true, debugTS, didAppend = false, appendSuccess = false, didInit = false, disabled = false, windowLoaded = false, _wDS, wdCount = 0, initComplete, mixin, assign, extraOptions, addOnEvent, processOnEvents, initUserOnload, delayWaitForEI, waitForEI, rebootIntoHTML5, setVersionInfo, handleFocus, strings, initMovie, domContentLoaded, winOnLoad, didDCLoaded, getDocument, createMovie, catchError, setPolling, initDebug, debugLevels = ['log', 'info', 'warn', 'error'], defaultFlashVersion = 8, disableObject, failSafely, normalizeMovieURL, oRemoved = null, oRemovedHTML = null, str, flashBlockHandler, getSWFCSS, swfCSS, toggleDebug, loopFix, policyFix, complain, idCheck, waitingForEI = false, initPending = false, startTimer, stopTimer, timerExecute, h5TimerCount = 0, h5IntervalTimer = null, parseURL, messages = [],\r\n  canIgnoreFlash, needsFlash = null, featureCheck, html5OK, html5CanPlay, html5ErrorCodes, html5Ext, html5Unload, domContentLoadedIE, testHTML5, event, slice = Array.prototype.slice, useGlobalHTML5Audio = false, lastGlobalHTML5URL, hasFlash, detectFlash, badSafariFix, html5_events, showSupport, flushMessages, wrapCallback, idCounter = 0, didSetup, msecScale = 1000,\r\n  is_iDevice = ua.match(/(ipad|iphone|ipod)/i), isAndroid = ua.match(/android/i), isIE = ua.match(/msie|trident/i),\r\n  isWebkit = ua.match(/webkit/i),\r\n  isSafari = (ua.match(/safari/i) && !ua.match(/chrome/i)),\r\n  isOpera = (ua.match(/opera/i)),\r\n  mobileHTML5 = (ua.match(/(mobile|pre\\/|xoom)/i) || is_iDevice || isAndroid),\r\n  isBadSafari = (!wl.match(/usehtml5audio/i) && !wl.match(/sm2-ignorebadua/i) && isSafari && !ua.match(/silk/i) && ua.match(/OS\\sX\\s10_6_([3-7])/i)), // Safari 4 and 5 (excluding Kindle Fire, \"Silk\") occasionally fail to load/play HTML5 audio on Snow Leopard 10.6.3 through 10.6.7 due to bug(s) in QuickTime X and/or other underlying frameworks. :/ Confirmed bug. https://bugs.webkit.org/show_bug.cgi?id=32159\r\n  hasConsole = (window.console !== _undefined && console.log !== _undefined),\r\n  isFocused = (doc.hasFocus !== _undefined ? doc.hasFocus() : null),\r\n  tryInitOnFocus = (isSafari && (doc.hasFocus === _undefined || !doc.hasFocus())),\r\n  okToDisable = !tryInitOnFocus,\r\n  flashMIME = /(mp3|mp4|mpa|m4a|m4b)/i,\r\n  emptyURL = 'about:blank', // safe URL to unload, or load nothing from (flash 8 + most HTML5 UAs)\r\n  emptyWAV = 'data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==', // tiny WAV for HTML5 unloading\r\n  overHTTP = (doc.location ? doc.location.protocol.match(/http/i) : null),\r\n  http = (!overHTTP ? '//' : ''),\r\n  // mp3, mp4, aac etc.\r\n  netStreamMimeTypes = /^\\s*audio\\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4|m4v|m4a|m4b|mp4v|3gp|3g2)\\s*(?:$|;)/i,\r\n  // Flash v9.0r115+ \"moviestar\" formats\r\n  netStreamTypes = ['mpeg4', 'aac', 'flv', 'mov', 'mp4', 'm4v', 'f4v', 'm4a', 'm4b', 'mp4v', '3gp', '3g2'],\r\n  netStreamPattern = new RegExp('\\\\.(' + netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n\r\n  this.mimePattern = /^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i; // default mp3 set\r\n\r\n  // use altURL if not \"online\"\r\n  this.useAltURL = !overHTTP;\r\n\r\n  swfCSS = {\r\n    swfBox: 'sm2-object-box',\r\n    swfDefault: 'movieContainer',\r\n    swfError: 'swf_error', // SWF loaded, but SM2 couldn't start (other error)\r\n    swfTimedout: 'swf_timedout',\r\n    swfLoaded: 'swf_loaded',\r\n    swfUnblocked: 'swf_unblocked', // or loaded OK\r\n    sm2Debug: 'sm2_debug',\r\n    highPerf: 'high_performance',\r\n    flashDebug: 'flash_debug'\r\n  };\r\n\r\n  /**\r\n   * HTML5 error codes, per W3C\r\n   * Error code 1, MEDIA_ERR_ABORTED: Client aborted download at user's request.\r\n   * Error code 2, MEDIA_ERR_NETWORK: A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.\r\n   * Error code 3, MEDIA_ERR_DECODE: An error of some description occurred while decoding the media resource, after the resource was established to be usable.\r\n   * Error code 4, MEDIA_ERR_SRC_NOT_SUPPORTED: Media (audio file) not supported (\"not usable.\")\r\n   * Reference: https://html.spec.whatwg.org/multipage/embedded-content.html#error-codes\r\n   */\r\n  html5ErrorCodes = [\r\n    null,\r\n    'MEDIA_ERR_ABORTED',\r\n    'MEDIA_ERR_NETWORK',\r\n    'MEDIA_ERR_DECODE',\r\n    'MEDIA_ERR_SRC_NOT_SUPPORTED'\r\n  ];\r\n\r\n  /**\r\n   * basic HTML5 Audio() support test\r\n   * try...catch because of IE 9 \"not implemented\" nonsense\r\n   * https://github.com/Modernizr/Modernizr/issues/224\r\n   */\r\n\r\n  this.hasHTML5 = (function() {\r\n    try {\r\n      // new Audio(null) for stupid Opera 9.64 case, which throws not_enough_arguments exception otherwise.\r\n      return (Audio !== _undefined && (isOpera && opera !== _undefined && opera.version() < 10 ? new Audio(null) : new Audio()).canPlayType !== _undefined);\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  }());\r\n\r\n  /**\r\n   * Public SoundManager API\r\n   * -----------------------\r\n   */\r\n\r\n  /**\r\n   * Configures top-level soundManager properties.\r\n   *\r\n   * @param {object} options Option parameters, eg. { flashVersion: 9, url: '/path/to/swfs/' }\r\n   * onready and ontimeout are also accepted parameters. call soundManager.setup() to see the full list.\r\n   */\r\n\r\n  this.setup = function(options) {\r\n\r\n    var noURL = (!sm2.url);\r\n\r\n    // warn if flash options have already been applied\r\n\r\n    if (options !== _undefined && didInit && needsFlash && sm2.ok() && (options.flashVersion !== _undefined || options.url !== _undefined || options.html5Test !== _undefined)) {\r\n      complain(str('setupLate'));\r\n    }\r\n\r\n    // TODO: defer: true?\r\n\r\n    assign(options);\r\n\r\n    if (!useGlobalHTML5Audio) {\r\n\r\n      if (mobileHTML5) {\r\n\r\n        // force the singleton HTML5 pattern on mobile, by default.\r\n        if (!sm2.setupOptions.ignoreMobileRestrictions || sm2.setupOptions.forceUseGlobalHTML5Audio) {\r\n          messages.push(strings.globalHTML5);\r\n          useGlobalHTML5Audio = true;\r\n        }\r\n\r\n      } else if (sm2.setupOptions.forceUseGlobalHTML5Audio) {\r\n\r\n        // only apply singleton HTML5 on desktop if forced.\r\n        messages.push(strings.globalHTML5);\r\n        useGlobalHTML5Audio = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (!didSetup && mobileHTML5) {\r\n\r\n      if (sm2.setupOptions.ignoreMobileRestrictions) {\r\n\r\n        messages.push(strings.ignoreMobile);\r\n\r\n      } else {\r\n\r\n        // prefer HTML5 for mobile + tablet-like devices, probably more reliable vs. flash at this point.\r\n\r\n        // <d>\r\n        if (!sm2.setupOptions.useHTML5Audio || sm2.setupOptions.preferFlash) {\r\n          // notify that defaults are being changed.\r\n          sm2._wD(strings.mobileUA);\r\n        }\r\n        // </d>\r\n\r\n        sm2.setupOptions.useHTML5Audio = true;\r\n        sm2.setupOptions.preferFlash = false;\r\n\r\n        if (is_iDevice) {\r\n\r\n          // no flash here.\r\n          sm2.ignoreFlash = true;\r\n\r\n        } else if ((isAndroid && !ua.match(/android\\s2\\.3/i)) || !isAndroid) {\r\n\r\n          /**\r\n           * Android devices tend to work better with a single audio instance, specifically for chained playback of sounds in sequence.\r\n           * Common use case: exiting sound onfinish() -> createSound() -> play()\r\n           * Presuming similar restrictions for other mobile, non-Android, non-iOS devices.\r\n           */\r\n\r\n          // <d>\r\n          sm2._wD(strings.globalHTML5);\r\n          // </d>\r\n\r\n          useGlobalHTML5Audio = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // special case 1: \"Late setup\". SM2 loaded normally, but user didn't assign flash URL eg., setup({url:...}) before SM2 init. Treat as delayed init.\r\n\r\n    if (options) {\r\n\r\n      if (noURL && didDCLoaded && options.url !== _undefined) {\r\n        sm2.beginDelayedInit();\r\n      }\r\n\r\n      // special case 2: If lazy-loading SM2 (DOMContentLoaded has already happened) and user calls setup() with url: parameter, try to init ASAP.\r\n\r\n      if (!didDCLoaded && options.url !== _undefined && doc.readyState === 'complete') {\r\n        setTimeout(domContentLoaded, 1);\r\n      }\r\n\r\n    }\r\n\r\n    didSetup = true;\r\n\r\n    return sm2;\r\n\r\n  };\r\n\r\n  this.ok = function() {\r\n\r\n    return (needsFlash ? (didInit && !disabled) : (sm2.useHTML5Audio && sm2.hasHTML5));\r\n\r\n  };\r\n\r\n  this.supported = this.ok; // legacy\r\n\r\n  this.getMovie = function(movie_id) {\r\n\r\n    // safety net: some old browsers differ on SWF references, possibly related to ExternalInterface / flash version\r\n    return id(movie_id) || doc[movie_id] || window[movie_id];\r\n\r\n  };\r\n\r\n  /**\r\n   * Creates a SMSound sound object instance. Can also be overloaded, e.g., createSound('mySound', '/some.mp3');\r\n   *\r\n   * @param {object} oOptions Sound options (at minimum, url parameter is required.)\r\n   * @return {object} SMSound The new SMSound object.\r\n   */\r\n\r\n  this.createSound = function(oOptions, _url) {\r\n\r\n    var cs, cs_string, options, oSound = null;\r\n\r\n    // <d>\r\n    cs = sm + '.createSound(): ';\r\n    cs_string = cs + str(!didInit ? 'notReady' : 'notOK');\r\n    // </d>\r\n\r\n    if (!didInit || !sm2.ok()) {\r\n      complain(cs_string);\r\n      return false;\r\n    }\r\n\r\n    if (_url !== _undefined) {\r\n      // function overloading in JS! :) ... assume simple createSound(id, url) use case.\r\n      oOptions = {\r\n        id: oOptions,\r\n        url: _url\r\n      };\r\n    }\r\n\r\n    // inherit from defaultOptions\r\n    options = mixin(oOptions);\r\n\r\n    options.url = parseURL(options.url);\r\n\r\n    // generate an id, if needed.\r\n    if (options.id === _undefined) {\r\n      options.id = sm2.setupOptions.idPrefix + (idCounter++);\r\n    }\r\n\r\n    // <d>\r\n    if (options.id.toString().charAt(0).match(/^[0-9]$/)) {\r\n      sm2._wD(cs + str('badID', options.id), 2);\r\n    }\r\n\r\n    sm2._wD(cs + options.id + (options.url ? ' (' + options.url + ')' : ''), 1);\r\n    // </d>\r\n\r\n    if (idCheck(options.id, true)) {\r\n      sm2._wD(cs + options.id + ' exists', 1);\r\n      return sm2.sounds[options.id];\r\n    }\r\n\r\n    function make() {\r\n\r\n      options = loopFix(options);\r\n      sm2.sounds[options.id] = new SMSound(options);\r\n      sm2.soundIDs.push(options.id);\r\n      return sm2.sounds[options.id];\r\n\r\n    }\r\n\r\n    if (html5OK(options)) {\r\n\r\n      oSound = make();\r\n      // <d>\r\n      if (!sm2.html5Only) {\r\n        sm2._wD(options.id + ': Using HTML5');\r\n      }\r\n      // </d>\r\n      oSound._setup_html5(options);\r\n\r\n    } else {\r\n\r\n      if (sm2.html5Only) {\r\n        sm2._wD(options.id + ': No HTML5 support for this sound, and no Flash. Exiting.');\r\n        return make();\r\n      }\r\n\r\n      // TODO: Move HTML5/flash checks into generic URL parsing/handling function.\r\n\r\n      if (sm2.html5.usingFlash && options.url && options.url.match(/data:/i)) {\r\n        // data: URIs not supported by Flash, either.\r\n        sm2._wD(options.id + ': data: URIs not supported via Flash. Exiting.');\r\n        return make();\r\n      }\r\n\r\n      if (fV > 8) {\r\n        if (options.isMovieStar === null) {\r\n          // attempt to detect MPEG-4 formats\r\n          options.isMovieStar = !!(options.serverURL || (options.type ? options.type.match(netStreamMimeTypes) : false) || (options.url && options.url.match(netStreamPattern)));\r\n        }\r\n        // <d>\r\n        if (options.isMovieStar) {\r\n          sm2._wD(cs + 'using MovieStar handling');\r\n          if (options.loops > 1) {\r\n            _wDS('noNSLoop');\r\n          }\r\n        }\r\n        // </d>\r\n      }\r\n\r\n      options = policyFix(options, cs);\r\n      oSound = make();\r\n\r\n      if (fV === 8) {\r\n        flash._createSound(options.id, options.loops || 1, options.usePolicyFile);\r\n      } else {\r\n        flash._createSound(options.id, options.url, options.usePeakData, options.useWaveformData, options.useEQData, options.isMovieStar, (options.isMovieStar ? options.bufferTime : false), options.loops || 1, options.serverURL, options.duration || null, options.autoPlay, true, options.autoLoad, options.usePolicyFile);\r\n        if (!options.serverURL) {\r\n          // We are connected immediately\r\n          oSound.connected = true;\r\n          if (options.onconnect) {\r\n            options.onconnect.apply(oSound);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!options.serverURL && (options.autoLoad || options.autoPlay)) {\r\n        // call load for non-rtmp streams\r\n        oSound.load(options);\r\n      }\r\n\r\n    }\r\n\r\n    // rtmp will play in onconnect\r\n    if (!options.serverURL && options.autoPlay) {\r\n      oSound.play();\r\n    }\r\n\r\n    return oSound;\r\n\r\n  };\r\n\r\n  /**\r\n   * Destroys a SMSound sound object instance.\r\n   *\r\n   * @param {string} sID The ID of the sound to destroy\r\n   */\r\n\r\n  this.destroySound = function(sID, _bFromSound) {\r\n\r\n    // explicitly destroy a sound before normal page unload, etc.\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    var oS = sm2.sounds[sID], i;\r\n\r\n    oS.stop();\r\n\r\n    // Disable all callbacks after stop(), when the sound is being destroyed\r\n    oS._iO = {};\r\n\r\n    oS.unload();\r\n\r\n    for (i = 0; i < sm2.soundIDs.length; i++) {\r\n      if (sm2.soundIDs[i] === sID) {\r\n        sm2.soundIDs.splice(i, 1);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!_bFromSound) {\r\n      // ignore if being called from SMSound instance\r\n      oS.destruct(true);\r\n    }\r\n\r\n    oS = null;\r\n    delete sm2.sounds[sID];\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the load() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {object} oOptions Optional: Sound options\r\n   */\r\n\r\n  this.load = function(sID, oOptions) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].load(oOptions);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the unload() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   */\r\n\r\n  this.unload = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].unload();\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the onPosition() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {number} nPosition The position to watch for\r\n   * @param {function} oMethod The relevant callback to fire\r\n   * @param {object} oScope Optional: The scope to apply the callback to\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.onPosition = function(sID, nPosition, oMethod, oScope) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].onposition(nPosition, oMethod, oScope);\r\n\r\n  };\r\n\r\n  // legacy/backwards-compability: lower-case method name\r\n  this.onposition = this.onPosition;\r\n\r\n  /**\r\n   * Calls the clearOnPosition() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {number} nPosition The position to watch for\r\n   * @param {function} oMethod Optional: The relevant callback to fire\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.clearOnPosition = function(sID, nPosition, oMethod) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].clearOnPosition(nPosition, oMethod);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the play() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {object} oOptions Optional: Sound options\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.play = function(sID, oOptions) {\r\n\r\n    var result = null,\r\n        // legacy function-overloading use case: play('mySound', '/path/to/some.mp3');\r\n        overloaded = (oOptions && !(oOptions instanceof Object));\r\n\r\n    if (!didInit || !sm2.ok()) {\r\n      complain(sm + '.play(): ' + str(!didInit ? 'notReady' : 'notOK'));\r\n      return false;\r\n    }\r\n\r\n    if (!idCheck(sID, overloaded)) {\r\n\r\n      // no sound found for the given ID. Bail.\r\n      if (!overloaded) return false;\r\n\r\n      if (overloaded) {\r\n        oOptions = {\r\n          url: oOptions\r\n        };\r\n      }\r\n\r\n      if (oOptions && oOptions.url) {\r\n        // overloading use case, create+play: .play('someID', {url:'/path/to.mp3'});\r\n        sm2._wD(sm + '.play(): Attempting to create \"' + sID + '\"', 1);\r\n        oOptions.id = sID;\r\n        result = sm2.createSound(oOptions).play();\r\n      }\r\n\r\n    } else if (overloaded) {\r\n\r\n      // existing sound object case\r\n      oOptions = {\r\n        url: oOptions\r\n      };\r\n\r\n    }\r\n\r\n    if (result === null) {\r\n      // default case\r\n      result = sm2.sounds[sID].play(oOptions);\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  // just for convenience\r\n  this.start = this.play;\r\n\r\n  /**\r\n   * Calls the setPlaybackRate() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.setPlaybackRate = function(sID, rate, allowOverride) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].setPlaybackRate(rate, allowOverride);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the setPosition() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {number} nMsecOffset Position (milliseconds)\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.setPosition = function(sID, nMsecOffset) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].setPosition(nMsecOffset);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the stop() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.stop = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    sm2._wD(sm + '.stop(' + sID + ')', 1);\r\n\r\n    return sm2.sounds[sID].stop();\r\n\r\n  };\r\n\r\n  /**\r\n   * Stops all currently-playing sounds.\r\n   */\r\n\r\n  this.stopAll = function() {\r\n\r\n    var oSound;\r\n    sm2._wD(sm + '.stopAll()', 1);\r\n\r\n    for (oSound in sm2.sounds) {\r\n      if (sm2.sounds.hasOwnProperty(oSound)) {\r\n        // apply only to sound objects\r\n        sm2.sounds[oSound].stop();\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the pause() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.pause = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].pause();\r\n\r\n  };\r\n\r\n  /**\r\n   * Pauses all currently-playing sounds.\r\n   */\r\n\r\n  this.pauseAll = function() {\r\n\r\n    var i;\r\n    for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n      sm2.sounds[sm2.soundIDs[i]].pause();\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the resume() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.resume = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].resume();\r\n\r\n  };\r\n\r\n  /**\r\n   * Resumes all currently-paused sounds.\r\n   */\r\n\r\n  this.resumeAll = function() {\r\n\r\n    var i;\r\n    for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n      sm2.sounds[sm2.soundIDs[i]].resume();\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the togglePause() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.togglePause = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].togglePause();\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the setPan() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {number} nPan The pan value (-100 to 100)\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.setPan = function(sID, nPan) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].setPan(nPan);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the setVolume() method of a SMSound object by ID\r\n   * Overloaded case: pass only volume argument eg., setVolume(50) to apply to all sounds.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @param {number} nVol The volume value (0 to 100)\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.setVolume = function(sID, nVol) {\r\n\r\n    // setVolume(50) function overloading case - apply to all sounds\r\n\r\n    var i, j;\r\n\r\n    if (sID !== _undefined && !isNaN(sID) && nVol === _undefined) {\r\n      for (i = 0, j = sm2.soundIDs.length; i < j; i++) {\r\n        sm2.sounds[sm2.soundIDs[i]].setVolume(sID);\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // setVolume('mySound', 50) case\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].setVolume(nVol);\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the mute() method of either a single SMSound object by ID, or all sound objects.\r\n   *\r\n   * @param {string} sID Optional: The ID of the sound (if omitted, all sounds will be used.)\r\n   */\r\n\r\n  this.mute = function(sID) {\r\n\r\n    var i = 0;\r\n\r\n    if (sID instanceof String) {\r\n      sID = null;\r\n    }\r\n\r\n    if (!sID) {\r\n\r\n      sm2._wD(sm + '.mute(): Muting all sounds');\r\n      for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n        sm2.sounds[sm2.soundIDs[i]].mute();\r\n      }\r\n      sm2.muted = true;\r\n\r\n    } else {\r\n\r\n      if (!idCheck(sID)) return false;\r\n\r\n      sm2._wD(sm + '.mute(): Muting \"' + sID + '\"');\r\n      return sm2.sounds[sID].mute();\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  /**\r\n   * Mutes all sounds.\r\n   */\r\n\r\n  this.muteAll = function() {\r\n\r\n    sm2.mute();\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the unmute() method of either a single SMSound object by ID, or all sound objects.\r\n   *\r\n   * @param {string} sID Optional: The ID of the sound (if omitted, all sounds will be used.)\r\n   */\r\n\r\n  this.unmute = function(sID) {\r\n\r\n    var i;\r\n\r\n    if (sID instanceof String) {\r\n      sID = null;\r\n    }\r\n\r\n    if (!sID) {\r\n\r\n      sm2._wD(sm + '.unmute(): Unmuting all sounds');\r\n      for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n        sm2.sounds[sm2.soundIDs[i]].unmute();\r\n      }\r\n      sm2.muted = false;\r\n\r\n    } else {\r\n\r\n      if (!idCheck(sID)) return false;\r\n\r\n      sm2._wD(sm + '.unmute(): Unmuting \"' + sID + '\"');\r\n\r\n      return sm2.sounds[sID].unmute();\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  /**\r\n   * Unmutes all sounds.\r\n   */\r\n\r\n  this.unmuteAll = function() {\r\n\r\n    sm2.unmute();\r\n\r\n  };\r\n\r\n  /**\r\n   * Calls the toggleMute() method of a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.toggleMute = function(sID) {\r\n\r\n    if (!idCheck(sID)) return false;\r\n\r\n    return sm2.sounds[sID].toggleMute();\r\n\r\n  };\r\n\r\n  /**\r\n   * Retrieves the memory used by the flash plugin.\r\n   *\r\n   * @return {number} The amount of memory in use\r\n   */\r\n\r\n  this.getMemoryUse = function() {\r\n\r\n    // flash-only\r\n    var ram = 0;\r\n\r\n    if (flash && fV !== 8) {\r\n      ram = parseInt(flash._getMemoryUse(), 10);\r\n    }\r\n\r\n    return ram;\r\n\r\n  };\r\n\r\n  /**\r\n   * Undocumented: NOPs soundManager and all SMSound objects.\r\n   */\r\n\r\n  this.disable = function(bNoDisable) {\r\n\r\n    // destroy all functions\r\n    var i;\r\n\r\n    if (bNoDisable === _undefined) {\r\n      bNoDisable = false;\r\n    }\r\n\r\n    // already disabled?\r\n    if (disabled) return false;\r\n\r\n    disabled = true;\r\n\r\n    _wDS('shutdown', 1);\r\n\r\n    for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n      disableObject(sm2.sounds[sm2.soundIDs[i]]);\r\n    }\r\n\r\n    disableObject(sm2);\r\n\r\n    // fire \"complete\", despite fail\r\n    initComplete(bNoDisable);\r\n\r\n    event.remove(window, 'load', initUserOnload);\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  /**\r\n   * Determines playability of a MIME type, eg. 'audio/mp3'.\r\n   */\r\n\r\n  this.canPlayMIME = function(sMIME) {\r\n\r\n    var result;\r\n\r\n    if (sm2.hasHTML5) {\r\n      result = html5CanPlay({\r\n        type: sMIME\r\n      });\r\n    }\r\n\r\n    if (!result && needsFlash) {\r\n      // if flash 9, test netStream (movieStar) types as well.\r\n      result = (sMIME && sm2.ok() ? !!((fV > 8 ? sMIME.match(netStreamMimeTypes) : null) || sMIME.match(sm2.mimePattern)) : null); // TODO: make less \"weird\" (per JSLint)\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * Determines playability of a URL based on audio support.\r\n   *\r\n   * @param {string} sURL The URL to test\r\n   * @return {boolean} URL playability\r\n   */\r\n\r\n  this.canPlayURL = function(sURL) {\r\n\r\n    var result;\r\n\r\n    if (sm2.hasHTML5) {\r\n      result = html5CanPlay({\r\n        url: sURL\r\n      });\r\n    }\r\n\r\n    if (!result && needsFlash) {\r\n      result = (sURL && sm2.ok() ? !!(sURL.match(sm2.filePattern)) : null);\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * Determines playability of an HTML DOM &lt;a&gt; object (or similar object literal) based on audio support.\r\n   *\r\n   * @param {object} oLink an HTML DOM &lt;a&gt; object or object literal including href and/or type attributes\r\n   * @return {boolean} URL playability\r\n   */\r\n\r\n  this.canPlayLink = function(oLink) {\r\n\r\n    if (oLink.type !== _undefined && oLink.type && sm2.canPlayMIME(oLink.type)) return true;\r\n\r\n    return sm2.canPlayURL(oLink.href);\r\n\r\n  };\r\n\r\n  /**\r\n   * Retrieves a SMSound object by ID.\r\n   *\r\n   * @param {string} sID The ID of the sound\r\n   * @return {SMSound} The SMSound object\r\n   */\r\n\r\n  this.getSoundById = function(sID, _suppressDebug) {\r\n\r\n    if (!sID) return null;\r\n\r\n    var result = sm2.sounds[sID];\r\n\r\n    // <d>\r\n    if (!result && !_suppressDebug) {\r\n      sm2._wD(sm + '.getSoundById(): Sound \"' + sID + '\" not found.', 2);\r\n    }\r\n    // </d>\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * Queues a callback for execution when SoundManager has successfully initialized.\r\n   *\r\n   * @param {function} oMethod The callback method to fire\r\n   * @param {object} oScope Optional: The scope to apply to the callback\r\n   */\r\n\r\n  this.onready = function(oMethod, oScope) {\r\n\r\n    var sType = 'onready',\r\n        result = false;\r\n\r\n    if (typeof oMethod === 'function') {\r\n\r\n      // <d>\r\n      if (didInit) {\r\n        sm2._wD(str('queue', sType));\r\n      }\r\n      // </d>\r\n\r\n      if (!oScope) {\r\n        oScope = window;\r\n      }\r\n\r\n      addOnEvent(sType, oMethod, oScope);\r\n      processOnEvents();\r\n\r\n      result = true;\r\n\r\n    } else {\r\n\r\n      throw str('needFunction', sType);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * Queues a callback for execution when SoundManager has failed to initialize.\r\n   *\r\n   * @param {function} oMethod The callback method to fire\r\n   * @param {object} oScope Optional: The scope to apply to the callback\r\n   */\r\n\r\n  this.ontimeout = function(oMethod, oScope) {\r\n\r\n    var sType = 'ontimeout',\r\n        result = false;\r\n\r\n    if (typeof oMethod === 'function') {\r\n\r\n      // <d>\r\n      if (didInit) {\r\n        sm2._wD(str('queue', sType));\r\n      }\r\n      // </d>\r\n\r\n      if (!oScope) {\r\n        oScope = window;\r\n      }\r\n\r\n      addOnEvent(sType, oMethod, oScope);\r\n      processOnEvents({ type: sType });\r\n\r\n      result = true;\r\n\r\n    } else {\r\n\r\n      throw str('needFunction', sType);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * Writes console.log()-style debug output to a console or in-browser element.\r\n   * Applies when debugMode = true\r\n   *\r\n   * @param {string} sText The console message\r\n   * @param {object} nType Optional log level (number), or object. Number case: Log type/style where 0 = 'info', 1 = 'warn', 2 = 'error'. Object case: Object to be dumped.\r\n   */\r\n\r\n  this._writeDebug = function(sText, sTypeOrObject) {\r\n\r\n    // pseudo-private console.log()-style output\r\n    // <d>\r\n\r\n    var sDID = 'soundmanager-debug', o, oItem;\r\n\r\n    if (!sm2.setupOptions.debugMode) return false;\r\n\r\n    if (hasConsole && sm2.useConsole) {\r\n      if (sTypeOrObject && typeof sTypeOrObject === 'object') {\r\n        // object passed; dump to console.\r\n        console.log(sText, sTypeOrObject);\r\n      } else if (debugLevels[sTypeOrObject] !== _undefined) {\r\n        console[debugLevels[sTypeOrObject]](sText);\r\n      } else {\r\n        console.log(sText);\r\n      }\r\n      if (sm2.consoleOnly) return true;\r\n    }\r\n\r\n    o = id(sDID);\r\n\r\n    if (!o) return false;\r\n\r\n    oItem = doc.createElement('div');\r\n\r\n    if (++wdCount % 2 === 0) {\r\n      oItem.className = 'sm2-alt';\r\n    }\r\n\r\n    if (sTypeOrObject === _undefined) {\r\n      sTypeOrObject = 0;\r\n    } else {\r\n      sTypeOrObject = parseInt(sTypeOrObject, 10);\r\n    }\r\n\r\n    oItem.appendChild(doc.createTextNode(sText));\r\n\r\n    if (sTypeOrObject) {\r\n      if (sTypeOrObject >= 2) {\r\n        oItem.style.fontWeight = 'bold';\r\n      }\r\n      if (sTypeOrObject === 3) {\r\n        oItem.style.color = '#ff3333';\r\n      }\r\n    }\r\n\r\n    // top-to-bottom\r\n    // o.appendChild(oItem);\r\n\r\n    // bottom-to-top\r\n    o.insertBefore(oItem, o.firstChild);\r\n\r\n    o = null;\r\n    // </d>\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  // <d>\r\n  // last-resort debugging option\r\n  if (wl.indexOf('sm2-debug=alert') !== -1) {\r\n    this._writeDebug = function(sText) {\r\n      window.alert(sText);\r\n    };\r\n  }\r\n  // </d>\r\n\r\n  // alias\r\n  this._wD = this._writeDebug;\r\n\r\n  /**\r\n   * Provides debug / state information on all SMSound objects.\r\n   */\r\n\r\n  this._debug = function() {\r\n\r\n    // <d>\r\n    var i, j;\r\n    _wDS('currentObj', 1);\r\n\r\n    for (i = 0, j = sm2.soundIDs.length; i < j; i++) {\r\n      sm2.sounds[sm2.soundIDs[i]]._debug();\r\n    }\r\n    // </d>\r\n\r\n  };\r\n\r\n  /**\r\n   * Restarts and re-initializes the SoundManager instance.\r\n   *\r\n   * @param {boolean} resetEvents Optional: When true, removes all registered onready and ontimeout event callbacks.\r\n   * @param {boolean} excludeInit Options: When true, does not call beginDelayedInit() (which would restart SM2).\r\n   * @return {object} soundManager The soundManager instance.\r\n   */\r\n\r\n  this.reboot = function(resetEvents, excludeInit) {\r\n\r\n    // reset some (or all) state, and re-init unless otherwise specified.\r\n\r\n    // <d>\r\n    if (sm2.soundIDs.length) {\r\n      sm2._wD('Destroying ' + sm2.soundIDs.length + ' SMSound object' + (sm2.soundIDs.length !== 1 ? 's' : '') + '...');\r\n    }\r\n    // </d>\r\n\r\n    var i, j, k;\r\n\r\n    for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n      sm2.sounds[sm2.soundIDs[i]].destruct();\r\n    }\r\n\r\n    // trash ze flash (remove from the DOM)\r\n\r\n    if (flash) {\r\n\r\n      try {\r\n\r\n        if (isIE) {\r\n          oRemovedHTML = flash.innerHTML;\r\n        }\r\n\r\n        oRemoved = flash.parentNode.removeChild(flash);\r\n\r\n      } catch(e) {\r\n\r\n        // Remove failed? May be due to flash blockers silently removing the SWF object/embed node from the DOM. Warn and continue.\r\n\r\n        _wDS('badRemove', 2);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // actually, force recreate of movie.\r\n\r\n    oRemovedHTML = oRemoved = needsFlash = flash = null;\r\n\r\n    sm2.enabled = didDCLoaded = didInit = waitingForEI = initPending = didAppend = appendSuccess = disabled = useGlobalHTML5Audio = sm2.swfLoaded = false;\r\n\r\n    sm2.soundIDs = [];\r\n    sm2.sounds = {};\r\n\r\n    idCounter = 0;\r\n    didSetup = false;\r\n\r\n    if (!resetEvents) {\r\n      // reset callbacks for onready, ontimeout etc. so that they will fire again on re-init\r\n      for (i in on_queue) {\r\n        if (on_queue.hasOwnProperty(i)) {\r\n          for (j = 0, k = on_queue[i].length; j < k; j++) {\r\n            on_queue[i][j].fired = false;\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      // remove all callbacks entirely\r\n      on_queue = [];\r\n    }\r\n\r\n    // <d>\r\n    if (!excludeInit) {\r\n      sm2._wD(sm + ': Rebooting...');\r\n    }\r\n    // </d>\r\n\r\n    // reset HTML5 and flash canPlay test results\r\n\r\n    sm2.html5 = {\r\n      usingFlash: null\r\n    };\r\n\r\n    sm2.flash = {};\r\n\r\n    // reset device-specific HTML/flash mode switches\r\n\r\n    sm2.html5Only = false;\r\n    sm2.ignoreFlash = false;\r\n\r\n    window.setTimeout(function() {\r\n\r\n      // by default, re-init\r\n\r\n      if (!excludeInit) {\r\n        sm2.beginDelayedInit();\r\n      }\r\n\r\n    }, 20);\r\n\r\n    return sm2;\r\n\r\n  };\r\n\r\n  this.reset = function() {\r\n\r\n    /**\r\n     * Shuts down and restores the SoundManager instance to its original loaded state, without an explicit reboot. All onready/ontimeout handlers are removed.\r\n     * After this call, SM2 may be re-initialized via soundManager.beginDelayedInit().\r\n     * @return {object} soundManager The soundManager instance.\r\n     */\r\n\r\n    _wDS('reset');\r\n\r\n    return sm2.reboot(true, true);\r\n\r\n  };\r\n\r\n  /**\r\n   * Undocumented: Determines the SM2 flash movie's load progress.\r\n   *\r\n   * @return {number or null} Percent loaded, or if invalid/unsupported, null.\r\n   */\r\n\r\n  this.getMoviePercent = function() {\r\n\r\n    /**\r\n     * Interesting syntax notes...\r\n     * Flash/ExternalInterface (ActiveX/NPAPI) bridge methods are not typeof \"function\" nor instanceof Function, but are still valid.\r\n     * Furthermore, using (flash && flash.PercentLoaded) causes IE to throw \"object doesn't support this property or method\".\r\n     * Thus, 'in' syntax must be used.\r\n     */\r\n\r\n    return (flash && 'PercentLoaded' in flash ? flash.PercentLoaded() : null);\r\n\r\n  };\r\n\r\n  /**\r\n   * Additional helper for manually invoking SM2's init process after DOM Ready / window.onload().\r\n   */\r\n\r\n  this.beginDelayedInit = function() {\r\n\r\n    windowLoaded = true;\r\n    domContentLoaded();\r\n\r\n    setTimeout(function() {\r\n\r\n      if (initPending) return false;\r\n\r\n      createMovie();\r\n      initMovie();\r\n      initPending = true;\r\n\r\n      return true;\r\n\r\n    }, 20);\r\n\r\n    delayWaitForEI();\r\n\r\n  };\r\n\r\n  /**\r\n   * Destroys the SoundManager instance and all SMSound instances.\r\n   */\r\n\r\n  this.destruct = function() {\r\n\r\n    sm2._wD(sm + '.destruct()');\r\n    sm2.disable(true);\r\n\r\n  };\r\n\r\n  /**\r\n   * SMSound() (sound object) constructor\r\n   * ------------------------------------\r\n   *\r\n   * @param {object} oOptions Sound options (id and url are required attributes)\r\n   * @return {SMSound} The new SMSound object\r\n   */\r\n\r\n  SMSound = function(oOptions) {\r\n\r\n    var s = this, resetProperties, add_html5_events, remove_html5_events, stop_html5_timer, start_html5_timer, attachOnPosition, onplay_called = false, onPositionItems = [], onPositionFired = 0, detachOnPosition, applyFromTo, lastURL = null, lastHTML5State, urlOmitted;\r\n\r\n    lastHTML5State = {\r\n      // tracks duration + position (time)\r\n      duration: null,\r\n      time: null\r\n    };\r\n\r\n    this.id = oOptions.id;\r\n\r\n    // legacy\r\n    this.sID = this.id;\r\n\r\n    this.url = oOptions.url;\r\n    this.options = mixin(oOptions);\r\n\r\n    // per-play-instance-specific options\r\n    this.instanceOptions = this.options;\r\n\r\n    // short alias\r\n    this._iO = this.instanceOptions;\r\n\r\n    // assign property defaults\r\n    this.pan = this.options.pan;\r\n    this.volume = this.options.volume;\r\n\r\n    // whether or not this object is using HTML5\r\n    this.isHTML5 = false;\r\n\r\n    // internal HTML5 Audio() object reference\r\n    this._a = null;\r\n\r\n    // for flash 8 special-case createSound() without url, followed by load/play with url case\r\n    urlOmitted = (!this.url);\r\n\r\n    /**\r\n     * SMSound() public methods\r\n     * ------------------------\r\n     */\r\n\r\n    this.id3 = {};\r\n\r\n    /**\r\n     * Writes SMSound object parameters to debug console\r\n     */\r\n\r\n    this._debug = function() {\r\n\r\n      // <d>\r\n      sm2._wD(s.id + ': Merged options:', s.options);\r\n      // </d>\r\n\r\n    };\r\n\r\n    /**\r\n     * Begins loading a sound per its *url*.\r\n     *\r\n     * @param {object} options Optional: Sound options\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.load = function(options) {\r\n\r\n      var oSound = null, instanceOptions;\r\n\r\n      if (options !== _undefined) {\r\n        s._iO = mixin(options, s.options);\r\n      } else {\r\n        options = s.options;\r\n        s._iO = options;\r\n        if (lastURL && lastURL !== s.url) {\r\n          _wDS('manURL');\r\n          s._iO.url = s.url;\r\n          s.url = null;\r\n        }\r\n      }\r\n\r\n      if (!s._iO.url) {\r\n        s._iO.url = s.url;\r\n      }\r\n\r\n      s._iO.url = parseURL(s._iO.url);\r\n\r\n      // ensure we're in sync\r\n      s.instanceOptions = s._iO;\r\n\r\n      // local shortcut\r\n      instanceOptions = s._iO;\r\n\r\n      sm2._wD(s.id + ': load (' + instanceOptions.url + ')');\r\n\r\n      if (!instanceOptions.url && !s.url) {\r\n        sm2._wD(s.id + ': load(): url is unassigned. Exiting.', 2);\r\n        return s;\r\n      }\r\n\r\n      // <d>\r\n      if (!s.isHTML5 && fV === 8 && !s.url && !instanceOptions.autoPlay) {\r\n        // flash 8 load() -> play() won't work before onload has fired.\r\n        sm2._wD(s.id + ': Flash 8 load() limitation: Wait for onload() before calling play().', 1);\r\n      }\r\n      // </d>\r\n\r\n      if (instanceOptions.url === s.url && s.readyState !== 0 && s.readyState !== 2) {\r\n        _wDS('onURL', 1);\r\n        // if loaded and an onload() exists, fire immediately.\r\n        if (s.readyState === 3 && instanceOptions.onload) {\r\n          // assume success based on truthy duration.\r\n          wrapCallback(s, function() {\r\n            instanceOptions.onload.apply(s, [(!!s.duration)]);\r\n          });\r\n        }\r\n        return s;\r\n      }\r\n\r\n      // reset a few state properties\r\n\r\n      s.loaded = false;\r\n      s.readyState = 1;\r\n      s.playState = 0;\r\n      s.id3 = {};\r\n\r\n      // TODO: If switching from HTML5 -> flash (or vice versa), stop currently-playing audio.\r\n\r\n      if (html5OK(instanceOptions)) {\r\n\r\n        oSound = s._setup_html5(instanceOptions);\r\n\r\n        if (!oSound._called_load) {\r\n\r\n          s._html5_canplay = false;\r\n\r\n          // TODO: review called_load / html5_canplay logic\r\n\r\n          // if url provided directly to load(), assign it here.\r\n\r\n          if (s.url !== instanceOptions.url) {\r\n\r\n            sm2._wD(_wDS('manURL') + ': ' + instanceOptions.url);\r\n\r\n            s._a.src = instanceOptions.url;\r\n\r\n            // TODO: review / re-apply all relevant options (volume, loop, onposition etc.)\r\n\r\n            // reset position for new URL\r\n            s.setPosition(0);\r\n\r\n          }\r\n\r\n          // given explicit load call, try to preload.\r\n\r\n          // early HTML5 implementation (non-standard)\r\n          s._a.autobuffer = 'auto';\r\n\r\n          // standard property, values: none / metadata / auto\r\n          // reference: http://msdn.microsoft.com/en-us/library/ie/ff974759%28v=vs.85%29.aspx\r\n          s._a.preload = 'auto';\r\n\r\n          s._a._called_load = true;\r\n\r\n        } else {\r\n\r\n          sm2._wD(s.id + ': Ignoring request to load again');\r\n\r\n        }\r\n\r\n      } else {\r\n\r\n        if (sm2.html5Only) {\r\n          sm2._wD(s.id + ': No flash support. Exiting.');\r\n          return s;\r\n        }\r\n\r\n        if (s._iO.url && s._iO.url.match(/data:/i)) {\r\n          // data: URIs not supported by Flash, either.\r\n          sm2._wD(s.id + ': data: URIs not supported via Flash. Exiting.');\r\n          return s;\r\n        }\r\n\r\n        try {\r\n          s.isHTML5 = false;\r\n          s._iO = policyFix(loopFix(instanceOptions));\r\n          // if we have \"position\", disable auto-play as we'll be seeking to that position at onload().\r\n          if (s._iO.autoPlay && (s._iO.position || s._iO.from)) {\r\n            sm2._wD(s.id + ': Disabling autoPlay because of non-zero offset case');\r\n            s._iO.autoPlay = false;\r\n          }\r\n          // re-assign local shortcut\r\n          instanceOptions = s._iO;\r\n          if (fV === 8) {\r\n            flash._load(s.id, instanceOptions.url, instanceOptions.stream, instanceOptions.autoPlay, instanceOptions.usePolicyFile);\r\n          } else {\r\n            flash._load(s.id, instanceOptions.url, !!(instanceOptions.stream), !!(instanceOptions.autoPlay), instanceOptions.loops || 1, !!(instanceOptions.autoLoad), instanceOptions.usePolicyFile);\r\n          }\r\n        } catch(e) {\r\n          _wDS('smError', 2);\r\n          debugTS('onload', false);\r\n          catchError({\r\n            type: 'SMSOUND_LOAD_JS_EXCEPTION',\r\n            fatal: true\r\n          });\r\n        }\r\n\r\n      }\r\n\r\n      // after all of this, ensure sound url is up to date.\r\n      s.url = instanceOptions.url;\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Unloads a sound, canceling any open HTTP requests.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.unload = function() {\r\n\r\n      // Flash 8/AS2 can't \"close\" a stream - fake it by loading an empty URL\r\n      // Flash 9/AS3: Close stream, preventing further load\r\n      // HTML5: Most UAs will use empty URL\r\n\r\n      if (s.readyState !== 0) {\r\n\r\n        sm2._wD(s.id + ': unload()');\r\n\r\n        if (!s.isHTML5) {\r\n\r\n          if (fV === 8) {\r\n            flash._unload(s.id, emptyURL);\r\n          } else {\r\n            flash._unload(s.id);\r\n          }\r\n\r\n        } else {\r\n\r\n          stop_html5_timer();\r\n\r\n          if (s._a) {\r\n\r\n            s._a.pause();\r\n\r\n            // update empty URL, too\r\n            lastURL = html5Unload(s._a);\r\n\r\n          }\r\n\r\n        }\r\n\r\n        // reset load/status flags\r\n        resetProperties();\r\n\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Unloads and destroys a sound.\r\n     */\r\n\r\n    this.destruct = function(_bFromSM) {\r\n\r\n      sm2._wD(s.id + ': Destruct');\r\n\r\n      if (!s.isHTML5) {\r\n\r\n        // kill sound within Flash\r\n        // Disable the onfailure handler\r\n        s._iO.onfailure = null;\r\n        flash._destroySound(s.id);\r\n\r\n      } else {\r\n\r\n        stop_html5_timer();\r\n\r\n        if (s._a) {\r\n          s._a.pause();\r\n          html5Unload(s._a);\r\n          if (!useGlobalHTML5Audio) {\r\n            remove_html5_events();\r\n          }\r\n          // break obvious circular reference\r\n          s._a._s = null;\r\n          s._a = null;\r\n        }\r\n\r\n      }\r\n\r\n      if (!_bFromSM) {\r\n        // ensure deletion from controller\r\n        sm2.destroySound(s.id, true);\r\n      }\r\n\r\n    };\r\n\r\n    /**\r\n     * Begins playing a sound.\r\n     *\r\n     * @param {object} options Optional: Sound options\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.play = function(options, _updatePlayState) {\r\n\r\n      var fN, allowMulti, a, onready,\r\n          audioClone, onended, oncanplay,\r\n          startOK = true;\r\n\r\n      // <d>\r\n      fN = s.id + ': play(): ';\r\n      // </d>\r\n\r\n      // default to true\r\n      _updatePlayState = (_updatePlayState === _undefined ? true : _updatePlayState);\r\n\r\n      if (!options) {\r\n        options = {};\r\n      }\r\n\r\n      // first, use local URL (if specified)\r\n      if (s.url) {\r\n        s._iO.url = s.url;\r\n      }\r\n\r\n      // mix in any options defined at createSound()\r\n      s._iO = mixin(s._iO, s.options);\r\n\r\n      // mix in any options specific to this method\r\n      s._iO = mixin(options, s._iO);\r\n\r\n      s._iO.url = parseURL(s._iO.url);\r\n\r\n      s.instanceOptions = s._iO;\r\n\r\n      // RTMP-only\r\n      if (!s.isHTML5 && s._iO.serverURL && !s.connected) {\r\n        if (!s.getAutoPlay()) {\r\n          sm2._wD(fN + ' Netstream not connected yet - setting autoPlay');\r\n          s.setAutoPlay(true);\r\n        }\r\n        // play will be called in onconnect()\r\n        return s;\r\n      }\r\n\r\n      if (html5OK(s._iO)) {\r\n        s._setup_html5(s._iO);\r\n        start_html5_timer();\r\n      }\r\n\r\n      if (s.playState === 1 && !s.paused) {\r\n\r\n        allowMulti = s._iO.multiShot;\r\n\r\n        if (!allowMulti) {\r\n\r\n          sm2._wD(fN + 'Already playing (one-shot)', 1);\r\n\r\n          if (s.isHTML5) {\r\n            // go back to original position.\r\n            s.setPosition(s._iO.position);\r\n          }\r\n\r\n          return s;\r\n\r\n        }\r\n\r\n        sm2._wD(fN + 'Already playing (multi-shot)', 1);\r\n\r\n      }\r\n\r\n      // edge case: play() with explicit URL parameter\r\n      if (options.url && options.url !== s.url) {\r\n\r\n        // special case for createSound() followed by load() / play() with url; avoid double-load case.\r\n        if (!s.readyState && !s.isHTML5 && fV === 8 && urlOmitted) {\r\n\r\n          urlOmitted = false;\r\n\r\n        } else {\r\n\r\n          // load using merged options\r\n          s.load(s._iO);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (!s.loaded) {\r\n\r\n        if (s.readyState === 0) {\r\n\r\n          sm2._wD(fN + 'Attempting to load');\r\n\r\n          // try to get this sound playing ASAP\r\n          if (!s.isHTML5 && !sm2.html5Only) {\r\n\r\n            // flash: assign directly because setAutoPlay() increments the instanceCount\r\n            s._iO.autoPlay = true;\r\n            s.load(s._iO);\r\n\r\n          } else if (s.isHTML5) {\r\n\r\n            // iOS needs this when recycling sounds, loading a new URL on an existing object.\r\n            s.load(s._iO);\r\n\r\n          } else {\r\n\r\n            sm2._wD(fN + 'Unsupported type. Exiting.');\r\n\r\n            return s;\r\n\r\n          }\r\n\r\n          // HTML5 hack - re-set instanceOptions?\r\n          s.instanceOptions = s._iO;\r\n\r\n        } else if (s.readyState === 2) {\r\n\r\n          sm2._wD(fN + 'Could not load - exiting', 2);\r\n\r\n          return s;\r\n\r\n        } else {\r\n\r\n          sm2._wD(fN + 'Loading - attempting to play...');\r\n\r\n        }\r\n\r\n      } else {\r\n\r\n        // \"play()\"\r\n        sm2._wD(fN.substr(0, fN.lastIndexOf(':')));\r\n\r\n      }\r\n\r\n      if (!s.isHTML5 && fV === 9 && s.position > 0 && s.position === s.duration) {\r\n        // flash 9 needs a position reset if play() is called while at the end of a sound.\r\n        sm2._wD(fN + 'Sound at end, resetting to position: 0');\r\n        options.position = 0;\r\n      }\r\n\r\n      /**\r\n       * Streams will pause when their buffer is full if they are being loaded.\r\n       * In this case paused is true, but the song hasn't started playing yet.\r\n       * If we just call resume() the onplay() callback will never be called.\r\n       * So only call resume() if the position is > 0.\r\n       * Another reason is because options like volume won't have been applied yet.\r\n       * For normal sounds, just resume.\r\n       */\r\n\r\n      if (s.paused && s.position >= 0 && (!s._iO.serverURL || s.position > 0)) {\r\n\r\n        // https://gist.github.com/37b17df75cc4d7a90bf6\r\n        sm2._wD(fN + 'Resuming from paused state', 1);\r\n        s.resume();\r\n\r\n      } else {\r\n\r\n        s._iO = mixin(options, s._iO);\r\n\r\n        /**\r\n         * Preload in the event of play() with position under Flash,\r\n         * or from/to parameters and non-RTMP case\r\n         */\r\n        if (((!s.isHTML5 && s._iO.position !== null && s._iO.position > 0) || (s._iO.from !== null && s._iO.from > 0) || s._iO.to !== null) && s.instanceCount === 0 && s.playState === 0 && !s._iO.serverURL) {\r\n\r\n          onready = function() {\r\n            // sound \"canplay\" or onload()\r\n            // re-apply position/from/to to instance options, and start playback\r\n            s._iO = mixin(options, s._iO);\r\n            s.play(s._iO);\r\n          };\r\n\r\n          // HTML5 needs to at least have \"canplay\" fired before seeking.\r\n          if (s.isHTML5 && !s._html5_canplay) {\r\n\r\n            // this hasn't been loaded yet. load it first, and then do this again.\r\n            sm2._wD(fN + 'Beginning load for non-zero offset case');\r\n\r\n            s.load({\r\n              // note: custom HTML5-only event added for from/to implementation.\r\n              _oncanplay: onready\r\n            });\r\n\r\n          } else if (!s.isHTML5 && !s.loaded && (!s.readyState || s.readyState !== 2)) {\r\n\r\n            // to be safe, preload the whole thing in Flash.\r\n\r\n            sm2._wD(fN + 'Preloading for non-zero offset case');\r\n\r\n            s.load({\r\n              onload: onready\r\n            });\r\n\r\n          }\r\n\r\n          // otherwise, we're ready to go. re-apply local options, and continue\r\n\r\n          s._iO = applyFromTo();\r\n\r\n        }\r\n\r\n        // sm2._wD(fN + 'Starting to play');\r\n\r\n        // increment instance counter, where enabled + supported\r\n        if (!s.instanceCount || s._iO.multiShotEvents || (s.isHTML5 && s._iO.multiShot && !useGlobalHTML5Audio) || (!s.isHTML5 && fV > 8 && !s.getAutoPlay())) {\r\n          s.instanceCount++;\r\n        }\r\n\r\n        // if first play and onposition parameters exist, apply them now\r\n        if (s._iO.onposition && s.playState === 0) {\r\n          attachOnPosition(s);\r\n        }\r\n\r\n        s.playState = 1;\r\n        s.paused = false;\r\n\r\n        s.position = (s._iO.position !== _undefined && !isNaN(s._iO.position) ? s._iO.position : 0);\r\n\r\n        if (!s.isHTML5) {\r\n          s._iO = policyFix(loopFix(s._iO));\r\n        }\r\n\r\n        if (s._iO.onplay && _updatePlayState) {\r\n          s._iO.onplay.apply(s);\r\n          onplay_called = true;\r\n        }\r\n\r\n        s.setVolume(s._iO.volume, true);\r\n        s.setPan(s._iO.pan, true);\r\n\r\n        if (s._iO.playbackRate !== 1) {\r\n          s.setPlaybackRate(s._iO.playbackRate);\r\n        }\r\n\r\n        if (!s.isHTML5) {\r\n\r\n          startOK = flash._start(s.id, s._iO.loops || 1, (fV === 9 ? s.position : s.position / msecScale), s._iO.multiShot || false);\r\n\r\n          if (fV === 9 && !startOK) {\r\n            // edge case: no sound hardware, or 32-channel flash ceiling hit.\r\n            // applies only to Flash 9, non-NetStream/MovieStar sounds.\r\n            // http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/media/Sound.html#play%28%29\r\n            sm2._wD(fN + 'No sound hardware, or 32-sound ceiling hit', 2);\r\n            if (s._iO.onplayerror) {\r\n              s._iO.onplayerror.apply(s);\r\n            }\r\n\r\n          }\r\n\r\n        } else if (s.instanceCount < 2) {\r\n\r\n            // HTML5 single-instance case\r\n\r\n            start_html5_timer();\r\n\r\n            a = s._setup_html5();\r\n\r\n            s.setPosition(s._iO.position);\r\n\r\n            a.play();\r\n\r\n          } else {\r\n\r\n            // HTML5 multi-shot case\r\n\r\n            sm2._wD(s.id + ': Cloning Audio() for instance #' + s.instanceCount + '...');\r\n\r\n            audioClone = new Audio(s._iO.url);\r\n\r\n            onended = function() {\r\n              event.remove(audioClone, 'ended', onended);\r\n              s._onfinish(s);\r\n              // cleanup\r\n              html5Unload(audioClone);\r\n              audioClone = null;\r\n            };\r\n\r\n            oncanplay = function() {\r\n              event.remove(audioClone, 'canplay', oncanplay);\r\n              try {\r\n                audioClone.currentTime = s._iO.position / msecScale;\r\n              } catch(err) {\r\n                complain(s.id + ': multiShot play() failed to apply position of ' + (s._iO.position / msecScale));\r\n              }\r\n              audioClone.play();\r\n            };\r\n\r\n            event.add(audioClone, 'ended', onended);\r\n\r\n            // apply volume to clones, too\r\n            if (s._iO.volume !== _undefined) {\r\n              audioClone.volume = Math.max(0, Math.min(1, s._iO.volume / 100));\r\n            }\r\n\r\n            // playing multiple muted sounds? if you do this, you're weird ;) - but let's cover it.\r\n            if (s.muted) {\r\n              audioClone.muted = true;\r\n            }\r\n\r\n            if (s._iO.position) {\r\n              // HTML5 audio can't seek before onplay() event has fired.\r\n              // wait for canplay, then seek to position and start playback.\r\n              event.add(audioClone, 'canplay', oncanplay);\r\n            } else {\r\n              // begin playback at currentTime: 0\r\n              audioClone.play();\r\n            }\r\n\r\n          }\r\n\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    // just for convenience\r\n    this.start = this.play;\r\n\r\n    /**\r\n     * Stops playing a sound (and optionally, all sounds)\r\n     *\r\n     * @param {boolean} bAll Optional: Whether to stop all sounds\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.stop = function(bAll) {\r\n\r\n      var instanceOptions = s._iO,\r\n          originalPosition;\r\n\r\n      if (s.playState === 1) {\r\n\r\n        sm2._wD(s.id + ': stop()');\r\n\r\n        s._onbufferchange(0);\r\n        s._resetOnPosition(0);\r\n        s.paused = false;\r\n\r\n        if (!s.isHTML5) {\r\n          s.playState = 0;\r\n        }\r\n\r\n        // remove onPosition listeners, if any\r\n        detachOnPosition();\r\n\r\n        // and \"to\" position, if set\r\n        if (instanceOptions.to) {\r\n          s.clearOnPosition(instanceOptions.to);\r\n        }\r\n\r\n        if (!s.isHTML5) {\r\n\r\n          flash._stop(s.id, bAll);\r\n\r\n          // hack for netStream: just unload\r\n          if (instanceOptions.serverURL) {\r\n            s.unload();\r\n          }\r\n\r\n        } else if (s._a) {\r\n\r\n            originalPosition = s.position;\r\n\r\n            // act like Flash, though\r\n            s.setPosition(0);\r\n\r\n            // hack: reflect old position for onstop() (also like Flash)\r\n            s.position = originalPosition;\r\n\r\n            // html5 has no stop()\r\n            // NOTE: pausing means iOS requires interaction to resume.\r\n            s._a.pause();\r\n\r\n            s.playState = 0;\r\n\r\n            // and update UI\r\n            s._onTimer();\r\n\r\n            stop_html5_timer();\r\n\r\n          }\r\n\r\n        s.instanceCount = 0;\r\n        s._iO = {};\r\n\r\n        if (instanceOptions.onstop) {\r\n          instanceOptions.onstop.apply(s);\r\n        }\r\n\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Undocumented/internal: Sets autoPlay for RTMP.\r\n     *\r\n     * @param {boolean} autoPlay state\r\n     */\r\n\r\n    this.setAutoPlay = function(autoPlay) {\r\n\r\n      sm2._wD(s.id + ': Autoplay turned ' + (autoPlay ? 'on' : 'off'));\r\n      s._iO.autoPlay = autoPlay;\r\n\r\n      if (!s.isHTML5) {\r\n        flash._setAutoPlay(s.id, autoPlay);\r\n        if (autoPlay) {\r\n          // only increment the instanceCount if the sound isn't loaded (TODO: verify RTMP)\r\n          if (!s.instanceCount && s.readyState === 1) {\r\n            s.instanceCount++;\r\n            sm2._wD(s.id + ': Incremented instance count to ' + s.instanceCount);\r\n          }\r\n        }\r\n      }\r\n\r\n    };\r\n\r\n    /**\r\n     * Undocumented/internal: Returns the autoPlay boolean.\r\n     *\r\n     * @return {boolean} The current autoPlay value\r\n     */\r\n\r\n    this.getAutoPlay = function() {\r\n\r\n      return s._iO.autoPlay;\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets the playback rate of a sound (HTML5-only.)\r\n     *\r\n     * @param {number} playbackRate (+/-)\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.setPlaybackRate = function(playbackRate) {\r\n\r\n      // Per Mozilla, limit acceptable values to prevent playback from stopping (unless allowOverride is truthy.)\r\n      // https://developer.mozilla.org/en-US/Apps/Build/Audio_and_video_delivery/WebAudio_playbackRate_explained\r\n      var normalizedRate = Math.max(0.5, Math.min(4, playbackRate));\r\n\r\n      // <d>\r\n      if (normalizedRate !== playbackRate) {\r\n        sm2._wD(s.id + ': setPlaybackRate(' + playbackRate + '): limiting rate to ' + normalizedRate, 2);\r\n      }\r\n      // </d>\r\n\r\n      if (s.isHTML5) {\r\n        try {\r\n          s._iO.playbackRate = normalizedRate;\r\n          s._a.playbackRate = normalizedRate;\r\n        } catch(e) {\r\n          sm2._wD(s.id + ': setPlaybackRate(' + normalizedRate + ') failed: ' + e.message, 2);\r\n        }\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets the position of a sound.\r\n     *\r\n     * @param {number} nMsecOffset Position (milliseconds)\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.setPosition = function(nMsecOffset) {\r\n\r\n      if (nMsecOffset === _undefined) {\r\n        nMsecOffset = 0;\r\n      }\r\n\r\n      var position, position1K,\r\n          // Use the duration from the instance options, if we don't have a track duration yet.\r\n          // position >= 0 and <= current available (loaded) duration\r\n          offset = (s.isHTML5 ? Math.max(nMsecOffset, 0) : Math.min(s.duration || s._iO.duration, Math.max(nMsecOffset, 0)));\r\n\r\n      s.position = offset;\r\n      position1K = s.position / msecScale;\r\n      s._resetOnPosition(s.position);\r\n      s._iO.position = offset;\r\n\r\n      if (!s.isHTML5) {\r\n\r\n        position = (fV === 9 ? s.position : position1K);\r\n\r\n        if (s.readyState && s.readyState !== 2) {\r\n          // if paused or not playing, will not resume (by playing)\r\n          flash._setPosition(s.id, position, (s.paused || !s.playState), s._iO.multiShot);\r\n        }\r\n\r\n      } else if (s._a) {\r\n\r\n        // Set the position in the canplay handler if the sound is not ready yet\r\n        if (s._html5_canplay) {\r\n\r\n          if (s._a.currentTime.toFixed(3) !== position1K.toFixed(3)) {\r\n\r\n            /**\r\n             * DOM/JS errors/exceptions to watch out for:\r\n             * if seek is beyond (loaded?) position, \"DOM exception 11\"\r\n             * \"INDEX_SIZE_ERR\": DOM exception 1\r\n             */\r\n            sm2._wD(s.id + ': setPosition(' + position1K + ')');\r\n\r\n            try {\r\n              s._a.currentTime = position1K;\r\n              if (s.playState === 0 || s.paused) {\r\n                // allow seek without auto-play/resume\r\n                s._a.pause();\r\n              }\r\n            } catch(e) {\r\n              sm2._wD(s.id + ': setPosition(' + position1K + ') failed: ' + e.message, 2);\r\n            }\r\n\r\n          }\r\n\r\n        } else if (position1K) {\r\n\r\n          // warn on non-zero seek attempts\r\n          sm2._wD(s.id + ': setPosition(' + position1K + '): Cannot seek yet, sound not ready', 2);\r\n          return s;\r\n\r\n        }\r\n\r\n        if (s.paused) {\r\n\r\n          // if paused, refresh UI right away by forcing update\r\n          s._onTimer(true);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Pauses sound playback.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.pause = function(_bCallFlash) {\r\n\r\n      if (s.paused || (s.playState === 0 && s.readyState !== 1)) return s;\r\n\r\n      sm2._wD(s.id + ': pause()');\r\n      s.paused = true;\r\n\r\n      if (!s.isHTML5) {\r\n        if (_bCallFlash || _bCallFlash === _undefined) {\r\n          flash._pause(s.id, s._iO.multiShot);\r\n        }\r\n      } else {\r\n        s._setup_html5().pause();\r\n        stop_html5_timer();\r\n      }\r\n\r\n      if (s._iO.onpause) {\r\n        s._iO.onpause.apply(s);\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Resumes sound playback.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    /**\r\n     * When auto-loaded streams pause on buffer full they have a playState of 0.\r\n     * We need to make sure that the playState is set to 1 when these streams \"resume\".\r\n     * When a paused stream is resumed, we need to trigger the onplay() callback if it\r\n     * hasn't been called already. In this case since the sound is being played for the\r\n     * first time, I think it's more appropriate to call onplay() rather than onresume().\r\n     */\r\n\r\n    this.resume = function() {\r\n\r\n      var instanceOptions = s._iO;\r\n\r\n      if (!s.paused) return s;\r\n\r\n      sm2._wD(s.id + ': resume()');\r\n      s.paused = false;\r\n      s.playState = 1;\r\n\r\n      if (!s.isHTML5) {\r\n\r\n        if (instanceOptions.isMovieStar && !instanceOptions.serverURL) {\r\n          // Bizarre Webkit bug (Chrome reported via 8tracks.com dudes): AAC content paused for 30+ seconds(?) will not resume without a reposition.\r\n          s.setPosition(s.position);\r\n        }\r\n\r\n        // flash method is toggle-based (pause/resume)\r\n        flash._pause(s.id, instanceOptions.multiShot);\r\n\r\n      } else {\r\n\r\n        s._setup_html5().play();\r\n        start_html5_timer();\r\n\r\n      }\r\n\r\n      if (!onplay_called && instanceOptions.onplay) {\r\n\r\n        instanceOptions.onplay.apply(s);\r\n        onplay_called = true;\r\n\r\n      } else if (instanceOptions.onresume) {\r\n\r\n        instanceOptions.onresume.apply(s);\r\n\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Toggles sound playback.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.togglePause = function() {\r\n\r\n      sm2._wD(s.id + ': togglePause()');\r\n\r\n      if (s.playState === 0) {\r\n        s.play({\r\n          position: (fV === 9 && !s.isHTML5 ? s.position : s.position / msecScale)\r\n        });\r\n        return s;\r\n      }\r\n\r\n      if (s.paused) {\r\n        s.resume();\r\n      } else {\r\n        s.pause();\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets the panning (L-R) effect.\r\n     *\r\n     * @param {number} nPan The pan value (-100 to 100)\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.setPan = function(nPan, bInstanceOnly) {\r\n\r\n      if (nPan === _undefined) {\r\n        nPan = 0;\r\n      }\r\n\r\n      if (bInstanceOnly === _undefined) {\r\n        bInstanceOnly = false;\r\n      }\r\n\r\n      if (!s.isHTML5) {\r\n        flash._setPan(s.id, nPan);\r\n      } // else { no HTML5 pan? }\r\n\r\n      s._iO.pan = nPan;\r\n\r\n      if (!bInstanceOnly) {\r\n        s.pan = nPan;\r\n        s.options.pan = nPan;\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets the volume.\r\n     *\r\n     * @param {number} nVol The volume value (0 to 100)\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.setVolume = function(nVol, _bInstanceOnly) {\r\n\r\n      /**\r\n       * Note: Setting volume has no effect on iOS \"special snowflake\" devices.\r\n       * Hardware volume control overrides software, and volume\r\n       * will always return 1 per Apple docs. (iOS 4 + 5.)\r\n       * http://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/AddingSoundtoCanvasAnimations/AddingSoundtoCanvasAnimations.html\r\n       */\r\n\r\n      if (nVol === _undefined) {\r\n        nVol = 100;\r\n      }\r\n\r\n      if (_bInstanceOnly === _undefined) {\r\n        _bInstanceOnly = false;\r\n      }\r\n\r\n      if (!s.isHTML5) {\r\n\r\n        flash._setVolume(s.id, (sm2.muted && !s.muted) || s.muted ? 0 : nVol);\r\n\r\n      } else if (s._a) {\r\n\r\n        if (sm2.muted && !s.muted) {\r\n          s.muted = true;\r\n          s._a.muted = true;\r\n        }\r\n\r\n        // valid range for native HTML5 Audio(): 0-1\r\n        s._a.volume = Math.max(0, Math.min(1, nVol / 100));\r\n\r\n      }\r\n\r\n      s._iO.volume = nVol;\r\n\r\n      if (!_bInstanceOnly) {\r\n        s.volume = nVol;\r\n        s.options.volume = nVol;\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Mutes the sound.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.mute = function() {\r\n\r\n      s.muted = true;\r\n\r\n      if (!s.isHTML5) {\r\n        flash._setVolume(s.id, 0);\r\n      } else if (s._a) {\r\n        s._a.muted = true;\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Unmutes the sound.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.unmute = function() {\r\n\r\n      s.muted = false;\r\n      var hasIO = (s._iO.volume !== _undefined);\r\n\r\n      if (!s.isHTML5) {\r\n        flash._setVolume(s.id, hasIO ? s._iO.volume : s.options.volume);\r\n      } else if (s._a) {\r\n        s._a.muted = false;\r\n      }\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    /**\r\n     * Toggles the muted state of a sound.\r\n     *\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.toggleMute = function() {\r\n\r\n      return (s.muted ? s.unmute() : s.mute());\r\n\r\n    };\r\n\r\n    /**\r\n     * Registers a callback to be fired when a sound reaches a given position during playback.\r\n     *\r\n     * @param {number} nPosition The position to watch for\r\n     * @param {function} oMethod The relevant callback to fire\r\n     * @param {object} oScope Optional: The scope to apply the callback to\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.onPosition = function(nPosition, oMethod, oScope) {\r\n\r\n      // TODO: basic dupe checking?\r\n\r\n      onPositionItems.push({\r\n        position: parseInt(nPosition, 10),\r\n        method: oMethod,\r\n        scope: (oScope !== _undefined ? oScope : s),\r\n        fired: false\r\n      });\r\n\r\n      return s;\r\n\r\n    };\r\n\r\n    // legacy/backwards-compability: lower-case method name\r\n    this.onposition = this.onPosition;\r\n\r\n    /**\r\n     * Removes registered callback(s) from a sound, by position and/or callback.\r\n     *\r\n     * @param {number} nPosition The position to clear callback(s) for\r\n     * @param {function} oMethod Optional: Identify one callback to be removed when multiple listeners exist for one position\r\n     * @return {SMSound} The SMSound object\r\n     */\r\n\r\n    this.clearOnPosition = function(nPosition, oMethod) {\r\n\r\n      var i;\r\n\r\n      nPosition = parseInt(nPosition, 10);\r\n\r\n      if (isNaN(nPosition)) {\r\n        // safety check\r\n        return;\r\n      }\r\n\r\n      for (i = 0; i < onPositionItems.length; i++) {\r\n\r\n        if (nPosition === onPositionItems[i].position) {\r\n          // remove this item if no method was specified, or, if the method matches\r\n\r\n          if (!oMethod || (oMethod === onPositionItems[i].method)) {\r\n\r\n            if (onPositionItems[i].fired) {\r\n              // decrement \"fired\" counter, too\r\n              onPositionFired--;\r\n            }\r\n\r\n            onPositionItems.splice(i, 1);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    };\r\n\r\n    this._processOnPosition = function() {\r\n\r\n      var i, item, j = onPositionItems.length;\r\n\r\n      if (!j || !s.playState || onPositionFired >= j) return false;\r\n\r\n      for (i = j - 1; i >= 0; i--) {\r\n\r\n        item = onPositionItems[i];\r\n\r\n        if (!item.fired && s.position >= item.position) {\r\n\r\n          item.fired = true;\r\n          onPositionFired++;\r\n          item.method.apply(item.scope, [item.position]);\r\n\r\n          //  reset j -- onPositionItems.length can be changed in the item callback above... occasionally breaking the loop.\r\n          j = onPositionItems.length;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    this._resetOnPosition = function(nPosition) {\r\n\r\n      // reset \"fired\" for items interested in this position\r\n      var i, item, j = onPositionItems.length;\r\n\r\n      if (!j) return false;\r\n\r\n      for (i = j - 1; i >= 0; i--) {\r\n\r\n        item = onPositionItems[i];\r\n\r\n        if (item.fired && nPosition <= item.position) {\r\n          item.fired = false;\r\n          onPositionFired--;\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    /**\r\n     * SMSound() private internals\r\n     * --------------------------------\r\n     */\r\n\r\n    applyFromTo = function() {\r\n\r\n      var instanceOptions = s._iO,\r\n          f = instanceOptions.from,\r\n          t = instanceOptions.to,\r\n          start, end;\r\n\r\n      end = function() {\r\n\r\n        // end has been reached.\r\n        sm2._wD(s.id + ': \"To\" time of ' + t + ' reached.');\r\n\r\n        // detach listener\r\n        s.clearOnPosition(t, end);\r\n\r\n        // stop should clear this, too\r\n        s.stop();\r\n\r\n      };\r\n\r\n      start = function() {\r\n\r\n        sm2._wD(s.id + ': Playing \"from\" ' + f);\r\n\r\n        // add listener for end\r\n        if (t !== null && !isNaN(t)) {\r\n          s.onPosition(t, end);\r\n        }\r\n\r\n      };\r\n\r\n      if (f !== null && !isNaN(f)) {\r\n\r\n        // apply to instance options, guaranteeing correct start position.\r\n        instanceOptions.position = f;\r\n\r\n        // multiShot timing can't be tracked, so prevent that.\r\n        instanceOptions.multiShot = false;\r\n\r\n        start();\r\n\r\n      }\r\n\r\n      // return updated instanceOptions including starting position\r\n      return instanceOptions;\r\n\r\n    };\r\n\r\n    attachOnPosition = function() {\r\n\r\n      var item,\r\n          op = s._iO.onposition;\r\n\r\n      // attach onposition things, if any, now.\r\n\r\n      if (op) {\r\n\r\n        for (item in op) {\r\n          if (op.hasOwnProperty(item)) {\r\n            s.onPosition(parseInt(item, 10), op[item]);\r\n          }\r\n        }\r\n\r\n      }\r\n\r\n    };\r\n\r\n    detachOnPosition = function() {\r\n\r\n      var item,\r\n          op = s._iO.onposition;\r\n\r\n      // detach any onposition()-style listeners.\r\n\r\n      if (op) {\r\n\r\n        for (item in op) {\r\n          if (op.hasOwnProperty(item)) {\r\n            s.clearOnPosition(parseInt(item, 10));\r\n          }\r\n        }\r\n\r\n      }\r\n\r\n    };\r\n\r\n    start_html5_timer = function() {\r\n\r\n      if (s.isHTML5) {\r\n        startTimer(s);\r\n      }\r\n\r\n    };\r\n\r\n    stop_html5_timer = function() {\r\n\r\n      if (s.isHTML5) {\r\n        stopTimer(s);\r\n      }\r\n\r\n    };\r\n\r\n    resetProperties = function(retainPosition) {\r\n\r\n      if (!retainPosition) {\r\n        onPositionItems = [];\r\n        onPositionFired = 0;\r\n      }\r\n\r\n      onplay_called = false;\r\n\r\n      s._hasTimer = null;\r\n      s._a = null;\r\n      s._html5_canplay = false;\r\n      s.bytesLoaded = null;\r\n      s.bytesTotal = null;\r\n      s.duration = (s._iO && s._iO.duration ? s._iO.duration : null);\r\n      s.durationEstimate = null;\r\n      s.buffered = [];\r\n\r\n      // legacy: 1D array\r\n      s.eqData = [];\r\n\r\n      s.eqData.left = [];\r\n      s.eqData.right = [];\r\n\r\n      s.failures = 0;\r\n      s.isBuffering = false;\r\n      s.instanceOptions = {};\r\n      s.instanceCount = 0;\r\n      s.loaded = false;\r\n      s.metadata = {};\r\n\r\n      // 0 = uninitialised, 1 = loading, 2 = failed/error, 3 = loaded/success\r\n      s.readyState = 0;\r\n\r\n      s.muted = false;\r\n      s.paused = false;\r\n\r\n      s.peakData = {\r\n        left: 0,\r\n        right: 0\r\n      };\r\n\r\n      s.waveformData = {\r\n        left: [],\r\n        right: []\r\n      };\r\n\r\n      s.playState = 0;\r\n      s.position = null;\r\n\r\n      s.id3 = {};\r\n\r\n    };\r\n\r\n    resetProperties();\r\n\r\n    /**\r\n     * Pseudo-private SMSound internals\r\n     * --------------------------------\r\n     */\r\n\r\n    this._onTimer = function(bForce) {\r\n\r\n      /**\r\n       * HTML5-only _whileplaying() etc.\r\n       * called from both HTML5 native events, and polling/interval-based timers\r\n       * mimics flash and fires only when time/duration change, so as to be polling-friendly\r\n       */\r\n\r\n      var duration, isNew = false, time, x = {};\r\n\r\n      if (s._hasTimer || bForce) {\r\n\r\n        // TODO: May not need to track readyState (1 = loading)\r\n\r\n        if (s._a && (bForce || ((s.playState > 0 || s.readyState === 1) && !s.paused))) {\r\n\r\n          duration = s._get_html5_duration();\r\n\r\n          if (duration !== lastHTML5State.duration) {\r\n\r\n            lastHTML5State.duration = duration;\r\n            s.duration = duration;\r\n            isNew = true;\r\n\r\n          }\r\n\r\n          // TODO: investigate why this goes wack if not set/re-set each time.\r\n          s.durationEstimate = s.duration;\r\n\r\n          time = (s._a.currentTime * msecScale || 0);\r\n\r\n          if (time !== lastHTML5State.time) {\r\n\r\n            lastHTML5State.time = time;\r\n            isNew = true;\r\n\r\n          }\r\n\r\n          if (isNew || bForce) {\r\n\r\n            s._whileplaying(time, x, x, x, x);\r\n\r\n          }\r\n\r\n        }/* else {\r\n\r\n          // sm2._wD('_onTimer: Warn for \"'+s.id+'\": '+(!s._a?'Could not find element. ':'')+(s.playState === 0?'playState bad, 0?':'playState = '+s.playState+', OK'));\r\n\r\n          return false;\r\n\r\n        }*/\r\n\r\n      }\r\n\r\n      return isNew;\r\n\r\n    };\r\n\r\n    this._get_html5_duration = function() {\r\n\r\n      var instanceOptions = s._iO,\r\n          // if audio object exists, use its duration - else, instance option duration (if provided - it's a hack, really, and should be retired) OR null\r\n          d = (s._a && s._a.duration ? s._a.duration * msecScale : (instanceOptions && instanceOptions.duration ? instanceOptions.duration : null)),\r\n          result = (d && !isNaN(d) && d !== Infinity ? d : null);\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n    this._apply_loop = function(a, nLoops) {\r\n\r\n      /**\r\n       * boolean instead of \"loop\", for webkit? - spec says string. http://www.w3.org/TR/html-markup/audio.html#audio.attrs.loop\r\n       * note that loop is either off or infinite under HTML5, unlike Flash which allows arbitrary loop counts to be specified.\r\n       */\r\n\r\n      // <d>\r\n      if (!a.loop && nLoops > 1) {\r\n        sm2._wD('Note: Native HTML5 looping is infinite.', 1);\r\n      }\r\n      // </d>\r\n\r\n      a.loop = (nLoops > 1 ? 'loop' : '');\r\n\r\n    };\r\n\r\n    this._setup_html5 = function(options) {\r\n\r\n      var instanceOptions = mixin(s._iO, options),\r\n          a = useGlobalHTML5Audio ? globalHTML5Audio : s._a,\r\n          dURL = decodeURI(instanceOptions.url),\r\n          sameURL;\r\n\r\n      /**\r\n       * \"First things first, I, Poppa...\" (reset the previous state of the old sound, if playing)\r\n       * Fixes case with devices that can only play one sound at a time\r\n       * Otherwise, other sounds in mid-play will be terminated without warning and in a stuck state\r\n       */\r\n\r\n      if (useGlobalHTML5Audio) {\r\n\r\n        if (dURL === decodeURI(lastGlobalHTML5URL)) {\r\n          // global HTML5 audio: re-use of URL\r\n          sameURL = true;\r\n        }\r\n\r\n      } else if (dURL === decodeURI(lastURL)) {\r\n\r\n        // options URL is the same as the \"last\" URL, and we used (loaded) it\r\n        sameURL = true;\r\n\r\n      }\r\n\r\n      if (a) {\r\n\r\n        if (a._s) {\r\n\r\n          if (useGlobalHTML5Audio) {\r\n\r\n            if (a._s && a._s.playState && !sameURL) {\r\n\r\n              // global HTML5 audio case, and loading a new URL. stop the currently-playing one.\r\n              a._s.stop();\r\n\r\n            }\r\n\r\n          } else if (!useGlobalHTML5Audio && dURL === decodeURI(lastURL)) {\r\n\r\n            // non-global HTML5 reuse case: same url, ignore request\r\n            s._apply_loop(a, instanceOptions.loops);\r\n\r\n            return a;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (!sameURL) {\r\n\r\n          // don't retain onPosition() stuff with new URLs.\r\n\r\n          if (lastURL) {\r\n            resetProperties(false);\r\n          }\r\n\r\n          // assign new HTML5 URL\r\n\r\n          a.src = instanceOptions.url;\r\n\r\n          s.url = instanceOptions.url;\r\n\r\n          lastURL = instanceOptions.url;\r\n\r\n          lastGlobalHTML5URL = instanceOptions.url;\r\n\r\n          a._called_load = false;\r\n\r\n        }\r\n\r\n      } else {\r\n\r\n        if (instanceOptions.autoLoad || instanceOptions.autoPlay) {\r\n\r\n          s._a = new Audio(instanceOptions.url);\r\n          s._a.load();\r\n\r\n        } else {\r\n\r\n          // null for stupid Opera 9.64 case\r\n          s._a = (isOpera && opera.version() < 10 ? new Audio(null) : new Audio());\r\n\r\n        }\r\n\r\n        // assign local reference\r\n        a = s._a;\r\n\r\n        a._called_load = false;\r\n\r\n        if (useGlobalHTML5Audio) {\r\n\r\n          globalHTML5Audio = a;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      s.isHTML5 = true;\r\n\r\n      // store a ref on the track\r\n      s._a = a;\r\n\r\n      // store a ref on the audio\r\n      a._s = s;\r\n\r\n      add_html5_events();\r\n\r\n      s._apply_loop(a, instanceOptions.loops);\r\n\r\n      if (instanceOptions.autoLoad || instanceOptions.autoPlay) {\r\n\r\n        s.load();\r\n\r\n      } else {\r\n\r\n        // early HTML5 implementation (non-standard)\r\n        a.autobuffer = false;\r\n\r\n        // standard ('none' is also an option.)\r\n        a.preload = 'auto';\r\n\r\n      }\r\n\r\n      return a;\r\n\r\n    };\r\n\r\n    add_html5_events = function() {\r\n\r\n      if (s._a._added_events) return false;\r\n\r\n      var f;\r\n\r\n      function add(oEvt, oFn, bCapture) {\r\n        return s._a ? s._a.addEventListener(oEvt, oFn, bCapture || false) : null;\r\n      }\r\n\r\n      s._a._added_events = true;\r\n\r\n      for (f in html5_events) {\r\n        if (html5_events.hasOwnProperty(f)) {\r\n          add(f, html5_events[f]);\r\n        }\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    remove_html5_events = function() {\r\n\r\n      // Remove event listeners\r\n\r\n      var f;\r\n\r\n      function remove(oEvt, oFn, bCapture) {\r\n        return (s._a ? s._a.removeEventListener(oEvt, oFn, bCapture || false) : null);\r\n      }\r\n\r\n      sm2._wD(s.id + ': Removing event listeners');\r\n      s._a._added_events = false;\r\n\r\n      for (f in html5_events) {\r\n        if (html5_events.hasOwnProperty(f)) {\r\n          remove(f, html5_events[f]);\r\n        }\r\n      }\r\n\r\n    };\r\n\r\n    /**\r\n     * Pseudo-private event internals\r\n     * ------------------------------\r\n     */\r\n\r\n    this._onload = function(nSuccess) {\r\n\r\n      var fN,\r\n          // check for duration to prevent false positives from flash 8 when loading from cache.\r\n          loadOK = !!nSuccess || (!s.isHTML5 && fV === 8 && s.duration);\r\n\r\n      // <d>\r\n      fN = s.id + ': ';\r\n      sm2._wD(fN + (loadOK ? 'onload()' : 'Failed to load / invalid sound?' + (!s.duration ? ' Zero-length duration reported.' : ' -') + ' (' + s.url + ')'), (loadOK ? 1 : 2));\r\n\r\n      if (!loadOK && !s.isHTML5) {\r\n        if (sm2.sandbox.noRemote === true) {\r\n          sm2._wD(fN + str('noNet'), 1);\r\n        }\r\n        if (sm2.sandbox.noLocal === true) {\r\n          sm2._wD(fN + str('noLocal'), 1);\r\n        }\r\n      }\r\n      // </d>\r\n\r\n      s.loaded = loadOK;\r\n      s.readyState = (loadOK ? 3 : 2);\r\n      s._onbufferchange(0);\r\n\r\n      if (!loadOK && !s.isHTML5) {\r\n        // note: no error code from Flash.\r\n        s._onerror();\r\n      }\r\n\r\n      if (s._iO.onload) {\r\n        wrapCallback(s, function() {\r\n          s._iO.onload.apply(s, [loadOK]);\r\n        });\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    this._onerror = function(errorCode, description) {\r\n\r\n      // https://html.spec.whatwg.org/multipage/embedded-content.html#error-codes\r\n      if (s._iO.onerror) {\r\n        wrapCallback(s, function() {\r\n          s._iO.onerror.apply(s, [errorCode, description]);\r\n        });\r\n      }\r\n\r\n    };\r\n\r\n    this._onbufferchange = function(nIsBuffering) {\r\n\r\n      // ignore if not playing\r\n      if (s.playState === 0) return false;\r\n\r\n      if ((nIsBuffering && s.isBuffering) || (!nIsBuffering && !s.isBuffering)) return false;\r\n\r\n      s.isBuffering = (nIsBuffering === 1);\r\n\r\n      if (s._iO.onbufferchange) {\r\n        sm2._wD(s.id + ': Buffer state change: ' + nIsBuffering);\r\n        s._iO.onbufferchange.apply(s, [nIsBuffering]);\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    /**\r\n     * Playback may have stopped due to buffering, or related reason.\r\n     * This state can be encountered on iOS < 6 when auto-play is blocked.\r\n     */\r\n\r\n    this._onsuspend = function() {\r\n\r\n      if (s._iO.onsuspend) {\r\n        sm2._wD(s.id + ': Playback suspended');\r\n        s._iO.onsuspend.apply(s);\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    /**\r\n     * flash 9/movieStar + RTMP-only method, should fire only once at most\r\n     * at this point we just recreate failed sounds rather than trying to reconnect\r\n     */\r\n\r\n    this._onfailure = function(msg, level, code) {\r\n\r\n      s.failures++;\r\n      sm2._wD(s.id + ': Failure (' + s.failures + '): ' + msg);\r\n\r\n      if (s._iO.onfailure && s.failures === 1) {\r\n        s._iO.onfailure(msg, level, code);\r\n      } else {\r\n        sm2._wD(s.id + ': Ignoring failure');\r\n      }\r\n\r\n    };\r\n\r\n    /**\r\n     * flash 9/movieStar + RTMP-only method for unhandled warnings/exceptions from Flash\r\n     * e.g., RTMP \"method missing\" warning (non-fatal) for getStreamLength on server\r\n     */\r\n\r\n    this._onwarning = function(msg, level, code) {\r\n\r\n      if (s._iO.onwarning) {\r\n        s._iO.onwarning(msg, level, code);\r\n      }\r\n\r\n    };\r\n\r\n    this._onfinish = function() {\r\n\r\n      // store local copy before it gets trashed...\r\n      var io_onfinish = s._iO.onfinish;\r\n\r\n      s._onbufferchange(0);\r\n      s._resetOnPosition(0);\r\n\r\n      // reset some state items\r\n      if (s.instanceCount) {\r\n\r\n        s.instanceCount--;\r\n\r\n        if (!s.instanceCount) {\r\n\r\n          // remove onPosition listeners, if any\r\n          detachOnPosition();\r\n\r\n          // reset instance options\r\n          s.playState = 0;\r\n          s.paused = false;\r\n          s.instanceCount = 0;\r\n          s.instanceOptions = {};\r\n          s._iO = {};\r\n          stop_html5_timer();\r\n\r\n          // reset position, too\r\n          if (s.isHTML5) {\r\n            s.position = 0;\r\n          }\r\n\r\n        }\r\n\r\n        if (!s.instanceCount || s._iO.multiShotEvents) {\r\n          // fire onfinish for last, or every instance\r\n          if (io_onfinish) {\r\n            sm2._wD(s.id + ': onfinish()');\r\n            wrapCallback(s, function() {\r\n              io_onfinish.apply(s);\r\n            });\r\n          }\r\n        }\r\n\r\n      }\r\n\r\n    };\r\n\r\n    this._whileloading = function(nBytesLoaded, nBytesTotal, nDuration, nBufferLength) {\r\n\r\n      var instanceOptions = s._iO;\r\n\r\n      s.bytesLoaded = nBytesLoaded;\r\n      s.bytesTotal = nBytesTotal;\r\n      s.duration = Math.floor(nDuration);\r\n      s.bufferLength = nBufferLength;\r\n\r\n      if (!s.isHTML5 && !instanceOptions.isMovieStar) {\r\n\r\n        if (instanceOptions.duration) {\r\n          // use duration from options, if specified and larger. nobody should be specifying duration in options, actually, and it should be retired.\r\n          s.durationEstimate = (s.duration > instanceOptions.duration) ? s.duration : instanceOptions.duration;\r\n        } else {\r\n          s.durationEstimate = parseInt((s.bytesTotal / s.bytesLoaded) * s.duration, 10);\r\n        }\r\n\r\n      } else {\r\n\r\n        s.durationEstimate = s.duration;\r\n\r\n      }\r\n\r\n      // for flash, reflect sequential-load-style buffering\r\n      if (!s.isHTML5) {\r\n        s.buffered = [{\r\n          start: 0,\r\n          end: s.duration\r\n        }];\r\n      }\r\n\r\n      // allow whileloading to fire even if \"load\" fired under HTML5, due to HTTP range/partials\r\n      if ((s.readyState !== 3 || s.isHTML5) && instanceOptions.whileloading) {\r\n        instanceOptions.whileloading.apply(s);\r\n      }\r\n\r\n    };\r\n\r\n    this._whileplaying = function(nPosition, oPeakData, oWaveformDataLeft, oWaveformDataRight, oEQData) {\r\n\r\n      var instanceOptions = s._iO,\r\n          eqLeft;\r\n\r\n      // flash safety net\r\n      if (isNaN(nPosition) || nPosition === null) return false;\r\n\r\n      // Safari HTML5 play() may return small -ve values when starting from position: 0, eg. -50.120396875. Unexpected/invalid per W3, I think. Normalize to 0.\r\n      s.position = Math.max(0, nPosition);\r\n\r\n      s._processOnPosition();\r\n\r\n      if (!s.isHTML5 && fV > 8) {\r\n\r\n        if (instanceOptions.usePeakData && oPeakData !== _undefined && oPeakData) {\r\n          s.peakData = {\r\n            left: oPeakData.leftPeak,\r\n            right: oPeakData.rightPeak\r\n          };\r\n        }\r\n\r\n        if (instanceOptions.useWaveformData && oWaveformDataLeft !== _undefined && oWaveformDataLeft) {\r\n          s.waveformData = {\r\n            left: oWaveformDataLeft.split(','),\r\n            right: oWaveformDataRight.split(',')\r\n          };\r\n        }\r\n\r\n        if (instanceOptions.useEQData) {\r\n          if (oEQData !== _undefined && oEQData && oEQData.leftEQ) {\r\n            eqLeft = oEQData.leftEQ.split(',');\r\n            s.eqData = eqLeft;\r\n            s.eqData.left = eqLeft;\r\n            if (oEQData.rightEQ !== _undefined && oEQData.rightEQ) {\r\n              s.eqData.right = oEQData.rightEQ.split(',');\r\n            }\r\n          }\r\n        }\r\n\r\n      }\r\n\r\n      if (s.playState === 1) {\r\n\r\n        // special case/hack: ensure buffering is false if loading from cache (and not yet started)\r\n        if (!s.isHTML5 && fV === 8 && !s.position && s.isBuffering) {\r\n          s._onbufferchange(0);\r\n        }\r\n\r\n        if (instanceOptions.whileplaying) {\r\n          // flash may call after actual finish\r\n          instanceOptions.whileplaying.apply(s);\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    this._oncaptiondata = function(oData) {\r\n\r\n      /**\r\n       * internal: flash 9 + NetStream (MovieStar/RTMP-only) feature\r\n       *\r\n       * @param {object} oData\r\n       */\r\n\r\n      sm2._wD(s.id + ': Caption data received.');\r\n\r\n      s.captiondata = oData;\r\n\r\n      if (s._iO.oncaptiondata) {\r\n        s._iO.oncaptiondata.apply(s, [oData]);\r\n      }\r\n\r\n    };\r\n\r\n    this._onmetadata = function(oMDProps, oMDData) {\r\n\r\n      /**\r\n       * internal: flash 9 + NetStream (MovieStar/RTMP-only) feature\r\n       * RTMP may include song title, MovieStar content may include encoding info\r\n       *\r\n       * @param {array} oMDProps (names)\r\n       * @param {array} oMDData (values)\r\n       */\r\n\r\n      sm2._wD(s.id + ': Metadata received.');\r\n\r\n      var oData = {}, i, j;\r\n\r\n      for (i = 0, j = oMDProps.length; i < j; i++) {\r\n        oData[oMDProps[i]] = oMDData[i];\r\n      }\r\n\r\n      s.metadata = oData;\r\n\r\n      if (s._iO.onmetadata) {\r\n        s._iO.onmetadata.call(s, s.metadata);\r\n      }\r\n\r\n    };\r\n\r\n    this._onid3 = function(oID3Props, oID3Data) {\r\n\r\n      /**\r\n       * internal: flash 8 + flash 9 ID3 feature\r\n       * may include artist, song title etc.\r\n       *\r\n       * @param {array} oID3Props (names)\r\n       * @param {array} oID3Data (values)\r\n       */\r\n\r\n      sm2._wD(s.id + ': ID3 data received.');\r\n\r\n      var oData = [], i, j;\r\n\r\n      for (i = 0, j = oID3Props.length; i < j; i++) {\r\n        oData[oID3Props[i]] = oID3Data[i];\r\n      }\r\n\r\n      s.id3 = mixin(s.id3, oData);\r\n\r\n      if (s._iO.onid3) {\r\n        s._iO.onid3.apply(s);\r\n      }\r\n\r\n    };\r\n\r\n    // flash/RTMP-only\r\n\r\n    this._onconnect = function(bSuccess) {\r\n\r\n      bSuccess = (bSuccess === 1);\r\n      sm2._wD(s.id + ': ' + (bSuccess ? 'Connected.' : 'Failed to connect? - ' + s.url), (bSuccess ? 1 : 2));\r\n      s.connected = bSuccess;\r\n\r\n      if (bSuccess) {\r\n\r\n        s.failures = 0;\r\n\r\n        if (idCheck(s.id)) {\r\n          if (s.getAutoPlay()) {\r\n            // only update the play state if auto playing\r\n            s.play(_undefined, s.getAutoPlay());\r\n          } else if (s._iO.autoLoad) {\r\n            s.load();\r\n          }\r\n        }\r\n\r\n        if (s._iO.onconnect) {\r\n          s._iO.onconnect.apply(s, [bSuccess]);\r\n        }\r\n\r\n      }\r\n\r\n    };\r\n\r\n    this._ondataerror = function(sError) {\r\n\r\n      // flash 9 wave/eq data handler\r\n      // hack: called at start, and end from flash at/after onfinish()\r\n      if (s.playState > 0) {\r\n        sm2._wD(s.id + ': Data error: ' + sError);\r\n        if (s._iO.ondataerror) {\r\n          s._iO.ondataerror.apply(s);\r\n        }\r\n      }\r\n\r\n    };\r\n\r\n    // <d>\r\n    this._debug();\r\n    // </d>\r\n\r\n  }; // SMSound()\r\n\r\n  /**\r\n   * Private SoundManager internals\r\n   * ------------------------------\r\n   */\r\n\r\n  getDocument = function() {\r\n\r\n    return (doc.body || doc.getElementsByTagName('div')[0]);\r\n\r\n  };\r\n\r\n  id = function(sID) {\r\n\r\n    return doc.getElementById(sID);\r\n\r\n  };\r\n\r\n  mixin = function(oMain, oAdd) {\r\n\r\n    // non-destructive merge\r\n    var o1 = (oMain || {}), o2, o;\r\n\r\n    // if unspecified, o2 is the default options object\r\n    o2 = (oAdd === _undefined ? sm2.defaultOptions : oAdd);\r\n\r\n    for (o in o2) {\r\n\r\n      if (o2.hasOwnProperty(o) && o1[o] === _undefined) {\r\n\r\n        if (typeof o2[o] !== 'object' || o2[o] === null) {\r\n\r\n          // assign directly\r\n          o1[o] = o2[o];\r\n\r\n        } else {\r\n\r\n          // recurse through o2\r\n          o1[o] = mixin(o1[o], o2[o]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return o1;\r\n\r\n  };\r\n\r\n  wrapCallback = function(oSound, callback) {\r\n\r\n    /**\r\n     * 03/03/2013: Fix for Flash Player 11.6.602.171 + Flash 8 (flashVersion = 8) SWF issue\r\n     * setTimeout() fix for certain SMSound callbacks like onload() and onfinish(), where subsequent calls like play() and load() fail when Flash Player 11.6.602.171 is installed, and using soundManager with flashVersion = 8 (which is the default).\r\n     * Not sure of exact cause. Suspect race condition and/or invalid (NaN-style) position argument trickling down to the next JS -> Flash _start() call, in the play() case.\r\n     * Fix: setTimeout() to yield, plus safer null / NaN checking on position argument provided to Flash.\r\n     * https://getsatisfaction.com/schillmania/topics/recent_chrome_update_seems_to_have_broken_my_sm2_audio_player\r\n     */\r\n    if (!oSound.isHTML5 && fV === 8) {\r\n      window.setTimeout(callback, 0);\r\n    } else {\r\n      callback();\r\n    }\r\n\r\n  };\r\n\r\n  // additional soundManager properties that soundManager.setup() will accept\r\n\r\n  extraOptions = {\r\n    onready: 1,\r\n    ontimeout: 1,\r\n    defaultOptions: 1,\r\n    flash9Options: 1,\r\n    movieStarOptions: 1\r\n  };\r\n\r\n  assign = function(o, oParent) {\r\n\r\n    /**\r\n     * recursive assignment of properties, soundManager.setup() helper\r\n     * allows property assignment based on whitelist\r\n     */\r\n\r\n    var i,\r\n        result = true,\r\n        hasParent = (oParent !== _undefined),\r\n        setupOptions = sm2.setupOptions,\r\n        bonusOptions = extraOptions;\r\n\r\n    // <d>\r\n\r\n    // if soundManager.setup() called, show accepted parameters.\r\n\r\n    if (o === _undefined) {\r\n\r\n      result = [];\r\n\r\n      for (i in setupOptions) {\r\n\r\n        if (setupOptions.hasOwnProperty(i)) {\r\n          result.push(i);\r\n        }\r\n\r\n      }\r\n\r\n      for (i in bonusOptions) {\r\n\r\n        if (bonusOptions.hasOwnProperty(i)) {\r\n\r\n          if (typeof sm2[i] === 'object') {\r\n            result.push(i + ': {...}');\r\n          } else if (sm2[i] instanceof Function) {\r\n            result.push(i + ': function() {...}');\r\n          } else {\r\n            result.push(i);\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      sm2._wD(str('setup', result.join(', ')));\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    // </d>\r\n\r\n    for (i in o) {\r\n\r\n      if (o.hasOwnProperty(i)) {\r\n\r\n        // if not an {object} we want to recurse through...\r\n\r\n        if (typeof o[i] !== 'object' || o[i] === null || o[i] instanceof Array || o[i] instanceof RegExp) {\r\n\r\n          // check \"allowed\" options\r\n\r\n          if (hasParent && bonusOptions[oParent] !== _undefined) {\r\n\r\n            // valid recursive / nested object option, eg., { defaultOptions: { volume: 50 } }\r\n            sm2[oParent][i] = o[i];\r\n\r\n          } else if (setupOptions[i] !== _undefined) {\r\n\r\n            // special case: assign to setupOptions object, which soundManager property references\r\n            sm2.setupOptions[i] = o[i];\r\n\r\n            // assign directly to soundManager, too\r\n            sm2[i] = o[i];\r\n\r\n          } else if (bonusOptions[i] === _undefined) {\r\n\r\n            // invalid or disallowed parameter. complain.\r\n            complain(str((sm2[i] === _undefined ? 'setupUndef' : 'setupError'), i), 2);\r\n\r\n            result = false;\r\n\r\n          } else if (sm2[i] instanceof Function) {\r\n\r\n            /**\r\n             * valid extraOptions (bonusOptions) parameter.\r\n             * is it a method, like onready/ontimeout? call it.\r\n             * multiple parameters should be in an array, eg. soundManager.setup({onready: [myHandler, myScope]});\r\n             */\r\n            sm2[i].apply(sm2, (o[i] instanceof Array ? o[i] : [o[i]]));\r\n\r\n          } else {\r\n\r\n            // good old-fashioned direct assignment\r\n            sm2[i] = o[i];\r\n\r\n          }\r\n\r\n        } else if (bonusOptions[i] === _undefined) {\r\n\r\n          // recursion case, eg., { defaultOptions: { ... } }\r\n\r\n          // invalid or disallowed parameter. complain.\r\n          complain(str((sm2[i] === _undefined ? 'setupUndef' : 'setupError'), i), 2);\r\n\r\n          result = false;\r\n\r\n        } else {\r\n\r\n          // recurse through object\r\n          return assign(o[i], i);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  function preferFlashCheck(kind) {\r\n\r\n    // whether flash should play a given type\r\n    return (sm2.preferFlash && hasFlash && !sm2.ignoreFlash && (sm2.flash[kind] !== _undefined && sm2.flash[kind]));\r\n\r\n  }\r\n\r\n  /**\r\n   * Internal DOM2-level event helpers\r\n   * ---------------------------------\r\n   */\r\n\r\n  event = (function() {\r\n\r\n    // normalize event methods\r\n    var old = (window.attachEvent),\r\n    evt = {\r\n      add: (old ? 'attachEvent' : 'addEventListener'),\r\n      remove: (old ? 'detachEvent' : 'removeEventListener')\r\n    };\r\n\r\n    // normalize \"on\" event prefix, optional capture argument\r\n    function getArgs(oArgs) {\r\n\r\n      var args = slice.call(oArgs),\r\n          len = args.length;\r\n\r\n      if (old) {\r\n        // prefix\r\n        args[1] = 'on' + args[1];\r\n        if (len > 3) {\r\n          // no capture\r\n          args.pop();\r\n        }\r\n      } else if (len === 3) {\r\n        args.push(false);\r\n      }\r\n\r\n      return args;\r\n\r\n    }\r\n\r\n    function apply(args, sType) {\r\n\r\n      // normalize and call the event method, with the proper arguments\r\n      var element = args.shift(),\r\n          method = [evt[sType]];\r\n\r\n      if (old) {\r\n        // old IE can't do apply().\r\n        element[method](args[0], args[1]);\r\n      } else {\r\n        element[method].apply(element, args);\r\n      }\r\n\r\n    }\r\n\r\n    function add() {\r\n      apply(getArgs(arguments), 'add');\r\n    }\r\n\r\n    function remove() {\r\n      apply(getArgs(arguments), 'remove');\r\n    }\r\n\r\n    return {\r\n      add: add,\r\n      remove: remove\r\n    };\r\n\r\n  }());\r\n\r\n  /**\r\n   * Internal HTML5 event handling\r\n   * -----------------------------\r\n   */\r\n\r\n  function html5_event(oFn) {\r\n\r\n    // wrap html5 event handlers so we don't call them on destroyed and/or unloaded sounds\r\n\r\n    return function(e) {\r\n\r\n      var s = this._s,\r\n          result;\r\n\r\n      if (!s || !s._a) {\r\n        // <d>\r\n        if (s && s.id) {\r\n          sm2._wD(s.id + ': Ignoring ' + e.type);\r\n        } else {\r\n          sm2._wD(h5 + 'Ignoring ' + e.type);\r\n        }\r\n        // </d>\r\n        result = null;\r\n      } else {\r\n        result = oFn.call(this, e);\r\n      }\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n  }\r\n\r\n  html5_events = {\r\n\r\n    // HTML5 event-name-to-handler map\r\n\r\n    abort: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': abort');\r\n\r\n    }),\r\n\r\n    // enough has loaded to play\r\n\r\n    canplay: html5_event(function() {\r\n\r\n      var s = this._s,\r\n          position1K;\r\n\r\n      if (s._html5_canplay) {\r\n        // this event has already fired. ignore.\r\n        return;\r\n      }\r\n\r\n      s._html5_canplay = true;\r\n      sm2._wD(s.id + ': canplay');\r\n      s._onbufferchange(0);\r\n\r\n      // position according to instance options\r\n      position1K = (s._iO.position !== _undefined && !isNaN(s._iO.position) ? s._iO.position / msecScale : null);\r\n\r\n      // set the position if position was provided before the sound loaded\r\n      if (this.currentTime !== position1K) {\r\n        sm2._wD(s.id + ': canplay: Setting position to ' + position1K);\r\n        try {\r\n          this.currentTime = position1K;\r\n        } catch(ee) {\r\n          sm2._wD(s.id + ': canplay: Setting position of ' + position1K + ' failed: ' + ee.message, 2);\r\n        }\r\n      }\r\n\r\n      // hack for HTML5 from/to case\r\n      if (s._iO._oncanplay) {\r\n        s._iO._oncanplay();\r\n      }\r\n\r\n    }),\r\n\r\n    canplaythrough: html5_event(function() {\r\n\r\n      var s = this._s;\r\n\r\n      if (!s.loaded) {\r\n        s._onbufferchange(0);\r\n        s._whileloading(s.bytesLoaded, s.bytesTotal, s._get_html5_duration());\r\n        s._onload(true);\r\n      }\r\n\r\n    }),\r\n\r\n    durationchange: html5_event(function() {\r\n\r\n      // durationchange may fire at various times, probably the safest way to capture accurate/final duration.\r\n\r\n      var s = this._s,\r\n          duration;\r\n\r\n      duration = s._get_html5_duration();\r\n\r\n      if (!isNaN(duration) && duration !== s.duration) {\r\n\r\n        sm2._wD(this._s.id + ': durationchange (' + duration + ')' + (s.duration ? ', previously ' + s.duration : ''));\r\n\r\n        s.durationEstimate = s.duration = duration;\r\n\r\n      }\r\n\r\n    }),\r\n\r\n    // TODO: Reserved for potential use\r\n    /*\r\n    emptied: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': emptied');\r\n\r\n    }),\r\n    */\r\n\r\n    ended: html5_event(function() {\r\n\r\n      var s = this._s;\r\n\r\n      sm2._wD(s.id + ': ended');\r\n\r\n      s._onfinish();\r\n\r\n    }),\r\n\r\n    error: html5_event(function() {\r\n\r\n      var description = (html5ErrorCodes[this.error.code] || null);\r\n      sm2._wD(this._s.id + ': HTML5 error, code ' + this.error.code + (description ? ' (' + description + ')' : ''));\r\n      this._s._onload(false);\r\n      this._s._onerror(this.error.code, description);\r\n\r\n    }),\r\n\r\n    loadeddata: html5_event(function() {\r\n\r\n      var s = this._s;\r\n\r\n      sm2._wD(s.id + ': loadeddata');\r\n\r\n      // safari seems to nicely report progress events, eventually totalling 100%\r\n      if (!s._loaded && !isSafari) {\r\n        s.duration = s._get_html5_duration();\r\n      }\r\n\r\n    }),\r\n\r\n    loadedmetadata: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': loadedmetadata');\r\n\r\n    }),\r\n\r\n    loadstart: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': loadstart');\r\n      // assume buffering at first\r\n      this._s._onbufferchange(1);\r\n\r\n    }),\r\n\r\n    play: html5_event(function() {\r\n\r\n      // sm2._wD(this._s.id + ': play()');\r\n      // once play starts, no buffering\r\n      this._s._onbufferchange(0);\r\n\r\n    }),\r\n\r\n    playing: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': playing ' + String.fromCharCode(9835));\r\n      // once play starts, no buffering\r\n      this._s._onbufferchange(0);\r\n\r\n    }),\r\n\r\n    progress: html5_event(function(e) {\r\n\r\n      // note: can fire repeatedly after \"loaded\" event, due to use of HTTP range/partials\r\n\r\n      var s = this._s,\r\n          i, j, progStr, buffered = 0,\r\n          isProgress = (e.type === 'progress'),\r\n          ranges = e.target.buffered,\r\n          // firefox 3.6 implements e.loaded/total (bytes)\r\n          loaded = (e.loaded || 0),\r\n          total = (e.total || 1);\r\n\r\n      // reset the \"buffered\" (loaded byte ranges) array\r\n      s.buffered = [];\r\n\r\n      if (ranges && ranges.length) {\r\n\r\n        // if loaded is 0, try TimeRanges implementation as % of load\r\n        // https://developer.mozilla.org/en/DOM/TimeRanges\r\n\r\n        // re-build \"buffered\" array\r\n        // HTML5 returns seconds. SM2 API uses msec for setPosition() etc., whether Flash or HTML5.\r\n        for (i = 0, j = ranges.length; i < j; i++) {\r\n          s.buffered.push({\r\n            start: ranges.start(i) * msecScale,\r\n            end: ranges.end(i) * msecScale\r\n          });\r\n        }\r\n\r\n        // use the last value locally\r\n        buffered = (ranges.end(0) - ranges.start(0)) * msecScale;\r\n\r\n        // linear case, buffer sum; does not account for seeking and HTTP partials / byte ranges\r\n        loaded = Math.min(1, buffered / (e.target.duration * msecScale));\r\n\r\n        // <d>\r\n        if (isProgress && ranges.length > 1) {\r\n          progStr = [];\r\n          j = ranges.length;\r\n          for (i = 0; i < j; i++) {\r\n            progStr.push((e.target.buffered.start(i) * msecScale) + '-' + (e.target.buffered.end(i) * msecScale));\r\n          }\r\n          sm2._wD(this._s.id + ': progress, timeRanges: ' + progStr.join(', '));\r\n        }\r\n\r\n        if (isProgress && !isNaN(loaded)) {\r\n          sm2._wD(this._s.id + ': progress, ' + Math.floor(loaded * 100) + '% loaded');\r\n        }\r\n        // </d>\r\n\r\n      }\r\n\r\n      if (!isNaN(loaded)) {\r\n\r\n        // TODO: prevent calls with duplicate values.\r\n        s._whileloading(loaded, total, s._get_html5_duration());\r\n        if (loaded && total && loaded === total) {\r\n          // in case \"onload\" doesn't fire (eg. gecko 1.9.2)\r\n          html5_events.canplaythrough.call(this, e);\r\n        }\r\n\r\n      }\r\n\r\n    }),\r\n\r\n    ratechange: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': ratechange');\r\n\r\n    }),\r\n\r\n    suspend: html5_event(function(e) {\r\n\r\n      // download paused/stopped, may have finished (eg. onload)\r\n      var s = this._s;\r\n\r\n      sm2._wD(this._s.id + ': suspend');\r\n      html5_events.progress.call(this, e);\r\n      s._onsuspend();\r\n\r\n    }),\r\n\r\n    stalled: html5_event(function() {\r\n\r\n      sm2._wD(this._s.id + ': stalled');\r\n\r\n    }),\r\n\r\n    timeupdate: html5_event(function() {\r\n\r\n      this._s._onTimer();\r\n\r\n    }),\r\n\r\n    waiting: html5_event(function() {\r\n\r\n      var s = this._s;\r\n\r\n      // see also: seeking\r\n      sm2._wD(this._s.id + ': waiting');\r\n\r\n      // playback faster than download rate, etc.\r\n      s._onbufferchange(1);\r\n\r\n    })\r\n\r\n  };\r\n\r\n  html5OK = function(iO) {\r\n\r\n    // playability test based on URL or MIME type\r\n\r\n    var result;\r\n\r\n    if (!iO || (!iO.type && !iO.url && !iO.serverURL)) {\r\n\r\n      // nothing to check\r\n      result = false;\r\n\r\n    } else if (iO.serverURL || (iO.type && preferFlashCheck(iO.type))) {\r\n\r\n      // RTMP, or preferring flash\r\n      result = false;\r\n\r\n    } else {\r\n\r\n      // Use type, if specified. Pass data: URIs to HTML5. If HTML5-only mode, no other options, so just give 'er\r\n      result = ((iO.type ? html5CanPlay({ type: iO.type }) : html5CanPlay({ url: iO.url }) || sm2.html5Only || iO.url.match(/data:/i)));\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  html5Unload = function(oAudio) {\r\n\r\n    /**\r\n     * Internal method: Unload media, and cancel any current/pending network requests.\r\n     * Firefox can load an empty URL, which allegedly destroys the decoder and stops the download.\r\n     * https://developer.mozilla.org/En/Using_audio_and_video_in_Firefox#Stopping_the_download_of_media\r\n     * However, Firefox has been seen loading a relative URL from '' and thus requesting the hosting page on unload.\r\n     * Other UA behaviour is unclear, so everyone else gets an about:blank-style URL.\r\n     */\r\n\r\n    var url;\r\n\r\n    if (oAudio) {\r\n\r\n      // Firefox and Chrome accept short WAVe data: URIs. Chome dislikes audio/wav, but accepts audio/wav for data: MIME.\r\n      // Desktop Safari complains / fails on data: URI, so it gets about:blank.\r\n      url = (isSafari ? emptyURL : (sm2.html5.canPlayType('audio/wav') ? emptyWAV : emptyURL));\r\n\r\n      oAudio.src = url;\r\n\r\n      // reset some state, too\r\n      if (oAudio._called_unload !== _undefined) {\r\n        oAudio._called_load = false;\r\n      }\r\n\r\n    }\r\n\r\n    if (useGlobalHTML5Audio) {\r\n\r\n      // ensure URL state is trashed, also\r\n      lastGlobalHTML5URL = null;\r\n\r\n    }\r\n\r\n    return url;\r\n\r\n  };\r\n\r\n  html5CanPlay = function(o) {\r\n\r\n    /**\r\n     * Try to find MIME, test and return truthiness\r\n     * o = {\r\n     *  url: '/path/to/an.mp3',\r\n     *  type: 'audio/mp3'\r\n     * }\r\n     */\r\n\r\n    if (!sm2.useHTML5Audio || !sm2.hasHTML5) return false;\r\n\r\n    var url = (o.url || null),\r\n        mime = (o.type || null),\r\n        aF = sm2.audioFormats,\r\n        result,\r\n        offset,\r\n        fileExt,\r\n        item;\r\n\r\n    // account for known cases like audio/mp3\r\n\r\n    if (mime && sm2.html5[mime] !== _undefined) return (sm2.html5[mime] && !preferFlashCheck(mime));\r\n\r\n    if (!html5Ext) {\r\n\r\n      html5Ext = [];\r\n\r\n      for (item in aF) {\r\n\r\n        if (aF.hasOwnProperty(item)) {\r\n\r\n          html5Ext.push(item);\r\n\r\n          if (aF[item].related) {\r\n            html5Ext = html5Ext.concat(aF[item].related);\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      html5Ext = new RegExp('\\\\.(' + html5Ext.join('|') + ')(\\\\?.*)?$', 'i');\r\n\r\n    }\r\n\r\n    // TODO: Strip URL queries, etc.\r\n    fileExt = (url ? url.toLowerCase().match(html5Ext) : null);\r\n\r\n    if (!fileExt || !fileExt.length) {\r\n\r\n      if (!mime) {\r\n\r\n        result = false;\r\n\r\n      } else {\r\n\r\n        // audio/mp3 -> mp3, result should be known\r\n        offset = mime.indexOf(';');\r\n\r\n        // strip \"audio/X; codecs...\"\r\n        fileExt = (offset !== -1 ? mime.substr(0, offset) : mime).substr(6);\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      // match the raw extension name - \"mp3\", for example\r\n      fileExt = fileExt[1];\r\n\r\n    }\r\n\r\n    if (fileExt && sm2.html5[fileExt] !== _undefined) {\r\n\r\n      // result known\r\n      result = (sm2.html5[fileExt] && !preferFlashCheck(fileExt));\r\n\r\n    } else {\r\n\r\n      mime = 'audio/' + fileExt;\r\n      result = sm2.html5.canPlayType({ type: mime });\r\n\r\n      sm2.html5[fileExt] = result;\r\n\r\n      // sm2._wD('canPlayType, found result: ' + result);\r\n      result = (result && sm2.html5[mime] && !preferFlashCheck(mime));\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  testHTML5 = function() {\r\n\r\n    /**\r\n     * Internal: Iterates over audioFormats, determining support eg. audio/mp3, audio/mpeg and so on\r\n     * assigns results to html5[] and flash[].\r\n     */\r\n\r\n    if (!sm2.useHTML5Audio || !sm2.hasHTML5) {\r\n\r\n      // without HTML5, we need Flash.\r\n      sm2.html5.usingFlash = true;\r\n      needsFlash = true;\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    // double-whammy: Opera 9.64 throws WRONG_ARGUMENTS_ERR if no parameter passed to Audio(), and Webkit + iOS happily tries to load \"null\" as a URL. :/\r\n    var a = (Audio !== _undefined ? (isOpera && opera.version() < 10 ? new Audio(null) : new Audio()) : null),\r\n        item, lookup, support = {}, aF, i;\r\n\r\n    function cp(m) {\r\n\r\n      var canPlay, j,\r\n          result = false,\r\n          isOK = false;\r\n\r\n      if (!a || typeof a.canPlayType !== 'function') return result;\r\n\r\n      if (m instanceof Array) {\r\n\r\n        // iterate through all mime types, return any successes\r\n\r\n        for (i = 0, j = m.length; i < j; i++) {\r\n\r\n          if (sm2.html5[m[i]] || a.canPlayType(m[i]).match(sm2.html5Test)) {\r\n\r\n            isOK = true;\r\n            sm2.html5[m[i]] = true;\r\n\r\n            // note flash support, too\r\n            sm2.flash[m[i]] = !!(m[i].match(flashMIME));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        result = isOK;\r\n\r\n      } else {\r\n\r\n        canPlay = (a && typeof a.canPlayType === 'function' ? a.canPlayType(m) : false);\r\n        result = !!(canPlay && (canPlay.match(sm2.html5Test)));\r\n\r\n      }\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n    // test all registered formats + codecs\r\n\r\n    aF = sm2.audioFormats;\r\n\r\n    for (item in aF) {\r\n\r\n      if (aF.hasOwnProperty(item)) {\r\n\r\n        lookup = 'audio/' + item;\r\n\r\n        support[item] = cp(aF[item].type);\r\n\r\n        // write back generic type too, eg. audio/mp3\r\n        support[lookup] = support[item];\r\n\r\n        // assign flash\r\n        if (item.match(flashMIME)) {\r\n\r\n          sm2.flash[item] = true;\r\n          sm2.flash[lookup] = true;\r\n\r\n        } else {\r\n\r\n          sm2.flash[item] = false;\r\n          sm2.flash[lookup] = false;\r\n\r\n        }\r\n\r\n        // assign result to related formats, too\r\n\r\n        if (aF[item] && aF[item].related) {\r\n\r\n          for (i = aF[item].related.length - 1; i >= 0; i--) {\r\n\r\n            // eg. audio/m4a\r\n            support['audio/' + aF[item].related[i]] = support[item];\r\n            sm2.html5[aF[item].related[i]] = support[item];\r\n            sm2.flash[aF[item].related[i]] = support[item];\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    support.canPlayType = (a ? cp : null);\r\n    sm2.html5 = mixin(sm2.html5, support);\r\n\r\n    sm2.html5.usingFlash = featureCheck();\r\n    needsFlash = sm2.html5.usingFlash;\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  strings = {\r\n\r\n    // <d>\r\n    notReady: 'Unavailable - wait until onready() has fired.',\r\n    notOK: 'Audio support is not available.',\r\n    domError: sm + 'exception caught while appending SWF to DOM.',\r\n    spcWmode: 'Removing wmode, preventing known SWF loading issue(s)',\r\n    swf404: smc + 'Verify that %s is a valid path.',\r\n    tryDebug: 'Try ' + sm + '.debugFlash = true for more security details (output goes to SWF.)',\r\n    checkSWF: 'See SWF output for more debug info.',\r\n    localFail: smc + 'Non-HTTP page (' + doc.location.protocol + ' URL?) Review Flash player security settings for this special case:\\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/',\r\n    waitFocus: smc + 'Special case: Waiting for SWF to load with window focus...',\r\n    waitForever: smc + 'Waiting indefinitely for Flash (will recover if unblocked)...',\r\n    waitSWF: smc + 'Waiting for 100% SWF load...',\r\n    needFunction: smc + 'Function object expected for %s',\r\n    badID: 'Sound ID \"%s\" should be a string, starting with a non-numeric character',\r\n    currentObj: smc + '_debug(): Current sound objects',\r\n    waitOnload: smc + 'Waiting for window.onload()',\r\n    docLoaded: smc + 'Document already loaded',\r\n    onload: smc + 'initComplete(): calling soundManager.onload()',\r\n    onloadOK: sm + '.onload() complete',\r\n    didInit: smc + 'init(): Already called?',\r\n    secNote: 'Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html',\r\n    badRemove: smc + 'Failed to remove Flash node.',\r\n    shutdown: sm + '.disable(): Shutting down',\r\n    queue: smc + 'Queueing %s handler',\r\n    smError: 'SMSound.load(): Exception: JS-Flash communication failed, or JS error.',\r\n    fbTimeout: 'No flash response, applying .' + swfCSS.swfTimedout + ' CSS...',\r\n    fbLoaded: 'Flash loaded',\r\n    fbHandler: smc + 'flashBlockHandler()',\r\n    manURL: 'SMSound.load(): Using manually-assigned URL',\r\n    onURL: sm + '.load(): current URL already assigned.',\r\n    badFV: sm + '.flashVersion must be 8 or 9. \"%s\" is invalid. Reverting to %s.',\r\n    as2loop: 'Note: Setting stream:false so looping can work (flash 8 limitation)',\r\n    noNSLoop: 'Note: Looping not implemented for MovieStar formats',\r\n    needfl9: 'Note: Switching to flash 9, required for MP4 formats.',\r\n    mfTimeout: 'Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case',\r\n    needFlash: smc + 'Fatal error: Flash is needed to play some required formats, but is not available.',\r\n    gotFocus: smc + 'Got window focus.',\r\n    policy: 'Enabling usePolicyFile for data access',\r\n    setup: sm + '.setup(): allowed parameters: %s',\r\n    setupError: sm + '.setup(): \"%s\" cannot be assigned with this method.',\r\n    setupUndef: sm + '.setup(): Could not find option \"%s\"',\r\n    setupLate: sm + '.setup(): url, flashVersion and html5Test property changes will not take effect until reboot().',\r\n    noURL: smc + 'Flash URL required. Call soundManager.setup({url:...}) to get started.',\r\n    sm2Loaded: 'SoundManager 2: Ready. ' + String.fromCharCode(10003),\r\n    reset: sm + '.reset(): Removing event callbacks',\r\n    mobileUA: 'Mobile UA detected, preferring HTML5 by default.',\r\n    globalHTML5: 'Using singleton HTML5 Audio() pattern for this device.',\r\n    ignoreMobile: 'Ignoring mobile restrictions for this device.'\r\n    // </d>\r\n\r\n  };\r\n\r\n  str = function() {\r\n\r\n    // internal string replace helper.\r\n    // arguments: o [,items to replace]\r\n    // <d>\r\n\r\n    var args,\r\n        i, j, o,\r\n        sstr;\r\n\r\n    // real array, please\r\n    args = slice.call(arguments);\r\n\r\n    // first argument\r\n    o = args.shift();\r\n\r\n    sstr = (strings && strings[o] ? strings[o] : '');\r\n\r\n    if (sstr && args && args.length) {\r\n      for (i = 0, j = args.length; i < j; i++) {\r\n        sstr = sstr.replace('%s', args[i]);\r\n      }\r\n    }\r\n\r\n    return sstr;\r\n    // </d>\r\n\r\n  };\r\n\r\n  loopFix = function(sOpt) {\r\n\r\n    // flash 8 requires stream = false for looping to work\r\n    if (fV === 8 && sOpt.loops > 1 && sOpt.stream) {\r\n      _wDS('as2loop');\r\n      sOpt.stream = false;\r\n    }\r\n\r\n    return sOpt;\r\n\r\n  };\r\n\r\n  policyFix = function(sOpt, sPre) {\r\n\r\n    if (sOpt && !sOpt.usePolicyFile && (sOpt.onid3 || sOpt.usePeakData || sOpt.useWaveformData || sOpt.useEQData)) {\r\n      sm2._wD((sPre || '') + str('policy'));\r\n      sOpt.usePolicyFile = true;\r\n    }\r\n\r\n    return sOpt;\r\n\r\n  };\r\n\r\n  complain = function(sMsg) {\r\n\r\n    // <d>\r\n    if (hasConsole && console.warn !== _undefined) {\r\n      console.warn(sMsg);\r\n    } else {\r\n      sm2._wD(sMsg);\r\n    }\r\n    // </d>\r\n\r\n  };\r\n\r\n  doNothing = function() {\r\n\r\n    return false;\r\n\r\n  };\r\n\r\n  disableObject = function(o) {\r\n\r\n    var oProp;\r\n\r\n    for (oProp in o) {\r\n      if (o.hasOwnProperty(oProp) && typeof o[oProp] === 'function') {\r\n        o[oProp] = doNothing;\r\n      }\r\n    }\r\n\r\n    oProp = null;\r\n\r\n  };\r\n\r\n  failSafely = function(bNoDisable) {\r\n\r\n    // general failure exception handler\r\n\r\n    if (bNoDisable === _undefined) {\r\n      bNoDisable = false;\r\n    }\r\n\r\n    if (disabled || bNoDisable) {\r\n      sm2.disable(bNoDisable);\r\n    }\r\n\r\n  };\r\n\r\n  normalizeMovieURL = function(movieURL) {\r\n\r\n    var urlParams = null, url;\r\n\r\n    if (movieURL) {\r\n\r\n      if (movieURL.match(/\\.swf(\\?.*)?$/i)) {\r\n\r\n        urlParams = movieURL.substr(movieURL.toLowerCase().lastIndexOf('.swf?') + 4);\r\n\r\n        // assume user knows what they're doing\r\n        if (urlParams) return movieURL;\r\n\r\n      } else if (movieURL.lastIndexOf('/') !== movieURL.length - 1) {\r\n\r\n        // append trailing slash, if needed\r\n        movieURL += '/';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    url = (movieURL && movieURL.lastIndexOf('/') !== -1 ? movieURL.substr(0, movieURL.lastIndexOf('/') + 1) : './') + sm2.movieURL;\r\n\r\n    if (sm2.noSWFCache) {\r\n      url += ('?ts=' + new Date().getTime());\r\n    }\r\n\r\n    return url;\r\n\r\n  };\r\n\r\n  setVersionInfo = function() {\r\n\r\n    // short-hand for internal use\r\n\r\n    fV = parseInt(sm2.flashVersion, 10);\r\n\r\n    if (fV !== 8 && fV !== 9) {\r\n      sm2._wD(str('badFV', fV, defaultFlashVersion));\r\n      sm2.flashVersion = fV = defaultFlashVersion;\r\n    }\r\n\r\n    // debug flash movie, if applicable\r\n\r\n    var isDebug = (sm2.debugMode || sm2.debugFlash ? '_debug.swf' : '.swf');\r\n\r\n    if (sm2.useHTML5Audio && !sm2.html5Only && sm2.audioFormats.mp4.required && fV < 9) {\r\n      sm2._wD(str('needfl9'));\r\n      sm2.flashVersion = fV = 9;\r\n    }\r\n\r\n    sm2.version = sm2.versionNumber + (sm2.html5Only ? ' (HTML5-only mode)' : (fV === 9 ? ' (AS3/Flash 9)' : ' (AS2/Flash 8)'));\r\n\r\n    // set up default options\r\n    if (fV > 8) {\r\n\r\n      // +flash 9 base options\r\n      sm2.defaultOptions = mixin(sm2.defaultOptions, sm2.flash9Options);\r\n      sm2.features.buffering = true;\r\n\r\n      // +moviestar support\r\n      sm2.defaultOptions = mixin(sm2.defaultOptions, sm2.movieStarOptions);\r\n      sm2.filePatterns.flash9 = new RegExp('\\\\.(mp3|' + netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n      sm2.features.movieStar = true;\r\n\r\n    } else {\r\n\r\n      sm2.features.movieStar = false;\r\n\r\n    }\r\n\r\n    // regExp for flash canPlay(), etc.\r\n    sm2.filePattern = sm2.filePatterns[(fV !== 8 ? 'flash9' : 'flash8')];\r\n\r\n    // if applicable, use _debug versions of SWFs\r\n    sm2.movieURL = (fV === 8 ? 'soundmanager2.swf' : 'soundmanager2_flash9.swf').replace('.swf', isDebug);\r\n\r\n    sm2.features.peakData = sm2.features.waveformData = sm2.features.eqData = (fV > 8);\r\n\r\n  };\r\n\r\n  setPolling = function(bPolling, bHighPerformance) {\r\n\r\n    if (!flash) {\r\n      return;\r\n    }\r\n\r\n    flash._setPolling(bPolling, bHighPerformance);\r\n\r\n  };\r\n\r\n  initDebug = function() {\r\n\r\n    // starts debug mode, creating output <div> for UAs without console object\r\n\r\n    // allow force of debug mode via URL\r\n    // <d>\r\n    if (sm2.debugURLParam.test(wl)) {\r\n      sm2.setupOptions.debugMode = sm2.debugMode = true;\r\n    }\r\n\r\n    if (id(sm2.debugID)) {\r\n      return;\r\n    }\r\n\r\n    var oD, oDebug, oTarget, oToggle, tmp;\r\n\r\n    if (sm2.debugMode && !id(sm2.debugID) && (!hasConsole || !sm2.useConsole || !sm2.consoleOnly)) {\r\n\r\n      oD = doc.createElement('div');\r\n      oD.id = sm2.debugID + '-toggle';\r\n\r\n      oToggle = {\r\n        position: 'fixed',\r\n        bottom: '0px',\r\n        right: '0px',\r\n        width: '1.2em',\r\n        height: '1.2em',\r\n        lineHeight: '1.2em',\r\n        margin: '2px',\r\n        textAlign: 'center',\r\n        border: '1px solid #999',\r\n        cursor: 'pointer',\r\n        background: '#fff',\r\n        color: '#333',\r\n        zIndex: 10001\r\n      };\r\n\r\n      oD.appendChild(doc.createTextNode('-'));\r\n      oD.onclick = toggleDebug;\r\n      oD.title = 'Toggle SM2 debug console';\r\n\r\n      if (ua.match(/msie 6/i)) {\r\n        oD.style.position = 'absolute';\r\n        oD.style.cursor = 'hand';\r\n      }\r\n\r\n      for (tmp in oToggle) {\r\n        if (oToggle.hasOwnProperty(tmp)) {\r\n          oD.style[tmp] = oToggle[tmp];\r\n        }\r\n      }\r\n\r\n      oDebug = doc.createElement('div');\r\n      oDebug.id = sm2.debugID;\r\n      oDebug.style.display = (sm2.debugMode ? 'block' : 'none');\r\n\r\n      if (sm2.debugMode && !id(oD.id)) {\r\n        try {\r\n          oTarget = getDocument();\r\n          oTarget.appendChild(oD);\r\n        } catch(e2) {\r\n          throw new Error(str('domError') + ' \\n' + e2.toString());\r\n        }\r\n        oTarget.appendChild(oDebug);\r\n      }\r\n\r\n    }\r\n\r\n    oTarget = null;\r\n    // </d>\r\n\r\n  };\r\n\r\n  idCheck = this.getSoundById;\r\n\r\n  // <d>\r\n  _wDS = function(o, errorLevel) {\r\n\r\n    return (!o ? '' : sm2._wD(str(o), errorLevel));\r\n\r\n  };\r\n\r\n  toggleDebug = function() {\r\n\r\n    var o = id(sm2.debugID),\r\n    oT = id(sm2.debugID + '-toggle');\r\n\r\n    if (!o) {\r\n      return;\r\n    }\r\n\r\n    if (debugOpen) {\r\n      // minimize\r\n      oT.innerHTML = '+';\r\n      o.style.display = 'none';\r\n    } else {\r\n      oT.innerHTML = '-';\r\n      o.style.display = 'block';\r\n    }\r\n\r\n    debugOpen = !debugOpen;\r\n\r\n  };\r\n\r\n  debugTS = function(sEventType, bSuccess, sMessage) {\r\n\r\n    // troubleshooter debug hooks\r\n\r\n    if (window.sm2Debugger !== _undefined) {\r\n      try {\r\n        sm2Debugger.handleEvent(sEventType, bSuccess, sMessage);\r\n      } catch(e) {\r\n        // oh well\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n  // </d>\r\n\r\n  getSWFCSS = function() {\r\n\r\n    var css = [];\r\n\r\n    if (sm2.debugMode) {\r\n      css.push(swfCSS.sm2Debug);\r\n    }\r\n\r\n    if (sm2.debugFlash) {\r\n      css.push(swfCSS.flashDebug);\r\n    }\r\n\r\n    if (sm2.useHighPerformance) {\r\n      css.push(swfCSS.highPerf);\r\n    }\r\n\r\n    return css.join(' ');\r\n\r\n  };\r\n\r\n  flashBlockHandler = function() {\r\n\r\n    // *possible* flash block situation.\r\n\r\n    var name = str('fbHandler'),\r\n        p = sm2.getMoviePercent(),\r\n        css = swfCSS,\r\n        error = {\r\n          type: 'FLASHBLOCK'\r\n        };\r\n\r\n    if (sm2.html5Only) {\r\n      // no flash, or unused\r\n      return;\r\n    }\r\n\r\n    if (!sm2.ok()) {\r\n\r\n      if (needsFlash) {\r\n        // make the movie more visible, so user can fix\r\n        sm2.oMC.className = getSWFCSS() + ' ' + css.swfDefault + ' ' + (p === null ? css.swfTimedout : css.swfError);\r\n        sm2._wD(name + ': ' + str('fbTimeout') + (p ? ' (' + str('fbLoaded') + ')' : ''));\r\n      }\r\n\r\n      sm2.didFlashBlock = true;\r\n\r\n      // fire onready(), complain lightly\r\n      processOnEvents({\r\n        type: 'ontimeout',\r\n        ignoreInit: true,\r\n        error: error\r\n      });\r\n\r\n      catchError(error);\r\n\r\n    } else {\r\n\r\n      // SM2 loaded OK (or recovered)\r\n\r\n      // <d>\r\n      if (sm2.didFlashBlock) {\r\n        sm2._wD(name + ': Unblocked');\r\n      }\r\n      // </d>\r\n\r\n      if (sm2.oMC) {\r\n        sm2.oMC.className = [getSWFCSS(), css.swfDefault, css.swfLoaded + (sm2.didFlashBlock ? ' ' + css.swfUnblocked : '')].join(' ');\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  addOnEvent = function(sType, oMethod, oScope) {\r\n\r\n    if (on_queue[sType] === _undefined) {\r\n      on_queue[sType] = [];\r\n    }\r\n\r\n    on_queue[sType].push({\r\n      method: oMethod,\r\n      scope: (oScope || null),\r\n      fired: false\r\n    });\r\n\r\n  };\r\n\r\n  processOnEvents = function(oOptions) {\r\n\r\n    // if unspecified, assume OK/error\r\n\r\n    if (!oOptions) {\r\n      oOptions = {\r\n        type: (sm2.ok() ? 'onready' : 'ontimeout')\r\n      };\r\n    }\r\n\r\n    // not ready yet.\r\n    if (!didInit && oOptions && !oOptions.ignoreInit) return false;\r\n\r\n    // invalid case\r\n    if (oOptions.type === 'ontimeout' && (sm2.ok() || (disabled && !oOptions.ignoreInit))) return false;\r\n\r\n    var status = {\r\n          success: (oOptions && oOptions.ignoreInit ? sm2.ok() : !disabled)\r\n        },\r\n\r\n        // queue specified by type, or none\r\n        srcQueue = (oOptions && oOptions.type ? on_queue[oOptions.type] || [] : []),\r\n\r\n        queue = [], i, j,\r\n        args = [status],\r\n        canRetry = (needsFlash && !sm2.ok());\r\n\r\n    if (oOptions.error) {\r\n      args[0].error = oOptions.error;\r\n    }\r\n\r\n    for (i = 0, j = srcQueue.length; i < j; i++) {\r\n      if (srcQueue[i].fired !== true) {\r\n        queue.push(srcQueue[i]);\r\n      }\r\n    }\r\n\r\n    if (queue.length) {\r\n\r\n      // sm2._wD(sm + ': Firing ' + queue.length + ' ' + oOptions.type + '() item' + (queue.length === 1 ? '' : 's'));\r\n      for (i = 0, j = queue.length; i < j; i++) {\r\n\r\n        if (queue[i].scope) {\r\n          queue[i].method.apply(queue[i].scope, args);\r\n        } else {\r\n          queue[i].method.apply(this, args);\r\n        }\r\n\r\n        if (!canRetry) {\r\n          // useFlashBlock and SWF timeout case doesn't count here.\r\n          queue[i].fired = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  initUserOnload = function() {\r\n\r\n    window.setTimeout(function() {\r\n\r\n      if (sm2.useFlashBlock) {\r\n        flashBlockHandler();\r\n      }\r\n\r\n      processOnEvents();\r\n\r\n      // call user-defined \"onload\", scoped to window\r\n\r\n      if (typeof sm2.onload === 'function') {\r\n        _wDS('onload', 1);\r\n        sm2.onload.apply(window);\r\n        _wDS('onloadOK', 1);\r\n      }\r\n\r\n      if (sm2.waitForWindowLoad) {\r\n        event.add(window, 'load', initUserOnload);\r\n      }\r\n\r\n    }, 1);\r\n\r\n  };\r\n\r\n  detectFlash = function() {\r\n\r\n    /**\r\n     * Hat tip: Flash Detect library (BSD, (C) 2007) by Carl \"DocYes\" S. Yestrau\r\n     * http://featureblend.com/javascript-flash-detection-library.html / http://featureblend.com/license.txt\r\n     */\r\n\r\n    // this work has already been done.\r\n    if (hasFlash !== _undefined) return hasFlash;\r\n\r\n    var hasPlugin = false, n = navigator, obj, type, types, AX = window.ActiveXObject;\r\n\r\n    // MS Edge 14 throws an \"Unspecified Error\" because n.plugins is inaccessible due to permissions\r\n    var nP;\r\n\r\n    try {\r\n      nP = n.plugins;\r\n    } catch(e) {\r\n      nP = undefined;\r\n    }\r\n\r\n    if (nP && nP.length) {\r\n\r\n      type = 'application/x-shockwave-flash';\r\n      types = n.mimeTypes;\r\n\r\n      if (types && types[type] && types[type].enabledPlugin && types[type].enabledPlugin.description) {\r\n        hasPlugin = true;\r\n      }\r\n\r\n    } else if (AX !== _undefined && !ua.match(/MSAppHost/i)) {\r\n\r\n      // Windows 8 Store Apps (MSAppHost) are weird (compatibility?) and won't complain here, but will barf if Flash/ActiveX object is appended to the DOM.\r\n      try {\r\n        obj = new AX('ShockwaveFlash.ShockwaveFlash');\r\n      } catch(e) {\r\n        // oh well\r\n        obj = null;\r\n      }\r\n\r\n      hasPlugin = (!!obj);\r\n\r\n      // cleanup, because it is ActiveX after all\r\n      obj = null;\r\n\r\n    }\r\n\r\n    hasFlash = hasPlugin;\r\n\r\n    return hasPlugin;\r\n\r\n  };\r\n\r\n  featureCheck = function() {\r\n\r\n    var flashNeeded,\r\n        item,\r\n        formats = sm2.audioFormats,\r\n        // iPhone <= 3.1 has broken HTML5 audio(), but firmware 3.2 (original iPad) + iOS4 works.\r\n        isSpecial = (is_iDevice && !!(ua.match(/os (1|2|3_0|3_1)\\s/i)));\r\n\r\n    if (isSpecial) {\r\n\r\n      // has Audio(), but is broken; let it load links directly.\r\n      sm2.hasHTML5 = false;\r\n\r\n      // ignore flash case, however\r\n      sm2.html5Only = true;\r\n\r\n      // hide the SWF, if present\r\n      if (sm2.oMC) {\r\n        sm2.oMC.style.display = 'none';\r\n      }\r\n\r\n    } else if (sm2.useHTML5Audio) {\r\n\r\n        if (!sm2.html5 || !sm2.html5.canPlayType) {\r\n          sm2._wD('SoundManager: No HTML5 Audio() support detected.');\r\n          sm2.hasHTML5 = false;\r\n        }\r\n\r\n        // <d>\r\n        if (isBadSafari) {\r\n          sm2._wD(smc + 'Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - ' + (!hasFlash ? ' would use flash fallback for MP3/MP4, but none detected.' : 'will use flash fallback for MP3/MP4, if available'), 1);\r\n        }\r\n        // </d>\r\n\r\n      }\r\n\r\n    if (sm2.useHTML5Audio && sm2.hasHTML5) {\r\n\r\n      // sort out whether flash is optional, required or can be ignored.\r\n\r\n      // innocent until proven guilty.\r\n      canIgnoreFlash = true;\r\n\r\n      for (item in formats) {\r\n\r\n        if (formats.hasOwnProperty(item)) {\r\n\r\n          if (formats[item].required) {\r\n\r\n            if (!sm2.html5.canPlayType(formats[item].type)) {\r\n\r\n              // 100% HTML5 mode is not possible.\r\n              canIgnoreFlash = false;\r\n              flashNeeded = true;\r\n\r\n            } else if (sm2.preferFlash && (sm2.flash[item] || sm2.flash[formats[item].type])) {\r\n\r\n              // flash may be required, or preferred for this format.\r\n              flashNeeded = true;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // sanity check...\r\n    if (sm2.ignoreFlash) {\r\n      flashNeeded = false;\r\n      canIgnoreFlash = true;\r\n    }\r\n\r\n    sm2.html5Only = (sm2.hasHTML5 && sm2.useHTML5Audio && !flashNeeded);\r\n\r\n    return (!sm2.html5Only);\r\n\r\n  };\r\n\r\n  parseURL = function(url) {\r\n\r\n    /**\r\n     * Internal: Finds and returns the first playable URL (or failing that, the first URL.)\r\n     * @param {string or array} url A single URL string, OR, an array of URL strings or {url:'/path/to/resource', type:'audio/mp3'} objects.\r\n     */\r\n\r\n    var i, j, urlResult = 0, result;\r\n\r\n    if (url instanceof Array) {\r\n\r\n      // find the first good one\r\n      for (i = 0, j = url.length; i < j; i++) {\r\n\r\n        if (url[i] instanceof Object) {\r\n\r\n          // MIME check\r\n          if (sm2.canPlayMIME(url[i].type)) {\r\n            urlResult = i;\r\n            break;\r\n          }\r\n\r\n        } else if (sm2.canPlayURL(url[i])) {\r\n\r\n          // URL string check\r\n          urlResult = i;\r\n          break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // normalize to string\r\n      if (url[urlResult].url) {\r\n        url[urlResult] = url[urlResult].url;\r\n      }\r\n\r\n      result = url[urlResult];\r\n\r\n    } else {\r\n\r\n      // single URL case\r\n      result = url;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n\r\n  startTimer = function(oSound) {\r\n\r\n    /**\r\n     * attach a timer to this sound, and start an interval if needed\r\n     */\r\n\r\n    if (!oSound._hasTimer) {\r\n\r\n      oSound._hasTimer = true;\r\n\r\n      if (!mobileHTML5 && sm2.html5PollingInterval) {\r\n\r\n        if (h5IntervalTimer === null && h5TimerCount === 0) {\r\n\r\n          h5IntervalTimer = setInterval(timerExecute, sm2.html5PollingInterval);\r\n\r\n        }\r\n\r\n        h5TimerCount++;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  stopTimer = function(oSound) {\r\n\r\n    /**\r\n     * detach a timer\r\n     */\r\n\r\n    if (oSound._hasTimer) {\r\n\r\n      oSound._hasTimer = false;\r\n\r\n      if (!mobileHTML5 && sm2.html5PollingInterval) {\r\n\r\n        // interval will stop itself at next execution.\r\n\r\n        h5TimerCount--;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  timerExecute = function() {\r\n\r\n    /**\r\n     * manual polling for HTML5 progress events, ie., whileplaying()\r\n     * (can achieve greater precision than conservative default HTML5 interval)\r\n     */\r\n\r\n    var i;\r\n\r\n    if (h5IntervalTimer !== null && !h5TimerCount) {\r\n\r\n      // no active timers, stop polling interval.\r\n\r\n      clearInterval(h5IntervalTimer);\r\n\r\n      h5IntervalTimer = null;\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    // check all HTML5 sounds with timers\r\n\r\n    for (i = sm2.soundIDs.length - 1; i >= 0; i--) {\r\n\r\n      if (sm2.sounds[sm2.soundIDs[i]].isHTML5 && sm2.sounds[sm2.soundIDs[i]]._hasTimer) {\r\n        sm2.sounds[sm2.soundIDs[i]]._onTimer();\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  catchError = function(options) {\r\n\r\n    options = (options !== _undefined ? options : {});\r\n\r\n    if (typeof sm2.onerror === 'function') {\r\n      sm2.onerror.apply(window, [{\r\n        type: (options.type !== _undefined ? options.type : null)\r\n      }]);\r\n    }\r\n\r\n    if (options.fatal !== _undefined && options.fatal) {\r\n      sm2.disable();\r\n    }\r\n\r\n  };\r\n\r\n  badSafariFix = function() {\r\n\r\n    // special case: \"bad\" Safari (OS X 10.3 - 10.7) must fall back to flash for MP3/MP4\r\n    if (!isBadSafari || !detectFlash()) {\r\n      // doesn't apply\r\n      return;\r\n    }\r\n\r\n    var aF = sm2.audioFormats, i, item;\r\n\r\n    for (item in aF) {\r\n\r\n      if (aF.hasOwnProperty(item)) {\r\n\r\n        if (item === 'mp3' || item === 'mp4') {\r\n\r\n          sm2._wD(sm + ': Using flash fallback for ' + item + ' format');\r\n          sm2.html5[item] = false;\r\n\r\n          // assign result to related formats, too\r\n          if (aF[item] && aF[item].related) {\r\n            for (i = aF[item].related.length - 1; i >= 0; i--) {\r\n              sm2.html5[aF[item].related[i]] = false;\r\n            }\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Pseudo-private flash/ExternalInterface methods\r\n   * ----------------------------------------------\r\n   */\r\n\r\n  this._setSandboxType = function(sandboxType) {\r\n\r\n    // <d>\r\n    // Security sandbox according to Flash plugin\r\n    var sb = sm2.sandbox;\r\n\r\n    sb.type = sandboxType;\r\n    sb.description = sb.types[(sb.types[sandboxType] !== _undefined ? sandboxType : 'unknown')];\r\n\r\n    if (sb.type === 'localWithFile') {\r\n\r\n      sb.noRemote = true;\r\n      sb.noLocal = false;\r\n      _wDS('secNote', 2);\r\n\r\n    } else if (sb.type === 'localWithNetwork') {\r\n\r\n      sb.noRemote = false;\r\n      sb.noLocal = true;\r\n\r\n    } else if (sb.type === 'localTrusted') {\r\n\r\n      sb.noRemote = false;\r\n      sb.noLocal = false;\r\n\r\n    }\r\n    // </d>\r\n\r\n  };\r\n\r\n  this._externalInterfaceOK = function(swfVersion) {\r\n\r\n    // flash callback confirming flash loaded, EI working etc.\r\n    // swfVersion: SWF build string\r\n\r\n    if (sm2.swfLoaded) {\r\n      return;\r\n    }\r\n\r\n    var e;\r\n\r\n    debugTS('swf', true);\r\n    debugTS('flashtojs', true);\r\n    sm2.swfLoaded = true;\r\n    tryInitOnFocus = false;\r\n\r\n    if (isBadSafari) {\r\n      badSafariFix();\r\n    }\r\n\r\n    // complain if JS + SWF build/version strings don't match, excluding +DEV builds\r\n    // <d>\r\n    if (!swfVersion || swfVersion.replace(/\\+dev/i, '') !== sm2.versionNumber.replace(/\\+dev/i, '')) {\r\n\r\n      e = sm + ': Fatal: JavaScript file build \"' + sm2.versionNumber + '\" does not match Flash SWF build \"' + swfVersion + '\" at ' + sm2.url + '. Ensure both are up-to-date.';\r\n\r\n      // escape flash -> JS stack so this error fires in window.\r\n      setTimeout(function() {\r\n        throw new Error(e);\r\n      }, 0);\r\n\r\n      // exit, init will fail with timeout\r\n      return;\r\n\r\n    }\r\n    // </d>\r\n\r\n    // IE needs a larger timeout\r\n    setTimeout(init, isIE ? 100 : 1);\r\n\r\n  };\r\n\r\n  /**\r\n   * Private initialization helpers\r\n   * ------------------------------\r\n   */\r\n\r\n  createMovie = function(movieID, movieURL) {\r\n\r\n    // ignore if already connected\r\n    if (didAppend && appendSuccess) return false;\r\n\r\n    function initMsg() {\r\n\r\n      // <d>\r\n\r\n      var options = [],\r\n          title,\r\n          msg = [],\r\n          delimiter = ' + ';\r\n\r\n      title = 'SoundManager ' + sm2.version + (!sm2.html5Only && sm2.useHTML5Audio ? (sm2.hasHTML5 ? ' + HTML5 audio' : ', no HTML5 audio support') : '');\r\n\r\n      if (!sm2.html5Only) {\r\n\r\n        if (sm2.preferFlash) {\r\n          options.push('preferFlash');\r\n        }\r\n\r\n        if (sm2.useHighPerformance) {\r\n          options.push('useHighPerformance');\r\n        }\r\n\r\n        if (sm2.flashPollingInterval) {\r\n          options.push('flashPollingInterval (' + sm2.flashPollingInterval + 'ms)');\r\n        }\r\n\r\n        if (sm2.html5PollingInterval) {\r\n          options.push('html5PollingInterval (' + sm2.html5PollingInterval + 'ms)');\r\n        }\r\n\r\n        if (sm2.wmode) {\r\n          options.push('wmode (' + sm2.wmode + ')');\r\n        }\r\n\r\n        if (sm2.debugFlash) {\r\n          options.push('debugFlash');\r\n        }\r\n\r\n        if (sm2.useFlashBlock) {\r\n          options.push('flashBlock');\r\n        }\r\n\r\n      } else if (sm2.html5PollingInterval) {\r\n          options.push('html5PollingInterval (' + sm2.html5PollingInterval + 'ms)');\r\n        }\r\n\r\n      if (options.length) {\r\n        msg = msg.concat([options.join(delimiter)]);\r\n      }\r\n\r\n      sm2._wD(title + (msg.length ? delimiter + msg.join(', ') : ''), 1);\r\n\r\n      showSupport();\r\n\r\n      // </d>\r\n\r\n    }\r\n\r\n    if (sm2.html5Only) {\r\n\r\n      // 100% HTML5 mode\r\n      setVersionInfo();\r\n\r\n      initMsg();\r\n      sm2.oMC = id(sm2.movieID);\r\n      init();\r\n\r\n      // prevent multiple init attempts\r\n      didAppend = true;\r\n\r\n      appendSuccess = true;\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    // flash path\r\n    var remoteURL = (movieURL || sm2.url),\r\n    localURL = (sm2.altURL || remoteURL),\r\n    swfTitle = 'JS/Flash audio component (SoundManager 2)',\r\n    oTarget = getDocument(),\r\n    extraClass = getSWFCSS(),\r\n    isRTL = null,\r\n    html = doc.getElementsByTagName('html')[0],\r\n    oEmbed, oMovie, tmp, movieHTML, oEl, s, x, sClass;\r\n\r\n    isRTL = (html && html.dir && html.dir.match(/rtl/i));\r\n    movieID = (movieID === _undefined ? sm2.id : movieID);\r\n\r\n    function param(name, value) {\r\n      return '<param name=\"' + name + '\" value=\"' + value + '\" />';\r\n    }\r\n\r\n    // safety check for legacy (change to Flash 9 URL)\r\n    setVersionInfo();\r\n    sm2.url = normalizeMovieURL(overHTTP ? remoteURL : localURL);\r\n    movieURL = sm2.url;\r\n\r\n    sm2.wmode = (!sm2.wmode && sm2.useHighPerformance ? 'transparent' : sm2.wmode);\r\n\r\n    if (sm2.wmode !== null && (ua.match(/msie 8/i) || (!isIE && !sm2.useHighPerformance)) && navigator.platform.match(/win32|win64/i)) {\r\n      /**\r\n       * extra-special case: movie doesn't load until scrolled into view when using wmode = anything but 'window' here\r\n       * does not apply when using high performance (position:fixed means on-screen), OR infinite flash load timeout\r\n       * wmode breaks IE 8 on Vista + Win7 too in some cases, as of January 2011 (?)\r\n       */\r\n      messages.push(strings.spcWmode);\r\n      sm2.wmode = null;\r\n    }\r\n\r\n    oEmbed = {\r\n      name: movieID,\r\n      id: movieID,\r\n      src: movieURL,\r\n      quality: 'high',\r\n      allowScriptAccess: sm2.allowScriptAccess,\r\n      bgcolor: sm2.bgColor,\r\n      pluginspage: http + 'www.macromedia.com/go/getflashplayer',\r\n      title: swfTitle,\r\n      type: 'application/x-shockwave-flash',\r\n      wmode: sm2.wmode,\r\n      // http://help.adobe.com/en_US/as3/mobile/WS4bebcd66a74275c36cfb8137124318eebc6-7ffd.html\r\n      hasPriority: 'true'\r\n    };\r\n\r\n    if (sm2.debugFlash) {\r\n      oEmbed.FlashVars = 'debug=1';\r\n    }\r\n\r\n    if (!sm2.wmode) {\r\n      // don't write empty attribute\r\n      delete oEmbed.wmode;\r\n    }\r\n\r\n    if (isIE) {\r\n\r\n      // IE is \"special\".\r\n      oMovie = doc.createElement('div');\r\n      movieHTML = [\r\n        '<object id=\"' + movieID + '\" data=\"' + movieURL + '\" type=\"' + oEmbed.type + '\" title=\"' + oEmbed.title + '\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0\">',\r\n        param('movie', movieURL),\r\n        param('AllowScriptAccess', sm2.allowScriptAccess),\r\n        param('quality', oEmbed.quality),\r\n        (sm2.wmode ? param('wmode', sm2.wmode) : ''),\r\n        param('bgcolor', sm2.bgColor),\r\n        param('hasPriority', 'true'),\r\n        (sm2.debugFlash ? param('FlashVars', oEmbed.FlashVars) : ''),\r\n        '</object>'\r\n      ].join('');\r\n\r\n    } else {\r\n\r\n      oMovie = doc.createElement('embed');\r\n      for (tmp in oEmbed) {\r\n        if (oEmbed.hasOwnProperty(tmp)) {\r\n          oMovie.setAttribute(tmp, oEmbed[tmp]);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    initDebug();\r\n    extraClass = getSWFCSS();\r\n    oTarget = getDocument();\r\n\r\n    if (oTarget) {\r\n\r\n      sm2.oMC = (id(sm2.movieID) || doc.createElement('div'));\r\n\r\n      if (!sm2.oMC.id) {\r\n\r\n        sm2.oMC.id = sm2.movieID;\r\n        sm2.oMC.className = swfCSS.swfDefault + ' ' + extraClass;\r\n        s = null;\r\n        oEl = null;\r\n\r\n        if (!sm2.useFlashBlock) {\r\n          if (sm2.useHighPerformance) {\r\n            // on-screen at all times\r\n            s = {\r\n              position: 'fixed',\r\n              width: '8px',\r\n              height: '8px',\r\n              // >= 6px for flash to run fast, >= 8px to start up under Firefox/win32 in some cases. odd? yes.\r\n              bottom: '0px',\r\n              left: '0px',\r\n              overflow: 'hidden'\r\n            };\r\n          } else {\r\n            // hide off-screen, lower priority\r\n            s = {\r\n              position: 'absolute',\r\n              width: '6px',\r\n              height: '6px',\r\n              top: '-9999px',\r\n              left: '-9999px'\r\n            };\r\n            if (isRTL) {\r\n              s.left = Math.abs(parseInt(s.left, 10)) + 'px';\r\n            }\r\n          }\r\n        }\r\n\r\n        if (isWebkit) {\r\n          // soundcloud-reported render/crash fix, safari 5\r\n          sm2.oMC.style.zIndex = 10000;\r\n        }\r\n\r\n        if (!sm2.debugFlash) {\r\n          for (x in s) {\r\n            if (s.hasOwnProperty(x)) {\r\n              sm2.oMC.style[x] = s[x];\r\n            }\r\n          }\r\n        }\r\n\r\n        try {\r\n\r\n          if (!isIE) {\r\n            sm2.oMC.appendChild(oMovie);\r\n          }\r\n\r\n          oTarget.appendChild(sm2.oMC);\r\n\r\n          if (isIE) {\r\n            oEl = sm2.oMC.appendChild(doc.createElement('div'));\r\n            oEl.className = swfCSS.swfBox;\r\n            oEl.innerHTML = movieHTML;\r\n          }\r\n\r\n          appendSuccess = true;\r\n\r\n        } catch(e) {\r\n\r\n          throw new Error(str('domError') + ' \\n' + e.toString());\r\n\r\n        }\r\n\r\n      } else {\r\n\r\n        // SM2 container is already in the document (eg. flashblock use case)\r\n        sClass = sm2.oMC.className;\r\n        sm2.oMC.className = (sClass ? sClass + ' ' : swfCSS.swfDefault) + (extraClass ? ' ' + extraClass : '');\r\n        sm2.oMC.appendChild(oMovie);\r\n\r\n        if (isIE) {\r\n          oEl = sm2.oMC.appendChild(doc.createElement('div'));\r\n          oEl.className = swfCSS.swfBox;\r\n          oEl.innerHTML = movieHTML;\r\n        }\r\n\r\n        appendSuccess = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    didAppend = true;\r\n\r\n    initMsg();\r\n\r\n    // sm2._wD(sm + ': Trying to load ' + movieURL + (!overHTTP && sm2.altURL ? ' (alternate URL)' : ''), 1);\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  initMovie = function() {\r\n\r\n    if (sm2.html5Only) {\r\n      createMovie();\r\n      return false;\r\n    }\r\n\r\n    // attempt to get, or create, movie (may already exist)\r\n    if (flash) return false;\r\n\r\n    if (!sm2.url) {\r\n\r\n      /**\r\n       * Something isn't right - we've reached init, but the soundManager url property has not been set.\r\n       * User has not called setup({url: ...}), or has not set soundManager.url (legacy use case) directly before init time.\r\n       * Notify and exit. If user calls setup() with a url: property, init will be restarted as in the deferred loading case.\r\n       */\r\n\r\n       _wDS('noURL');\r\n       return false;\r\n\r\n    }\r\n\r\n    // inline markup case\r\n    flash = sm2.getMovie(sm2.id);\r\n\r\n    if (!flash) {\r\n\r\n      if (!oRemoved) {\r\n\r\n        // try to create\r\n        createMovie(sm2.id, sm2.url);\r\n\r\n      } else {\r\n\r\n        // try to re-append removed movie after reboot()\r\n        if (!isIE) {\r\n          sm2.oMC.appendChild(oRemoved);\r\n        } else {\r\n          sm2.oMC.innerHTML = oRemovedHTML;\r\n        }\r\n\r\n        oRemoved = null;\r\n        didAppend = true;\r\n\r\n      }\r\n\r\n      flash = sm2.getMovie(sm2.id);\r\n\r\n    }\r\n\r\n    if (typeof sm2.oninitmovie === 'function') {\r\n      setTimeout(sm2.oninitmovie, 1);\r\n    }\r\n\r\n    // <d>\r\n    flushMessages();\r\n    // </d>\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  delayWaitForEI = function() {\r\n\r\n    setTimeout(waitForEI, 1000);\r\n\r\n  };\r\n\r\n  rebootIntoHTML5 = function() {\r\n\r\n    // special case: try for a reboot with preferFlash: false, if 100% HTML5 mode is possible and useFlashBlock is not enabled.\r\n\r\n    window.setTimeout(function() {\r\n\r\n      complain(smc + 'useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false...');\r\n\r\n      sm2.setup({\r\n        preferFlash: false\r\n      }).reboot();\r\n\r\n      // if for some reason you want to detect this case, use an ontimeout() callback and look for html5Only and didFlashBlock == true.\r\n      sm2.didFlashBlock = true;\r\n\r\n      sm2.beginDelayedInit();\r\n\r\n    }, 1);\r\n\r\n  };\r\n\r\n  waitForEI = function() {\r\n\r\n    var p,\r\n        loadIncomplete = false;\r\n\r\n    if (!sm2.url) {\r\n      // No SWF url to load (noURL case) - exit for now. Will be retried when url is set.\r\n      return;\r\n    }\r\n\r\n    if (waitingForEI) {\r\n      return;\r\n    }\r\n\r\n    waitingForEI = true;\r\n    event.remove(window, 'load', delayWaitForEI);\r\n\r\n    if (hasFlash && tryInitOnFocus && !isFocused) {\r\n      // Safari won't load flash in background tabs, only when focused.\r\n      _wDS('waitFocus');\r\n      return;\r\n    }\r\n\r\n    if (!didInit) {\r\n      p = sm2.getMoviePercent();\r\n      if (p > 0 && p < 100) {\r\n        loadIncomplete = true;\r\n      }\r\n    }\r\n\r\n    setTimeout(function() {\r\n\r\n      p = sm2.getMoviePercent();\r\n\r\n      if (loadIncomplete) {\r\n        // special case: if movie *partially* loaded, retry until it's 100% before assuming failure.\r\n        waitingForEI = false;\r\n        sm2._wD(str('waitSWF'));\r\n        window.setTimeout(delayWaitForEI, 1);\r\n        return;\r\n      }\r\n\r\n      // <d>\r\n      if (!didInit) {\r\n\r\n        sm2._wD(sm + ': No Flash response within expected time. Likely causes: ' + (p === 0 ? 'SWF load failed, ' : '') + 'Flash blocked or JS-Flash security error.' + (sm2.debugFlash ? ' ' + str('checkSWF') : ''), 2);\r\n\r\n        if (!overHTTP && p) {\r\n\r\n          _wDS('localFail', 2);\r\n\r\n          if (!sm2.debugFlash) {\r\n            _wDS('tryDebug', 2);\r\n          }\r\n\r\n        }\r\n\r\n        if (p === 0) {\r\n\r\n          // if 0 (not null), probably a 404.\r\n          sm2._wD(str('swf404', sm2.url), 1);\r\n\r\n        }\r\n\r\n        debugTS('flashtojs', false, ': Timed out' + (overHTTP ? ' (Check flash security or flash blockers)' : ' (No plugin/missing SWF?)'));\r\n\r\n      }\r\n      // </d>\r\n\r\n      // give up / time-out, depending\r\n\r\n      if (!didInit && okToDisable) {\r\n\r\n        if (p === null) {\r\n\r\n          // SWF failed to report load progress. Possibly blocked.\r\n\r\n          if (sm2.useFlashBlock || sm2.flashLoadTimeout === 0) {\r\n\r\n            if (sm2.useFlashBlock) {\r\n\r\n              flashBlockHandler();\r\n\r\n            }\r\n\r\n            _wDS('waitForever');\r\n\r\n          } else if (!sm2.useFlashBlock && canIgnoreFlash) {\r\n\r\n            // no custom flash block handling, but SWF has timed out. Will recover if user unblocks / allows SWF load.\r\n            rebootIntoHTML5();\r\n\r\n          } else {\r\n\r\n            _wDS('waitForever');\r\n\r\n            // fire any regular registered ontimeout() listeners.\r\n            processOnEvents({\r\n              type: 'ontimeout',\r\n              ignoreInit: true,\r\n              error: {\r\n                type: 'INIT_FLASHBLOCK'\r\n              }\r\n            });\r\n\r\n          }\r\n\r\n        } else if (sm2.flashLoadTimeout === 0) {\r\n\r\n          // SWF loaded? Shouldn't be a blocking issue, then.\r\n\r\n          _wDS('waitForever');\r\n\r\n        } else if (!sm2.useFlashBlock && canIgnoreFlash) {\r\n\r\n          rebootIntoHTML5();\r\n\r\n        } else {\r\n\r\n          failSafely(true);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }, sm2.flashLoadTimeout);\r\n\r\n  };\r\n\r\n  handleFocus = function() {\r\n\r\n    function cleanup() {\r\n      event.remove(window, 'focus', handleFocus);\r\n    }\r\n\r\n    if (isFocused || !tryInitOnFocus) {\r\n      // already focused, or not special Safari background tab case\r\n      cleanup();\r\n      return true;\r\n    }\r\n\r\n    okToDisable = true;\r\n    isFocused = true;\r\n    _wDS('gotFocus');\r\n\r\n    // allow init to restart\r\n    waitingForEI = false;\r\n\r\n    // kick off ExternalInterface timeout, now that the SWF has started\r\n    delayWaitForEI();\r\n\r\n    cleanup();\r\n    return true;\r\n\r\n  };\r\n\r\n  flushMessages = function() {\r\n\r\n    // <d>\r\n\r\n    // SM2 pre-init debug messages\r\n    if (messages.length) {\r\n      sm2._wD('SoundManager 2: ' + messages.join(' '), 1);\r\n      messages = [];\r\n    }\r\n\r\n    // </d>\r\n\r\n  };\r\n\r\n  showSupport = function() {\r\n\r\n    // <d>\r\n\r\n    flushMessages();\r\n\r\n    var item, tests = [];\r\n\r\n    if (sm2.useHTML5Audio && sm2.hasHTML5) {\r\n      for (item in sm2.audioFormats) {\r\n        if (sm2.audioFormats.hasOwnProperty(item)) {\r\n          tests.push(item + ' = ' + sm2.html5[item] + (!sm2.html5[item] && needsFlash && sm2.flash[item] ? ' (using flash)' : (sm2.preferFlash && sm2.flash[item] && needsFlash ? ' (preferring flash)' : (!sm2.html5[item] ? ' (' + (sm2.audioFormats[item].required ? 'required, ' : '') + 'and no flash support)' : ''))));\r\n        }\r\n      }\r\n      sm2._wD('SoundManager 2 HTML5 support: ' + tests.join(', '), 1);\r\n    }\r\n\r\n    // </d>\r\n\r\n  };\r\n\r\n  initComplete = function(bNoDisable) {\r\n\r\n    if (didInit) return false;\r\n\r\n    if (sm2.html5Only) {\r\n      // all good.\r\n      _wDS('sm2Loaded', 1);\r\n      didInit = true;\r\n      initUserOnload();\r\n      debugTS('onload', true);\r\n      return true;\r\n    }\r\n\r\n    var wasTimeout = (sm2.useFlashBlock && sm2.flashLoadTimeout && !sm2.getMoviePercent()),\r\n        result = true,\r\n        error;\r\n\r\n    if (!wasTimeout) {\r\n      didInit = true;\r\n    }\r\n\r\n    error = {\r\n      type: (!hasFlash && needsFlash ? 'NO_FLASH' : 'INIT_TIMEOUT')\r\n    };\r\n\r\n    sm2._wD('SoundManager 2 ' + (disabled ? 'failed to load' : 'loaded') + ' (' + (disabled ? 'Flash security/load error' : 'OK') + ') ' + String.fromCharCode(disabled ? 10006 : 10003), disabled ? 2 : 1);\r\n\r\n    if (disabled || bNoDisable) {\r\n\r\n      if (sm2.useFlashBlock && sm2.oMC) {\r\n        sm2.oMC.className = getSWFCSS() + ' ' + (sm2.getMoviePercent() === null ? swfCSS.swfTimedout : swfCSS.swfError);\r\n      }\r\n\r\n      processOnEvents({\r\n        type: 'ontimeout',\r\n        error: error,\r\n        ignoreInit: true\r\n      });\r\n\r\n      debugTS('onload', false);\r\n      catchError(error);\r\n\r\n      result = false;\r\n\r\n    } else {\r\n\r\n      debugTS('onload', true);\r\n\r\n    }\r\n\r\n    if (!disabled) {\r\n\r\n      if (sm2.waitForWindowLoad && !windowLoaded) {\r\n\r\n        _wDS('waitOnload');\r\n        event.add(window, 'load', initUserOnload);\r\n\r\n      } else {\r\n\r\n        // <d>\r\n        if (sm2.waitForWindowLoad && windowLoaded) {\r\n          _wDS('docLoaded');\r\n        }\r\n        // </d>\r\n\r\n        initUserOnload();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  };\r\n\r\n  /**\r\n   * apply top-level setupOptions object as local properties, eg., this.setupOptions.flashVersion -> this.flashVersion (soundManager.flashVersion)\r\n   * this maintains backward compatibility, and allows properties to be defined separately for use by soundManager.setup().\r\n   */\r\n\r\n  setProperties = function() {\r\n\r\n    var i,\r\n        o = sm2.setupOptions;\r\n\r\n    for (i in o) {\r\n\r\n      if (o.hasOwnProperty(i)) {\r\n\r\n        // assign local property if not already defined\r\n\r\n        if (sm2[i] === _undefined) {\r\n\r\n          sm2[i] = o[i];\r\n\r\n        } else if (sm2[i] !== o[i]) {\r\n\r\n          // legacy support: write manually-assigned property (eg., soundManager.url) back to setupOptions to keep things in sync\r\n          sm2.setupOptions[i] = sm2[i];\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n\r\n  init = function() {\r\n\r\n    // called after onload()\r\n\r\n    if (didInit) {\r\n      _wDS('didInit');\r\n      return false;\r\n    }\r\n\r\n    function cleanup() {\r\n      event.remove(window, 'load', sm2.beginDelayedInit);\r\n    }\r\n\r\n    if (sm2.html5Only) {\r\n\r\n      if (!didInit) {\r\n        // we don't need no steenking flash!\r\n        cleanup();\r\n        sm2.enabled = true;\r\n        initComplete();\r\n      }\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    // flash path\r\n    initMovie();\r\n\r\n    try {\r\n\r\n      // attempt to talk to Flash\r\n      flash._externalInterfaceTest(false);\r\n\r\n      /**\r\n       * Apply user-specified polling interval, OR, if \"high performance\" set, faster vs. default polling\r\n       * (determines frequency of whileloading/whileplaying callbacks, effectively driving UI framerates)\r\n       */\r\n      setPolling(true, (sm2.flashPollingInterval || (sm2.useHighPerformance ? 10 : 50)));\r\n\r\n      if (!sm2.debugMode) {\r\n        // stop the SWF from making debug output calls to JS\r\n        flash._disableDebug();\r\n      }\r\n\r\n      sm2.enabled = true;\r\n      debugTS('jstoflash', true);\r\n\r\n      if (!sm2.html5Only) {\r\n        // prevent browser from showing cached page state (or rather, restoring \"suspended\" page state) via back button, because flash may be dead\r\n        // http://www.webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/\r\n        event.add(window, 'unload', doNothing);\r\n      }\r\n\r\n    } catch(e) {\r\n\r\n      sm2._wD('js/flash exception: ' + e.toString());\r\n\r\n      debugTS('jstoflash', false);\r\n\r\n      catchError({\r\n        type: 'JS_TO_FLASH_EXCEPTION',\r\n        fatal: true\r\n      });\r\n\r\n      // don't disable, for reboot()\r\n      failSafely(true);\r\n\r\n      initComplete();\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    initComplete();\r\n\r\n    // disconnect events\r\n    cleanup();\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  domContentLoaded = function() {\r\n\r\n    if (didDCLoaded) return false;\r\n\r\n    didDCLoaded = true;\r\n\r\n    // assign top-level soundManager properties eg. soundManager.url\r\n    setProperties();\r\n\r\n    initDebug();\r\n\r\n    if (!hasFlash && sm2.hasHTML5) {\r\n\r\n      sm2._wD('SoundManager 2: No Flash detected' + (!sm2.useHTML5Audio ? ', enabling HTML5.' : '. Trying HTML5-only mode.'), 1);\r\n\r\n      sm2.setup({\r\n        useHTML5Audio: true,\r\n        // make sure we aren't preferring flash, either\r\n        // TODO: preferFlash should not matter if flash is not installed. Currently, stuff breaks without the below tweak.\r\n        preferFlash: false\r\n      });\r\n\r\n    }\r\n\r\n    testHTML5();\r\n\r\n    if (!hasFlash && needsFlash) {\r\n\r\n      messages.push(strings.needFlash);\r\n\r\n      // TODO: Fatal here vs. timeout approach, etc.\r\n      // hack: fail sooner.\r\n      sm2.setup({\r\n        flashLoadTimeout: 1\r\n      });\r\n\r\n    }\r\n\r\n    if (doc.removeEventListener) {\r\n      doc.removeEventListener('DOMContentLoaded', domContentLoaded, false);\r\n    }\r\n\r\n    initMovie();\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  domContentLoadedIE = function() {\r\n\r\n    if (doc.readyState === 'complete') {\r\n      domContentLoaded();\r\n      doc.detachEvent('onreadystatechange', domContentLoadedIE);\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  winOnLoad = function() {\r\n\r\n    // catch edge case of initComplete() firing after window.load()\r\n    windowLoaded = true;\r\n\r\n    // catch case where DOMContentLoaded has been sent, but we're still in doc.readyState = 'interactive'\r\n    domContentLoaded();\r\n\r\n    event.remove(window, 'load', winOnLoad);\r\n\r\n  };\r\n\r\n  // sniff up-front\r\n  detectFlash();\r\n\r\n  // focus and window load, init (primarily flash-driven)\r\n  event.add(window, 'focus', handleFocus);\r\n  event.add(window, 'load', delayWaitForEI);\r\n  event.add(window, 'load', winOnLoad);\r\n\r\n  if (doc.addEventListener) {\r\n\r\n    doc.addEventListener('DOMContentLoaded', domContentLoaded, false);\r\n\r\n  } else if (doc.attachEvent) {\r\n\r\n    doc.attachEvent('onreadystatechange', domContentLoadedIE);\r\n\r\n  } else {\r\n\r\n    // no add/attachevent support - safe to assume no JS -> Flash either\r\n    debugTS('onload', false);\r\n    catchError({\r\n      type: 'NO_DOM2_EVENTS',\r\n      fatal: true\r\n    });\r\n\r\n  }\r\n\r\n} // SoundManager()\r\n\r\n// SM2_DEFER details: http://www.schillmania.com/projects/soundmanager2/doc/getstarted/#lazy-loading\r\n\r\nif (window.SM2_DEFER === _undefined || !SM2_DEFER) {\r\n  soundManager = new SoundManager();\r\n}\r\n\r\n/**\r\n * SoundManager public interfaces\r\n * ------------------------------\r\n */\r\n\r\nif (typeof module === 'object' && module && typeof module.exports === 'object') {\r\n\r\n  /**\r\n   * commonJS module\r\n   */\r\n\r\n  module.exports.SoundManager = SoundManager;\r\n  module.exports.soundManager = soundManager;\r\n\r\n} else if (typeof define === 'function' && define.amd) {\r\n\r\n  /**\r\n   * AMD - requireJS\r\n   * basic usage:\r\n   * require([\"/path/to/soundmanager2.js\"], function(SoundManager) {\r\n   *   SoundManager.getInstance().setup({\r\n   *     url: '/swf/',\r\n   *     onready: function() { ... }\r\n   *   })\r\n   * });\r\n   *\r\n   * SM2_DEFER usage:\r\n   * window.SM2_DEFER = true;\r\n   * require([\"/path/to/soundmanager2.js\"], function(SoundManager) {\r\n   *   SoundManager.getInstance(function() {\r\n   *     var soundManager = new SoundManager.constructor();\r\n   *     soundManager.setup({\r\n   *       url: '/swf/',\r\n   *       ...\r\n   *     });\r\n   *     ...\r\n   *     soundManager.beginDelayedInit();\r\n   *     return soundManager;\r\n   *   })\r\n   * });\r\n   */\r\n\r\n  define(function() {\r\n    /**\r\n     * Retrieve the global instance of SoundManager.\r\n     * If a global instance does not exist it can be created using a callback.\r\n     *\r\n     * @param {Function} smBuilder Optional: Callback used to create a new SoundManager instance\r\n     * @return {SoundManager} The global SoundManager instance\r\n     */\r\n    function getInstance(smBuilder) {\r\n      if (!window.soundManager && smBuilder instanceof Function) {\r\n        var instance = smBuilder(SoundManager);\r\n        if (instance instanceof SoundManager) {\r\n          window.soundManager = instance;\r\n        }\r\n      }\r\n      return window.soundManager;\r\n    }\r\n    return {\r\n      constructor: SoundManager,\r\n      getInstance: getInstance\r\n    };\r\n  });\r\n\r\n}\r\n\r\n// standard browser case\r\n\r\n// constructor\r\nwindow.SoundManager = SoundManager;\r\n\r\n/**\r\n * note: SM2 requires a window global due to Flash, which makes calls to window.soundManager.\r\n * Flash may not always be needed, but this is not known until async init and SM2 may even \"reboot\" into Flash mode.\r\n */\r\n\r\n// public API, flash callbacks etc.\r\nwindow.soundManager = soundManager;\r\n\r\n}(window));\r\n"],"sourceRoot":""}